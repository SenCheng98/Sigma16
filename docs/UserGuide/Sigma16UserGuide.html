<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-09-27 Mon 16:23 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../docstyle.css" />
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1>Sigma16 User Guide</h1>

Version 3.4.0, September 2021.
Copyright (c) 2021 John T. O'Donnell
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org59a061e">Introduction</a></li>
<li><a href="#orgbbc4af8">Tutorials</a>
<ul>
<li><a href="#sec-core-tutorial">Core architecture tutorial</a>
<ul>
<li><a href="#org0443f92">Hello, world!</a></li>
<li><a href="#orgfde8b9e">Registers, constants, and arithmetic</a></li>
<li><a href="#orgfe945bd">Keeping variables in memory</a></li>
<li><a href="#org420eab2">Files and modules</a></li>
<li><a href="#org2d9efea">Jumps and conditionals</a></li>
<li><a href="#org2edcf96">Loops</a></li>
<li><a href="#org951a2fa">Machine language</a></li>
<li><a href="#org3dbbfab">A strange program</a></li>
<li><a href="#org40c0a69">Testing and debugging</a></li>
<li><a href="#org4e1e6a8">Breakpoints</a></li>
<li><a href="#org4386609">List of Core instructions</a></li>
</ul>
</li>
<li><a href="#org94c312e">Standard architecture tutorial</a></li>
<li><a href="#org70f6adf">Systems architecture tutorial</a></li>
<li><a href="#org7841034">S32 architecture tutorial</a></li>
</ul>
</li>
<li><a href="#sec-architecture">Sigma16 Architecture reference</a>
<ul>
<li><a href="#orga8a3d0c">Subsystems</a></li>
<li><a href="#org541fdf7">Words</a></li>
<li><a href="#orgf86b28a">Bits and fields</a></li>
<li><a href="#org5695711">Memory</a></li>
<li><a href="#orgca9571c">Registers</a>
<ul>
<li><a href="#org23d5c87">Register file</a></li>
<li><a href="#org11d7716">Instruction control registers</a></li>
<li><a href="#org764cdbf">System control registers</a></li>
<li><a href="#orgec2bb76">Interrupts and exceptions</a></li>
</ul>
</li>
<li><a href="#org3ac2ced">Instruction representation</a>
<ul>
<li><a href="#org7b2ef9e">RRR format</a></li>
<li><a href="#orgb15c99b">RX format</a></li>
<li><a href="#orge7e6c57">EXP format</a></li>
<li><a href="#org70a0567">EXP3 format</a></li>
</ul>
</li>
<li><a href="#sec-instruction-set">Instructions</a>
<ul>
<li><a href="#orgf1e81d1">Arithmetic</a></li>
</ul>
</li>
<li><a href="#org9add3e3">Memory</a></li>
<li><a href="#orgf5df672">Registers</a>
<ul>
<li><a href="#orge1ad717">Register file</a></li>
<li><a href="#org5c108b0">Instruction control registers</a></li>
<li><a href="#org8966926">System control registers</a></li>
<li><a href="#org5741e77">Interrupts and exceptions</a></li>
</ul>
</li>
<li><a href="#org84488cf">Instruction representation</a>
<ul>
<li><a href="#org3c6e609">RRR format</a></li>
<li><a href="#org243f765">RX format</a></li>
<li><a href="#org27d015b">EXP format</a></li>
<li><a href="#org503db1d">EXP3 format</a></li>
</ul>
</li>
<li><a href="#sec-instruction-set">Instructions</a>
<ul>
<li><a href="#orgb4d11c9">Arithmetic</a></li>
<li><a href="#org922633e">Memory</a></li>
<li><a href="#org5321f2e">Logic and bits</a></li>
</ul>
</li>
<li><a href="#org4434bdd">Assembly language instruction formats with examples</a></li>
<li><a href="#org4fadd7c">Instruction set</a></li>
</ul>
</li>
<li><a href="#org4d90adc">Sigma32 Architecture reference</a></li>
<li><a href="#orgb702f85">Assembly language reference</a>
<ul>
<li><a href="#org19cfbba">Assembly language statement formats</a></li>
<li><a href="#org9882d78">Programs, modules, and files</a></li>
<li><a href="#org5db3993">Values</a>
<ul>
<li><a href="#org3335b69">Expressions</a></li>
<li><a href="#orgf468e46">Location counter</a></li>
<li><a href="#org3bc5934">Attributes</a></li>
</ul>
</li>
<li><a href="#org07e5793">Code statements</a>
<ul>
<li><a href="#orgf220ad6">Instructions</a></li>
<li><a href="#org890b99d">data</a></li>
</ul>
</li>
<li><a href="#org6a62764">Directives</a>
<ul>
<li><a href="#org908f58f">module</a></li>
<li><a href="#org693afdf">equ</a></li>
<li><a href="#orgbfaea7c">block</a></li>
<li><a href="#orgd0b7833">org</a></li>
<li><a href="#orga1a5997">import</a></li>
<li><a href="#org5d351a2">export</a></li>
</ul>
</li>
<li><a href="#org53efa29">Summary of assembly language statements</a></li>
</ul>
</li>
<li><a href="#org3a58f9c">User interface</a>
<ul>
<li>
<ul>
<li><a href="#org0cbb1b5">Files and modules</a></li>
<li><a href="#orgf9aefb5">Simple standalone programs</a></li>
<li><a href="#org058a4be">Programs with multiple modules</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-linker">Linker</a>
<ul>
<li><a href="#orgc5be0ec">Object language</a>
<ul>
<li><a href="#org8cc1a74">Statement syntax</a></li>
<li><a href="#org8d6dea2">module</a></li>
<li><a href="#org7502084">org</a></li>
<li><a href="#org85bae53">data</a></li>
<li><a href="#org78c5240">import</a></li>
<li><a href="#org976d15b">export</a></li>
<li><a href="#org8b40026">relocate</a></li>
</ul>
</li>
<li><a href="#org4aa49c7">Module metadata</a></li>
<li><a href="#org6f553de">Linker</a></li>
<li><a href="#org68cdebe">Loader</a>
<ul>
<li><a href="#org05ba571">Executable code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-programming">Programming</a>
<ul>
<li><a href="#org79cd4c4">Structure of a program</a></li>
<li><a href="#org6e0aff3">How to perform commmon tasks</a>
<ul>
<li><a href="#org6f23f08">Using extract</a></li>
<li><a href="#org2fd04d2">Copying one register to another</a></li>
</ul>
</li>
<li><a href="#orga04609b">Compilation</a></li>
<li><a href="#org42db2c6">Errors: avoiding, finding, and fixing</a>
<ul>
<li><a href="#org724d028">Critical regions</a></li>
<li><a href="#org2710afc">Robust programming</a></li>
<li><a href="#org816d02c">Error messages</a></li>
<li><a href="#orgdf0b540">Runtime debugging</a></li>
<li><a href="#org43aa7ef">Breakpoints</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgca90b40">M1: a Sigma16 CPU circuit</a>
<ul>
<li><a href="#org4f6a4e1">Installation</a>
<ul>
<li><a href="#orgeca4f39">Download Sigma16</a></li>
<li><a href="#orgd896142">Install ghc</a></li>
<li><a href="#org2aeb25f">(Optional) Install node.js and configure shell commands</a></li>
</ul>
</li>
<li><a href="#org42252f2">Quick start</a>
<ul>
<li><a href="#org6e06c9f">Simulating a small circuit</a></li>
<li><a href="#org90acad0">Words as well as bits</a></li>
<li><a href="#org37a10d1">Incorporating test data in the driver</a></li>
<li><a href="#org259dcf5">Running a machine language program on the M1 CPU</a></li>
<li><a href="#org439d691">Using ghci</a></li>
</ul>
</li>
<li><a href="#org3d0b027">The hardware description language Hydra</a></li>
<li><a href="#org39a1fce">The M1 circuit</a>
<ul>
<li><a href="#org59c0c48">Files</a></li>
<li><a href="#org3e8c5c4">Core instructions implemented by M1</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org65df414">Installation</a>
<ul>
<li><a href="#org0796ebe">The processor circuit</a></li>
<li><a href="#org9cd719e">Installation</a>
<ul>
<li><a href="#org76e79f7">The easy way: running in browser with no installation</a></li>
<li><a href="#orgb21f51f">Features that require software installation</a></li>
<li><a href="#org837a85c">node: JavaScript</a></li>
<li><a href="#orga9eec13">npm: JavaScript packages</a></li>
<li><a href="#org89badab">ghc: Haskell</a></li>
<li><a href="#org501b263">cabal: Haskell packages</a></li>
<li><a href="#orgbbaea4a">Configuring the shell</a></li>
<li><a href="#org72808f2">Testing the installation</a></li>
<li><a href="#org8516090">Running the circuit simulator</a></li>
<li><a href="#org73afa37">Documentation</a></li>
<li><a href="#org5973177">Building Sigma16</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-about-sigma16">About Sigma16</a>
<ul>
<li><a href="#org92828ad">Copyright and license</a></li>
<li><a href="#org6dbb04b">In case of problems</a></li>
<li><a href="#org96e90c3">Typesetting notes</a>
<ul>
<li><a href="#org9469e25">svg</a></li>
<li><a href="#org5615f4e">svg the best way: inline include</a></li>
<li><a href="#org15dc8c2">Raw inline svg</a></li>
<li><a href="#orgc39d1fd">svg via org mode external link</a></li>
<li><a href="#org9ddb007">Using raw html to include image</a></li>
<li><a href="#org495e9ec">Embedding an object</a></li>
<li><a href="#org5943065">Asides</a></li>
<li><a href="#org2f7460b">Math in plain html</a></li>
<li><a href="#orgf1b36e3">Math mode</a></li>
<li><a href="#org85872d3">The best way: use tex2svg</a></li>
</ul>
</li>
<li><a href="#orgc5f1f74">Release notes</a>
<ul>
<li><a href="#orga12aa98">Version 3.4.0</a></li>
<li><a href="#orgd3efa44">Version 3.3.2, April 2021</a></li>
<li><a href="#org870010d">Version 3.2.3, development from April 2021</a></li>
<li><a href="#org212366e">Version 3.2.2, March 2021</a></li>
<li><a href="#org4f398ec">Version 3.2.1, February 2021</a></li>
</ul>
</li>
<li><a href="#org2e18f2e">Text of GPL3 License</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org59a061e" class="outline-2">
<h2 id="org59a061e">Introduction</h2>
<div class="outline-text-2" id="text-org59a061e">
<p>
Sigma16 is a computer architecture designed for research and teaching
in computer systems.  This application provides a complete environment
for experimenting with the architecture, including an editor,
assembler, linker, emulator, and an integrated development
environment.  There is a digital circuit that implements the
architecture, which is specified using the Hydra functional hardware
description language.  Hydra can simulate the circuit, and machine
language programs can run on both the emulator and the circuit.
</p>

<p>
The Sigma16 IDE (the main "app") is implemented in JavaScript and runs
in a web browser.  There are additional components to the system that
must be downloaded and run on a computer; these include a digital
circuit that implements the architecture and a high speed emulator.
You can run the IDE simply by clicking a link on the [Sigma16 Home
Page](<a href="https://jtod.github.io/home/Sigma16/">https://jtod.github.io/home/Sigma16/</a>).
</p>

<p>
This user guide is organised by topic, with chapters on the
architecture, the assembly language, the linker, and programming
techniques.  However, it's a good idea to begin with an overview of
how the whole system works, and to be able to write and run simple
programs, before delving into the details.  For a quick start, begin
with the tutorials, which show you how to enter and run a program and
how to use the programming environment.
</p>

<p>
This directory contains a digital circuits which is a full processor
for the Core subset of the Sigma16 architecture.  It also contains a
circuit simulator that will run the circuit.  You can make the circuit
boot a machine language program; as the circuit runs it will execute
the program.
</p>

<p>
&#x2013; M1 is a circuit "Machine 1" that implements the Core subset of
   Sigma16
</p>

<p>
&#x2013; HDL/Hydra is a functional computer hardware description language
   (HDL).  This is a text language that allows you to decribe digital
   circuits very precisely, and it also has the ability to simulate
   the circuits.  All the circuits in M1 are specified using Hydra.  A
   copy of Hydra in included in Sigma16/src/circuits.  This means you
   don't need to download and install Hydra, and it ensures that the
   version of Hydra is compatible with the other software toolss.
</p>

<p>
&#x2013; Sigma16 is a folder containing sofware tools that can read and
   parse object files produced by the Sigma16 assembler.  This data is
   used to provide inputs to the circuits
</p>

<p>
The commands should be executed from within the circuits directory;
this enables ghc to find the source files.
</p>

<p>
The assembler reads in a source file (e.g. Add.asmltxt).  It writes
out several files: the machine language code (Add.obj.txt), the
assembly listing file (Add.lst.txt), and a metadata file (Add.md.txt).
You can ignore the metadata file, but it's worth looking at the obj
and lst files.  The object code file Add.obj.txt contains the actual
machine language program which the circuit can execute.
</p>

<p>
Naturally, if you modify the Sigma16 assembly language program, you
need to assemble it again before running the machine language on the
circuit.
</p>

<p>
When you run a program in ghci with :main Simple/Add, the program is
not being emulated.  The M1 circuit is a digital circuit consisting of
logic gates and flip flops, and nothing else.  This circuit is
relatively large and complex, and it is actually a full CPU for the
Sigma16 Core instruction set architecture.  The simulation tools read
in the machine language (from Add.obj.txt) and store it into the
memory, and the circuit then executes the program.
</p>

<p>
In the commands, you just specify the file basename "Add".  The
assembler will automatically append ".asm.txt", and the interface to
the circuit simulator will automatically append ".obj.txt".
</p>
</div>
</div>


<div id="outline-container-orgbbc4af8" class="outline-2">
<h2 id="orgbbc4af8">Tutorials</h2>
<div class="outline-text-2" id="text-orgbbc4af8">
<p>
The following short tutorials introduce the system; full details
appear in later sections.  You can keep the tutorials visible in the
right panel while following along with the exercises in the main
panel.
</p>
</div>

<div id="outline-container-sec-core-tutorial" class="outline-3">
<h3 id="sec-core-tutorial">Core architecture tutorial</h3>
<div class="outline-text-3" id="text-sec-core-tutorial">
</div>

<div id="outline-container-org0443f92" class="outline-4">
<h4 id="org0443f92">Hello, world!</h4>
<div class="outline-text-4" id="text-org0443f92">
<p>
To launch the program, visit the Sigma16 Home Page and click on the
link to run it.  No download or installation is necessary.
</p>

<p>
The main window contains two main sections.  The largest area, on the
left side, is the <b>main working area</b>.  When the program launches,
this will show the Welcome page.  The <b>user guide</b> is on the right
side.  At the top is a row of buttons (Welcome, Examples, etc.).
These select which page is displayed in the main working area.
</p>

<p>
It's convenient to see the main working area and the user guide side
by side.  Begin by resizing the entire window (bigger is better).
Then you can change the amount of space given to the user guide by
clicking the arrow symbols on the right side of the top button bar.
These arrows will expand or shrink the user guide: the small arrows
adjust by one pixel, the larger arrows by ten pixels.  If you resize
the entire browser window, Sigma16 will maintain the same relative
sizes of the main working area and the user guide sections.
</p>

<p>
You can also open the User Guide in a separate browser tab or window.
The Welcome page contains a link to do this.
</p>

<p>
A good way to get started is to go through the entire process of
running a simple program called <b>Hello, world!</b>.  For now, we focus
just on how to use the software tools to run the program; an
explanation of the Sigma16 architecture and what the statements mean
will come later.
</p>

<p>
The main working area has several pages, with buttons at the top to
switch between them:
</p>

<ul class="org-ul">
<li><b><b>Welcome</b></b> contains some introductory information, release notes,
and links.</li>

<li><b><b>Examples</b></b> contains a collection of assembly language programs
organized by topic.  The simplest examples just use the core part of
the architecture, while the advanced examples use additional
features.</li>

<li><b><b>Modules</b></b> shows a summary of all the files and modules you
currently have open.  It also provides buttons allowing you to open
files, close them, and select one to work on.</li>

<li><b><b>Editor</b></b> shows the selected module, where it can be edited.  You
can assemble and execute the selected module.  To run a program,
you'll load it into the Editor (there are several ways to do this),
then assemble it and then run it.</li>

<li><b><b>Assembler</b></b> translates a program from assembly language to machine
language, and shows the assembly isting as well as the object code.</li>

<li><b><b>Linker</b></b> combines a collection of object code modles into a single
executable program.</li>

<li><b><b>Processor</b></b> shows the components of the architecture and executes
machine language programs.</li>
</ul>

<p>
Let's begin by running a simple example program.
</p>

<ul class="org-ul">
<li>Click <b><b>Editor</b></b>, then <b><b>Hello, world!</b></b>.  This will enter a small
assembly language program into the editor window.  Later, we'll load
some of the more complex example programs into the editor, and you
can also modify a program or type in a new one from scratch.</li>

<li>Click <b><b>Assembler</b></b> and then the <b><b>Assemble</b></b> button.  This
translates the program in the Editor page from assembly language to
machine language.  The <b><b>Show Listing</b></b> button displays the result
of the translation, including any error messages.  The <b><b>Show
object</b></b> button displays the object code, which is the machine
language program produced by the translation.</li>

<li>For this simple example, we don't need the Linker, so you can skip
it.  The linker is needed for larger and more complex programs with
multiple modules, or with external references, or that need
relocation.</li>

<li>Click <b><b>Processor</b></b>, which shows the main components of the computer
architecture, including registers and memory.  These components are
explained later.  For now, just note that this page is where you can
run programs using the emulator.</li>

<li>Still on the Processor page, click <b><b>Boot</b></b>.  This reads the machine
language program into the memory, and you can see it in the Memory
display.  The source code (the assembly language) appears in the
bottom section.</li>

<li>Click <b><b>Step</b></b>.  The processor executes a single instruction and
displays the effects on the registers and memory: blue for using a
value, and red for modifying it.  The assembly listing shows the
instruction that just executed by highlighting it in red.  It also
shows the instruction that will execute next by highlighting it in
blue.  This is just to make it easier to follow what is happening;
the actual machine ignores the assembly language listing and doesn't
even "know" that it exists.</li>

<li>Click Step repeatedly to watch the program execute, instruction by
instruction.  When the program terminates, the small window labelled
<b><b>Emulator</b></b> will display Halted.</li>

<li>To rerun the program, click Boot again.</li>
</ul>

<p>
To run the program slowly, click Step repeatedly.  To run the program
faster but without updating the display after each instruction, click
Run.  At any time you can click Pause to stop the processor, and you
can resume execution with either Step or Run.  Sometimes it's useful
to let the processor run at full speed until it reaches a particular
instruction, and then stop.  This can be done by setting a
<b>breakpoint</b> (described in the Programming section).
</p>

<p>
There are two independent views into the memory; this is convenient
for looking at the machine language code in one view and the data in
the other view.  (Despite the two views, there is just one memory!)
At this point the pc register contains 0, meaning that the next
instruction to be executed is the one in memory location 0.  The ir
and other registers also contain 0, but that is just the initial
value.
</p>

<p>
To exit the app, just close the browser window or tab.  This may
put up a dialogue box warning that any unsaved data may be lost and
asking you to confirm.
</p>
</div>
</div>

<div id="outline-container-orgfde8b9e" class="outline-4">
<h4 id="orgfde8b9e">Registers, constants, and arithmetic</h4>
<div class="outline-text-4" id="text-orgfde8b9e">
<p>
The architecture has a <b><b>register file</b></b> which is an array of 16
registers, named R0, R1, R2, &#x2026;, R15.  The Register File is displayed
in a box on the Processor page.
</p>

<p>
A register is a circuit that can hold a number, and the elements of
the register file can be used to hold variable values.  They are
analogous to the registers in a calculator: think of each register as
a box that can hold a number, and think of the register name as a
variable name.
</p>

<p>
A computer program is a sequence of <b><b>instructions</b></b>.  Instructions
are similar to statements in a programming language, except that they
are simpler.
</p>

<p>
Sigma16 performs arithmetic on data in registers.  To do any
computation on some numbers, we first need to get those numbers into
registers.  To place a constant into a register, use the lea
instruction.  In the assembly language we use the <b><b>lea</b></b> instruction.
For example, to load 42 into register 3, write
</p>

<pre class="example" id="org9b5086b">
lea  R2,42[R0]   ; R2 := 42
</pre>

<p>
This is a statement in <b><b>assembly language</b></b>, and it describes one
instruction.  The operation is <b><b>lea</b></b>, the operands are <b><b>R2,9[R0]</b></b>,
and the part after the semicolon is a comment.
</p>

<p>
The word <b>lea</b> is the <b>operation</b>, i.e. the name of the instruction.
The operandd field consists of two operands separated by a comma.  The
first operand (R2) is called the <b>destination</b>; this is the register
where the result will be placed.  The second operand is a constant
(42) followed by [R0].  When the computer executed this instruction,
it simply places the constant into the destination.  In a higher level
language, we could write <b>R2 := 42</b>.    
</p>

<p>
Most instructions follow a similar pattern, where the first operand is
the destination where the result is placed, and the subsequent
operands are the arguments to the computation.  This is the same
convention used in assignment statements in many programming
languages: the registers in sub R1,R2,R3 appear in the same order as
the variables in R1 := R2-R3.
</p>

<p>
For now, just ignore the <b><b>[R0]</b></b> part.  It's optional: you can omit
it or include it.  The [R0] has a purpose but that won't become clear
until later.  Also, the name "lea" may look odd, but this also has a
meaning that will become clear later.
</p>

<p>
All arithmetic operations take place in the registers, and there is a
separate instruction for each operation.  For example, the following
instruction will add the values in R8 and R1 and then put the result
into R4:
</p>

<pre class="example" id="orgc8dfb7b">
add   R4,R8,R1  ; R4 := R8 + R1
</pre>

<p>
Notice that the operand field doesn't use operators like := or +;
instead it just separates the registers with commas.  The first
operand (R4 in this example) is the <b>destination</b>, which is where the
result will be placed.  The last two operands (R8 and R1) are the
values that will be added.
</p>

<p>
To perform a calculation, need to get the data into registers (using
lea) and then perform the calculation (using arithmetic instructions).
The following program calculates 3+4:
</p>

<pre class="example" id="orgf6d63f9">
lea   R5,3[R0]    ; R5 := 3
lea   R8,4[R0]    ; R8 := 4
add   R2,R5,R8    ; R2 := R5 + R8 = 3+4 = 7
</pre>

<p>
It's a good idea to use comments to explain the meaning of an
instruction.  For now, comments like "R4 := R8 + R1" will be used to
show what the instruction does. That's useful while learning what the
instructions do, but later on we will use comments to give more
meaningful information (for example, what do the values in the
registers mean, and why are we adding them?).
</p>

<p>
There are three more arithmetic instructions.  These follow the same
pattern as add: in each case, the arithmetic is performed on the last
two registers and the result is placed in the destination (the first
register):
</p>

<pre class="example" id="org26d3bd2">
add  R4,R11,R0   ; R4 := R11 + R0
sub  R5,R2,R13   ; R5 := R2 - R13
mul  R2,R10,R7   ; R2 := R10 * R7
div  R5,R6,R12   ; R5 := R6 / R12, R15 := R6 rem R12
</pre>

<p>
The divide instruction is slightly different: it produces two results,
the quotient and the remainder.  The quotient is placed in the
destination, but the remainder is automatically placed into R15, even
though the instruction doesn't mention R15.  (What happens if you
write <b>div R15,R1,R2</b>?  In that case the quotient is placed into R15
and the remainder is discarded.)
</p>

<p>
Normally an arithmetic instruction will put a new value into the
destination register, but the operand registers are left unchanged.
However, what happens if one of the operands is the same as the
destination, for example <b>add R7,R7,R8</b>?
</p>

<p>
An arithmetic instruction proceeds in three phases: (1) obtain the
values in the operand registers; (2) perform the arithmetic on those
values; and (3) put the result into the destination, discarding
whatever value was previously there.  So consider this example:
</p>

<pre class="example" id="orgec5b5d4">
lea   R7,20[R0]  ; R7 := 20
lea   R8,30[R0]  ; R8 := 30
add   R7,R7,R8   ; R7 := R7 + R8
</pre>

<p>
After the two lea instructions have executed, R7 contains 20 and R8
contains 30.  The add instruction does the following:
</p>

<ol class="org-ol">
<li>It fetches the values in R7 and R8, obtaining 20 and 30</li>
<li>It adds the values, obtaining the result 50</li>
<li>It puts the result 50 into the destination R7, discarding the
previous value.</li>
</ol>

<p>
The final result is that R7 contains 50.
</p>

<p>
Constant data can be specified using either decimal or hexadecimal
notation.
</p>

<ul class="org-ul">
<li>Decimal numbers are written as strings of digits, optionally
preceded by a minus sign: 3,-19, 42.</li>

<li>Hexadecimal numbers are always written as four hex digits, and in
assembly language programs they are indicated by putting $ before
the number.  Thus $00a5 and 0165 both represent the integer 165.</li>
</ul>

<pre class="example" id="org1dd1cfb">
lea   R1,13[R0]     ; R1 =  13 (hex 000d)
lea   R2,$002f[R0]  ; R2 := 47 (hex 002f)
lea   R3,$0012[R0]  ; R3 := 18 (hex 0012)
lea   R4,0012[R0]   ; R4 := 12 (hex 000c)
</pre>

<p>
The processor page shows numbers as hex without the leading $, but in
an assembly language program the $ is needed to avoid ambiguity.
</p>

<p>
Notice that Sigma uses := as the assignment operator; thus we write R7
:= R7 + R8 (and we don't write R7 = R7 + R8).  This is because an
assignment statement is profoundly different from an equation, and
mathematicians have long used the = operator to indicate equations.
It isn't just an academic or theoretical point; there have been plenty
of occasions where computer programmers get confused between
assignment and equality, and using the wrong operator doesn't help.
</p>

<p>
Why does assembly language use a notation like add R5,R2,R3 instead of
R5 := R2 + R3?  In short, every instruction will use a similar
notation: a keyword for the operation, followed by the operands
separated by commas.  This notation is also related closely to the way
instructions are represented in memory, which we'll see later
</p>

<p>
An arithmetic instruction performs just one operation.  Several
instructions are needed to evaluate a larger expression.  In general,
you'll need a separate instruction for every operator that appears in
an expression.
</p>

<p>
Example: calculate 3 + 4 * 5 and put the result into R10.  We have to
put the numbers into registers, using lea, and then perform the
arithmetic.  It doesn't matter which registers are used (as long as we
avoid R0 and R15).
</p>

<pre class="example" id="org9186dfc">
lea  R1,3[R0]   ; R1 := 3
lea  R2,4[R0]   ; R2 := 4
lea  R3,5[R0]   ; R3 := 5
mul  R2,R2,R3   ; R2 := R2*R3  = 4*5
add  R10,R1,R2  ; R10 := R1 + R2 = 3 + 4*5 = 23
</pre>

<p>
This is nearly enough to constitute a complete program.  Only one more
thing is needed: a way to terminate the program when it finishes.
There is a special instruction to do this:
</p>

<pre class="example" id="org675d470">
trap  R0,R0,R0   ; halt
</pre>

<p>
Try running this program.  You can go to the Editor and type it in,
but this program is part of the collection of examples built in to
Sigma16.  Here's how to run it:
</p>

<ul class="org-ul">
<li>Go to the Examples page.  Click Examples, then Basic examples, then
Small and simple programs, then ConstArith.  You should see the
listing of the program.</li>
<li>Click Editor, and you should see the text of the program in the
window.</li>
<li>Go to the Assembler page.  Click Assemble.</li>
<li>Go to the Processor page.  Click Boot, then Step repeatedly and
watch the effect of each instruction by observing how the registers
and memory are changed.</li>
</ul>

<p>
It's a good idea to step through the program slowly, rather than
running it to completion at full speed.  The emulator will show the
next instruction to be executed, highlighted in blue.  Think about
what the instruction should do; in particular what changes to the
registers will occur?  Then click Step and check to see if the right
thing happened.  Note that the emulator displays all values in
hexadecimal notation.  (Tip: this is a good way to debug programs!)
</p>

<p>
Generally you can use any register you like, and the choices of
registers in the previous examples are arbitrary.  Registers R1
through R14 are all the same.  However, two of the registers are
different:
</p>

<ul class="org-ul">
<li>R0 contains the constant 0 and it will never change.  Any time an
instruction uses R0, the value it gets will be 0.  It is legal for
an instruction to attempt to modify R0 (for example, add R0,R3,R4 is
legal) but after executing this instruction R0 still contains 0.
The reason for this is that we frequently need to have access to a
register containing 0.</li>

<li>R15 is used for two specific purposes.  We have already seen the
first: the divide instruction places the remainder into R15.  The
second purpose is that R15 contains the <b>condition code</b>, which is a
word that contains a number of bits that provide some information
about an instruction.  For example, if an addition produces a result
that is too large to fit in a register, a special flag indicating
this is set in R15.  Many of the instructions, including all the
arithmetic instructions, change the value of R15 as well as placing
the result in the destination register.  For this reason, R15 cannot
be used to hold a variable: its value would be destroyed almost
immediately.</li>
</ul>

<p>
To summarise, Registers R1 through R14 are all identical and can be
used for variables.  R0 contains 0 and will never change.  R1 changes
very frequently and can be used to determine various error conditions
and other information about an instruction.
</p>

<p>
Example
</p>

<ul class="org-ul">
<li>Suppose we have variables a, b, c, d</li>
<li>R1=a, R2=b, R3=c, R4=d</li>
<li>We wish to compute R5 = (a+b) * (c-d)</li>
</ul>

<pre class="example" id="orga192579">
add   R6,R1,R2     ; R6 := a + b
sub   R7,R3,R4     ; R7 := c - d
mul   R5,R6,R7     ; R5 := (a+b) * (c-d)
</pre>

<p>
Summary.
</p>

<ul class="org-ul">
<li>A lea instruction of the form <b>lea d,const[R0]</b> will put the
constant into Rd.</li>
<li>The general form of an arithmetic instruction is <b>op d,a,b</b>.  
The meaning is <b>R<sub>d</sub> := R<sub>a</sub>  op  R<sub>b</sub></b>, and the fields are:</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">op</td>
<td class="org-left">operation: add, sub, mul,div</td>
</tr>

<tr>
<td class="org-left">d</td>
<td class="org-left">destination register: where the result goes</td>
</tr>

<tr>
<td class="org-left">a</td>
<td class="org-left">first operand register</td>
</tr>

<tr>
<td class="org-left">b</td>
<td class="org-left">second operand register</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgfe945bd" class="outline-4">
<h4 id="orgfe945bd">Keeping variables in memory</h4>
<div class="outline-text-4" id="text-orgfe945bd">
<p>
So far we have used registers in the register file to hold variables.
However, there are only 16 of these, and two have special purposes (R0
and R15).  That leaves only 14 registers, and most programs need more
than 14 variables.
</p>

<p>
The computer contains another subsystem called the <b>memory</b>.  This is
similar in some ways to the register file.  The memory contains a
sequence of <b>memory locations</b>, each of which can hold a word.  Each
location is identifed by an <b>address</b>, and the addresses count up from
</p>
<ol class="org-ol">
<li>We will use the notation <b>mem[a]</b> to denote the memory location</li>
</ol>
<p>
with address a
</p>

<ul class="org-ul">
<li>The register file is used to perform calculations.  In computing
something like x := (2*a + 3*b) / (x-1), all the arithmetic will be
done using the register file.  But there are only a few registers
available.</li>

<li>The memory is much larger: it contains 65,536 locations so it can
hold all the variables in a program.  But the memory has a
limitation: the computer cannot do arithmetic directly on data in
the memory.</li>
</ul>

<p>
A variable name refers to a word in memory.  Actually, the variable
name just stands for the address of the location which contains the
variable.  This allows you to refer to a variable by a name (x, sum,
count) rather than an address (003c, 0104, 00d7).
</p>

<p>
Since we need a lot of variables, they need to be kept in memory.  But
since we need to do arithmetic and arithmetic can be performed only on
data in registers, we adopt the following strategy:
</p>

<ul class="org-ul">
<li>Keep data permanently in memory</li>
<li>When you need to do arithmetic, copy a variable from memory to a
register</li>
<li>When finished, copy the result from a register back to memory</li>
</ul>

<p>
Two instructions are needed to do this:
</p>
<ul class="org-ul">
<li><b>load</b> copies a word from a memory location into a register.
Suppose <b>xyz</b> is a variable in memory; then to copy its value into
R2 we could write <b>load R2,xyz[R0]</b></li>
<li><b>store</b> copies a word from a register into a memory location.  If R3
contains the result of some calculations, and we want to put it back
into memory in a varaible named result, we would write <b>store
R3,result[R0]</b></li>
</ul>

<p>
It's necessary to write [R0] after the variable name, similarly to
writing [R0] after the constant in a lea instruction.  Again, the
reason for that will be explained later but for now just treat it as
an arbitrary rule.
</p>

<p>
At this point we have enough instructions to write an assignment
statement in assembly language.  Typically we will first write an
algorithm using higher level language notation, and then translate it
into instructions.
</p>

<p>
The problem: translate <b>x := a+b+c</b> into assembly language.
</p>

<p>
Solution:
</p>

<pre class="example" id="org1e07894">
load   R1,a[R0]      ; R1 := a
load   R2,b[R0]      ; R2 := b
add    R3,R1,R2      ; R3 := a+b
load   R4,c[R0]      ; R4 := c
add    R5,R3,R4      ; R5 := (a+b) + c
store  R5,x[R0]      ; x := a+b+c
</pre>

<p>
Why do we have registers and memory?  After all, this makes
programming a little more complicated.  You have to keep track of
which variables are currently in registers, and you have to use load
and store instructions to copy data between the registers and memory.
Wouldn't it be easier just to get rid of the distinction between
registers and memory, and do all the arithmetic on memory?
</p>

<p>
Yes, this would be simpler.  Furthermore, it's possible to design a
computer that way, and there have actually been real computers like
that.  However, this approach makes the computer very much slower.
With modern circuits, a computer without load and store instructions
(where you do arithmetic on memory locations) would run approximately
100 times slower.  So nearly all modern computers do arithmetic in
registers, and use instructions like load and store to copy data back
and forth between registers and memory.
</p>

<p>
The variables used in a program need to be defined and given an
initial value.  This is done with the <b>data</b> statement.  The variable
name comes first, and it must start at the beginning of the line (no
space before it).  Then comes the keyword <b>data</b>, followed by the
initial value, which may be written in either decimal or hexadecimal.
</p>

<p>
For example, to define variables x, y, z and give them initial values:
</p>

<pre class="example" id="org4693f8c">
x    data   34    ; x is a variable with initial value 34
y    data    9    ; y is initially 9
z    data    0    ; z is initially 0
abc  data  $02c6  ; specify initial value as hex
</pre>

<p>
The data statements should come <b>after</b> all the instructions in the
program.  This may look surprising: in some programming language you
have to declare your variables at the beginning, before using them.
There is a very good reason why we will put the instructions first,
and the data statements after; but again the reason will come later.
</p>

<p>
There is a simple example of a complete program that uses load, store,
and data statement.  The text is given below, but you don't need to
type it in.
</p>

<ul class="org-ul">
<li>Go to the Examples page.  Click Core, then Simple, then Add.  You
should see the listing of the program.</li>
<li>Click Copy example to editor</li>
<li>Click Editor, and you should see the text of the program in the
window.</li>
<li>Go to the Assembler page.  Click Assemble.</li>
<li>Go to the Processor page.  Click Boot, then Step repeatedly and
watch the effect of each instruction by observing how the registers
and memory are changed.</li>
</ul>

<pre class="example" id="org6d9dd67">
; Program Add.  See Sigma16/README.md in top folder
; A minimal program that adds two integer variables

; Execution starts at location 0, where the first instruction will be
; placed when the program is executed.

      load   R1,x[R0]   ; R1 := x
      load   R2,y[R0]   ; R2 := y
      add    R3,R1,R2   ; R3 := x + y
      store  R3,z[R0]   ; z := x + y
      trap   R0,R0,R0   ; terminate

; Expected result: z = 37 (0025)

; Static variables are placed in memory after the program

x     data  23
y     data  14
z     data   0
</pre>

<ul class="org-ul">
<li>Assembly language</li>
</ul>

<p>
The programs shown here are written in <b>assembly language</b>.  The
machine itself executes programs in <b>machine language</b>, which is
covered later.  Assembly language is translated to machine language by
a program called an <b>assembler</b>.
</p>

<p>
The purpose of assembly language is to give the programmer absolute
control over the machine language code without having to remember lots
of numeric codes.  For example, it is easier to remember the name
"mul" for multiply than to remember the machine language code (which
happens to be 3).  Similarly, it's easier to remember the names of
variables (x, y, sum, total) than the numeric addresses of the memory
locations that hold these variables.
</p>

<p>
The syntax of assembly language is simple and rigid.  Every statement
must fit on one line of source code; you cannot have a statement that
spans several lines, and you cannot have several statements on one
line.
</p>

<p>
Sigma16 assembly language uses a small set of characters.  Any
character not on this list will generate an error message.  A Sigma16
program can <b>manipulate</b> any 16-bit character, but the source assembly
language code is restricted to this source character set.  There are
many characters that look similar but are actually distinct.  For
example, the minus sign, the hyphen, the en-dash, and the em-dash all
look similar &#x2013; you have to look really closely to see the difference
&#x2013; but Sigma16 assembly language uses the minus sign, and the hyphens
and dashes won't work.
</p>

<ul class="org-ul">
<li>letters: _abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ</li>
<li>digits: 0123456789</li>
<li>separators: (space) (tab) ,;</li>
<li>quotes: " '</li>
<li>punctuation: ".$[]()+-*</li>
<li>other: ?¬£`&lt;=&gt;!%^&amp;{}#~@:|/\'</li>
</ul>

<p>
Word processors often substitute characters.  For example, when you
type a minus sign in a paragraph of English text, word processors may
replace the minus sign with a hyphen or dash, which is correct for
typeset English but incorrect for assembly language.  The Sigma16
editor will insert the correct characters, as will plain text editors.
</p>

<p>
Each statement has a rigid format that consists of up to four
<b>fields</b>.  The fields must be separated by one or more spaces, and a
field cannot contain a space.  Every field is optional, but if a field
is missing then the following fields must also be missing, except for
an optional comment.  The fields are:
</p>

<ul class="org-ul">
<li>label (optional) &#x2013; If present, the label must begin in the first
character of the line.  If a line starts with a space, then there is
no label field.  A label has the same syntax as names or identifiers
in many languages: it may contain letters, digits, underscores, and
must begin with a letter.  Both upper and lower case letters are
allowed, and they syntax is case sensitive (Loop and LOOP and loop
are three different labels).</li>

<li>mnemonic &#x2013; This is the name of the operation: load, lea, add, sub,
etc.  The mnemonic must be preceded by white space, and it must be
the name of a valid instruction or assembler directive.</li>

<li>operands field &#x2013; the operands required by the type of statement.
There are several formats possible for the operands field, depending
on the instruction; these are detailed later.  For example, for the
add instruction the operand field must consist of three registers,
separated by commas (e.g. R1,R2,R3).  Spaces are not allowed in the
operands field: R1,R2,R3 is fine but R1, R2, R3 is an error.</li>

<li>comments &#x2013; anything that follows the operands field, or anything
that appears after a semicolon, is a comment.  The semicolon is not
required if the mnemonic and operands fields are present, but it is
good practice to include it.</li>
</ul>

<p>
Here are some syntactically valid statements:
</p>
<pre class="example" id="org82614ca">
loop   load   R1,count[R0]    ; R1 = count
       add    R1,R1,R2        ; R1 = R1 + 1
</pre>

<p>
Each of the following statements is wrong!
</p>

<pre class="example" id="org336f689">
   add   R2, R8, R9    ; spaces in the operand field
loop1  store x[R0],R5  ; wrong order: should be R5,x[R0]
    addemup            ; invalid mnemonic
 loop2  load R1,x[R0]  ; Space before the label
    load R6,x          ; should be x[R0]
</pre>

<p>
If you forget some detail, look at one of the example programs
</p>

<p>
When the assembler is translating a program, it begins by looking at
the spaces in order to split each statement into the four fields.
This happens before it looks at the operation and operands.  The
assembly listing uses colors to indicate the different fields.  If you
get a syntax error message, the first thing to check is that the
fields are what you intended.  For example if you meant to say
</p>

<pre class="example" id="orgaa3fce8">
add R1,R2,R3  ; x := a + b
</pre>

<p>
but you have a spurious space, like this
</p>

<pre class="example" id="orgff9abbf">
add R1, R2,R3  ; x := a + b
</pre>

<p>
the assembler will decide that the mnemonic is add, the operands field
is "R1," and all the rest - "R2,R3 ; x := a + b" &#x2013; is a comment, and
the colors of the text in the assembly listing will show this clearly.
</p>

<p>
Writing constants
</p>

<p>
In assembly language, you can write constants in either decimal
or hexadecimal.
</p>

<ul class="org-ul">
<li>decimal:   50</li>
<li>hexadecimal: $0032</li>
</ul>

<p>
Examples:
</p>

<pre class="example" id="orgd47b16a">
   lea   R1,40[R0]      ; R1 = 40
   lea   R2,$ffff[R0]   ; R2 = -1

x  data  25
y  data  $2c9e
</pre>

<p>
Correct form of operand field
</p>

<ul class="org-ul">
<li>RRR: Exactly three registers separated by commas R8,R13,R0.</li>

<li>RX:Two operands: first is a register, second is an address.  The
address is a name or constant followed by [register]. Example:
R12,array[R6]</li>
</ul>




<p>
It isn't enough just to get the assembler to accept your program
without error messages.  Your program should be clear and easy to
read.  This requires good style.  Good style saves time writing the
program and getting it to work A sloppy program looks unprofessional.
Here are a few tips.
</p>

<p>
<b>Write good comments.</b> You should use good comments in all programs,
regardless of language.  But comments are even more important in
machine language, because the code tends to need more explanation.  At
the beginning of the program, use comments to give the name of the
program and to say what it does.  Use full line comments to say in
general what's going on, and put a comment on every instruction to
explain what it's doing.
</p>

<p>
<b>Indent your code consistently.</b> Each field should be lined up
vertically, like this:
</p>

<pre class="example" id="org15f26e4">
load   R1,three[R0]  ; R1 = 3
load   R2,x[R0]      ; R2 = x
mul    R3,R1,R2      ; R3 = 3*x
store  R3,y[R0]      ; y = 3*x
trap   R0,R0,R0      ; stop the program
</pre>

<p>
Not like this:
</p>

<pre class="example" id="org03cc4b5">
   load   R1,three[R0]     ; R1 = 3
 load  R2,x[R0] ; R2 = x
      mul R3,R1,R2           ; R3 = 3*x
store         R3,y[R0]      ; y = 3*x
  trap  R0,R0,R0      ; stop the program
</pre>

<p>
The exact number of spaces each field is indented isn't important;
what's important is to make the program neat and readable.
</p>

<p>
<b>Spaces, not tabs!</b> To indent your code, always use spaces &#x2013; avoid
tabs!  In general, never use tabs except in the (rare) cases they are
actually required.  The tab character was introduced long ago into
computer character sets to try to mimic the tab key on old mechanical
typewriters But software does not handle tab consistently.  If you use
tabs, your can look good in one application and like a mess in
another.  It's easy to indent with spaces, and it works everywhere!
</p>
</div>
</div>

<div id="outline-container-org420eab2" class="outline-4">
<h4 id="org420eab2">Files and modules</h4>
<div class="outline-text-4" id="text-org420eab2">
<p>
Whatever method you use to edit your programs, be sure to <b><b>save your
work to a file</b></b> from time to time.  If you don't do that, sooner or
later the system will crash and you'll lose your data.
</p>

<p>
A <b>module</b> is a section of a program; it may be the complete program
or just a part of it.  A module may be saved in a file or it may
simply be text in the editor buffer.  A program may consist of just
one module, or it can be split between several files (<b>not supported
yet, coming soon</b>).
</p>

<p>
The Editor page contains a text area called the <b>editor buffer</b>.  When
you launch Sigma16, there is one module whose text is empty and
displayed in the editor buffer.  You can type a program (to be
precise, a module) into the editor buffer.  When you switch to the
Assembler page, the Assemble button will translate the text in the
editor buffer to machine language, which you can execute on the
Processor page.
</p>

<p>
After entering a program in the editor buffer, you should save it to a
file.  Click <b>Save in downloads</b> and the text in the editor buffer
will be written to a file on your computer.  Depending on how the
system is configured, there may be a dialogue box asking you for a
file name, or a generic default file name may be used (for example,
"S16DownloadFile (2).txt" or something similar).  This file will be
saved in the default Downloads directory as configured in your
browser.
</p>

<p>
The reason there is limited control over the name of the saved file,
and the directory where it is placed, is that web browsers enforce
strict limitations on the ability of applications to access your file
system.  That's a very good feature of browsers &#x2013; you don't want a
random web page to start deleting or corrupting your files &#x2013; but it
does make it a little inconvenient to save your edited assembly
programs.
</p>

<p>
To create a new module without destroying the existing one, click
<b>New</b> in the editor page.  This will make a new module with empty text
and display that in the editor buffer, so any text you had there will
disappear.  However, that text isn't lost, it's just hidden, and to
get it back you just need to select the previous module.
</p>

<p>
The <b>Modules</b> page shows a list of all the modules and allows you to
select one to work on.  The modules are shown in small sections
separated by horizontal lines.  The modules are numbered starting from
0, so if there are n modules their numbers go from 0 to n-1.  For each
module, the module number is shown, followed by some buttons to
operate on that module, and some information about it.  The first few
lines of the module are shown.  If you follow good programming style,
where the first rew lines of each module identify what the program is,
you'll be able to see at a glance what each module is without visiting
it in the editor.
</p>

<p>
Several buttons appear for each module in the list.  At any time, one
of the modules is <b>selected</b>. Click the Select button for any module
to select that one.  The selected module number is highlighted in red,
and when you go to the Editor page the text of the selected module
appears in the editor buffer.  This means you can have several
programs open at the same time, and just switch from one to the other
using the Select buttons in the Modules page.
</p>

<p>
You can also get rid of a module by clicking its Close button.  This
will delete its text, so it may be a good idea to select it and
download it in the Editor before closing it.
</p>

<p>
So far we have just created new modules by clicking <b>New</b> (in either
the Editor page or the Modules page).  You can also read files on your
computer into Sigma16.  Click <b>Choose files</b> and a dialogue box will
pop up.  You can select one or more files, and these will now appear
in the list of modules.
</p>

<p>
If a module was created by reading it from a file, its entry in the
list contains an extra <b>Refresh</b> button.  Clicking this will reread
the file and you won't need to use the file chooser dialogue box
again.
</p>

<p>
Common workflows:
</p>

<ul class="org-ul">
<li>Just type your program into the editor buffer, and download it
frequently.</li>

<li>Use an external editor to enter your program.  After editing it, go
to the Editor page and click Clear, then copy the program from your
external editor and paste it into the editor buffer.  If you do
this, make sure that your external text editor doesn't change your
characters.  For example, word processors often change the minus
character (-) into an en-dash.  There are four different characters
that look similar to a minus sign (minus, hyphen, en-dash, em-dash)
and the assembly language only accepts the minus sign.  If you get
bad characters, the assembler will give an error message.</li>

<li>Use an external editor and save the file.  In the Editor page, click
Choose files and select your source file.  Then, every time you edit
the text in your external editor, save it and then click <b>Refresh</b>
on the module in the Modules page.  This way you don't need to
Download the editor buffer because your up-to-date text will be in
the external editor (but of course you have to save the file there).</li>
</ul>
</div>
</div>

<div id="outline-container-org2d9efea" class="outline-4">
<h4 id="org2d9efea">Jumps and conditionals</h4>
<div class="outline-text-4" id="text-org2d9efea">
<p>
Conditionals allow a program to decide which statements to execute
based on Boolean expressions.  One example is the if-then statement,
for example:
</p>

<pre class="example" id="org60e746b">
if x&lt;y
  then statement 1
statement 2
</pre>

<p>
A related form is the if-then-else statement:
</p>

<pre class="example" id="org44b6940">
if x&lt;y
  then statement 1
  else statement 2
statement 3
</pre>

<p>
Many high level control constructs can be translated into code that
contains just one form of conditional, which uses a Boolean expression
<i>bexp</i> to decide whether to jump to <i>someLabel</i>, or not to jump:
</p>

<pre class="example" id="org861f512">
if bexp then goto someLabel
</pre>

<p>
The commonest case is where <i>bexp</i> is a comparision between two integers:
</p>

<pre class="example" id="org467cfcd">
if x &lt; y then goto someLabel
</pre>

<p>
Any relational operation can be used; it isn't limited to less-than.
Such conditionals are implemented in assembly language in two steps.
First, a <b>comparison</b> instruction is used to produce a Boolean result,
which is placed in the <i>condition code</i>.  Second, a <b>conditional jump</b>
instruction will either jump or not jump, depending on the condition
code.  This allows a choice of what instruction to execute next.
</p>

<p>
The cmp instruction compares the integers in two registers, and it
sets R15 to the result of the comparison.  R15 is a special register
because several instructions, including cmp, use it automatically
without actually specifying R15 in the instruction.  Reflecting its
special status, R15 also has a name: it's called the <i>condition code</i>.
</p>

<p>
After setting the condition code with cmp, the program executes a
conditional jump.  These instructions have the form jumpXX, where XX
is a relation, such as lt, eq, and so on:
</p>

<pre class="example" id="org8f512da">
jumplt  someLabel[R0]  ; if &lt;  then goto someLabel
jumple  someLabel[R0]  ; if &lt;= then goto someLabel
jumpeq  someLabel[R0]  ; if =  then goto someLabel
jumpne  someLabel[R0]  ; if != then goto someLabel
jumpge  someLabel[R0]  ; if &gt;= then goto someLabel
jumpgt  someLabel[R0]  ; if &gt;  then goto someLabel
</pre>

<p>
These conditional jumps treat the contents of the registers as integers
represented in two's complement notation.  This means, for example,
that $ffff is less than 0, because $ffff represents -1.  There are
actually several more conditional jumps that you can use for comparing
natural numbers (binary), and a few other things as well.
</p>

<p>
Usually a compare instruction is used to set the condition code, and
it's followed by a conditional jump.  It is also possible to save the
result of a comparison in a Boolean variable, to perform logic on
Boolean varaibles, and to use them to control conditional jumps.
These topics are covered in Section ???.
</p>

<p>
The address in a jump instruction &#x2013; the place to jump to &#x2013; is
normally specified as a label which is defined in the label field of
some instruction.  You can place a label in the same line as the
instruction, or it can be on a line with nothing else, in which case
the label refers to the next instruction.  In the following code,
label1 is the address of the add instruction and label 2 is the
address of the sub instruction.
</p>

<pre class="example" id="orgf874e5c">
label1   add  R2,R4,R13
label2
         sub  R15,R0,R1
</pre>

<p>
If-then constructs are translated into assembly language following two
similar fixed patterns.  Suppose Bexp is a Boolean in any register Rd
</p>

<pre class="example" id="org5534b88">
if bexp
  then statement 1
statement 2
</pre>


<p>
This is translated according to the following pattern:
</p>


<pre class="example" id="org2e4df14">
     if !bexp then goto L1
     statement 1
L1:
     statement 2
</pre>


<p>
Her is an example:
</p>

<pre class="example" id="org8a38ae6">
a := 93
x := 35
y := 71
if y &gt; x then a := 59
b := 104
</pre>

<p>
The corresponding assembly language is:
</p>

<pre class="example" id="org9117302">
; a := 93
      lea     R1,93[R0]    ; R1 := 93
      store   R1,a[R0]     ; a := 93

; x := 35
      lea     R1,35[R0]    ; R1 := 35
      store   R1,x[R0]     ; x := 35

; y := 71
      lea     R1,71[R0]    ; R1 := 71
      store   R1,x[R0]     ; x := 71

; if y &gt; x
      load    R1,y[R0]     ; R1 := y
      load    R2,x[R0]     ; R2 := x
      cmp     R1,R2        ; compare y with x
      jumple  R3,skip[R0]  ; if not y &gt; x then goto skip

;  then a := 59
      lea    R1,59[R0]     ; R1 := 59
      store  R1,a[R0]      ; a := 59

; b := 104
skip  lea    R1,104[R0]    ; R1 := 104
      store  R1,b[R0]      ; b := 104
</pre>

<p>
Notice the use of jumple: if the Boolean expression (y&gt;x) is False we want to
skip over the "then" part, so we want to jump if y &lt;= x (hence jumple).
</p>

<p>
An if-then-else statement has a similar compilation pattern, but this
time there are two separate parts: the "then-part" and the
"else-part".  Depending on the value of the Boolean expression, one of
those parts should be executed and the other should be skipped over.
</p>

<p>
For if-then-else, and many other control constructs, we need an
<b>unconditional jump</b> which will always go to the specified address,
and which doesn't use a Boolean.
</p>

<pre class="example" id="org0e20d57">
jump   somewhere[R0]    ; go to somewhere
</pre>

<p>
The general form is
</p>

<pre class="example" id="org7c63395">
if x &lt; y
  then S1
  else S2
S3  
</pre>

<p>
The general if-then-else construct can be translated to use just goto
and conditional goto:
</p>

<pre class="example" id="org4269f4c">
    if x &gt;= y then goto L1
    S1
    goto L2
L1: S2
L2: S3
</pre>
</div>
</div>

<div id="outline-container-org2edcf96" class="outline-4">
<h4 id="org2edcf96">Loops</h4>
<div class="outline-text-4" id="text-org2edcf96">
<p>
Loops are implemented using compilation patterns based on comparisons
and jumps.  The fundamental form is the <b>while loop</b>.
</p>

<pre class="example" id="org745f834">
while Bexp do S1
S2
</pre>

<p>
The compilation pattern is:
</p>

<pre class="example" id="orge9169f9">
L1   if not Bexp then goto L2
     S2
     goto L1
L2
</pre>

<p>
Occasionally you may encounter an infinite loop, which is sometimes
expressed as a while loop:
</p>

<pre class="example" id="org85f9aae">
while true do S1
</pre>

<p>
This doesn't need a Boolean expression; it is simply compiled into:
</p>

<pre class="example" id="org0ff6f40">
loop
   instructions for S1
   jump   loop[R0] 
</pre>

<p>
Infinite loops are rather rare, or at least they should be.  On
occasion they are exactly what is wanted.  For example, operating
systems contain a loop that looks for something useful to do, and then
does it, and this should be an infinite loop.
</p>

<p>
However, there is a common but poor programming style that uses
infinite loops with random break or goto statements to get out of the
loop.  This may be appropriate on occasion but generally it is bad
style.
</p>

<p>
So far we have seen several compilation patterns:
</p>

<ul class="org-ul">
<li>if-then</li>
<li>if-then-else</li>
<li>while</li>
</ul>

<p>
Every high level programming construct has a compilation pattern, and
they are mostly built using comparisons and jumps.  In principle,
these patterns are straightforward to use.  However, there are two
issues that require a little care: uniqueness of labels and nested
statements.
</p>

<p>
Labels must be unique: the same one cannot be used twice in the same
program, and if it is, the assembler will give an error message.
This means that you cannot follow the compilation patterns blindly.
If you use "loop" as the label for a while loop, as in the pattern
above, you need a different label for your next while loop.
</p>

<p>
The best approach here is not to use labels like loop, loop1, loop2.
It's far better to think about the <b>purpose</b> of the construct in your
program and to use a label that reflects this purpose.
</p>

<p>
Another complication is that most programs contain <b>nested
statements</b>.  These are statements that contain smaller statements,
and the containment may go several levels deep.
</p>

<pre class="example" id="org41f4cd1">
if b1
  then S1
       if b2 then S2 else S3
       S4
  else S5;
       while b3 do S6
S7
</pre>

<p>
There is an important principle to follow here: every time a statement
appears in a compilation pattern (we have been calling them S1, S2,
S3, etc.), it should be translated as a <b>block</b>.
</p>

<p>
A block is a sequence of instructions which <b>always</b> begins execution
at the first instruction, and <b>always</b> finishes at the end.  You
<b>never</b> jump into the middle of it, and it <b>never</b> jumps out of the
middle to some other place.
</p>

<p>
Every statement should be compiled into a block of code.  This block
may contain internal structure &#x2014; it may contain several smaller
blocks &#x2014; but to execute it you should always begin at the beginning
and it should always finish at the end.
</p>

<p>
In programming language theory, programming with blocks is often
considered to be good practice or good style.  But it is more than
just an issue of style.  If you always treat the statements inside
compilation patterns as blocks, the patterns will "just work", no
matter how deeply nested they are.  If you violate the block
structure, you will find the program extremely difficult to get to
work.
</p>
</div>
</div>

<div id="outline-container-org951a2fa" class="outline-4">
<h4 id="org951a2fa">Machine language</h4>
<div class="outline-text-4" id="text-org951a2fa">
<p>
The actual bits representing an instruction (written in hex) (e.g
0d69) are <b>machine language</b>.  The actual hardware runs the machine
language &#x2014; it's just looking at the numbers.  The text notation with
names &#x2013; e.g. add R13,R6,R9 &#x2013; is called assembly language.  Assembly
language is for humans to read and write; machine language is for
machines to execute.  Both languages specify the program in complete
detail, down to the last bit
</p>

<p>
As a program is running, the memory contains all your program's data:
the variables, data structures, arrays, lists, etc.  <b>The memory also
contains the machine language program itself.</b> The program is stored
inside the computer's main memory, along with the data.  This concept
is called <b>the stored program computer</b>.
</p>

<p>
There is an alternative approach: a computer can be designed to have
one memory to hold the data, and a completely separate memory to hold
the program.  This approach is often used for special-purpose
computers (primarily micro-controllers), but experience has shown this
to be inferior for general purpose computers.
</p>

<p>
Instruction formats: different types of instruction
</p>

<p>
Sigma16 has several instruction formats
</p>

<ul class="org-ul">
<li>\alert{RRR} instructions use the \alert{registers}</li>
<li>\alert{RX} instructions use the \alert{memory}</li>
<li>\alert{EXP} instructions use \alert{registers and constant}</li>
</ul>

<p>
Each kind of instruction is called an instruction format.  All the
instructions with the same format are similar Each instruction format
has a standard representation in the memory.
</p>

<p>
The machine language program is in the memory So we need to represent
each instruction as a word An instruction format is a systematic way
to represent an instruction using a string of bits, on one or more
words.  Every instruction is either RRR, RX, or EXP
</p>

<ul class="org-ul">
<li>An RRR instruction is represented in one word (recall that a word is
16 bits).</li>
<li>An RX instruction is represented in two words.</li>
</ul>

<p>
Fields of an instruction word
</p>

<p>
An instruction word has 16 bits.  There are four fields, each 4 bits.
We write the value in a field using hexadecimal.  hex digits: 0, 1, 2,
3, 4, 5, 6, 7, 8, 9, a, b, c, d, e, f.  These correspond to 0, 1, &#x2026;,
15
</p>

<p>
The names of the fields are:
</p>

<ul class="org-ul">
<li>op &#x2013; holds the operation code</li>
<li>d  &#x2013; usually holds the destination register</li>
<li>a  &#x2013; usually holds the first source operand register</li>
<li>b &#x2013; usually holds the second source operand register</li>
</ul>

<p>
Representing RRR instructions
</p>

<p>
Every RRR instruction consists of
</p>

<ul class="org-ul">
<li>An operation (e.g. add)</li>
<li>Three register operands: a destination and two operands</li>
<li>The instruction performs the operation on the operands and
puts the result in the destination</li>
</ul>

<p>
Example: add R3,R12,R5.  We need to specify \alert{which} RRR
instruction this is.  Is it add? sub? mul? another?  This is done with
an operation code &#x2014; a number that says what the operation is.  There
are about a dozen RRR instructions, so a 4-bit operation code
suffices.  We also need to specify three registers: destination and
two source operands.  There are 16 registers, so a particular one can
be specified by 4 bits.  Total requirements: 4 fields, each 4 bits &#x2014;
total 16 bits.  An RRR instruction exactly fills one word.
</p>

<p>
All RRR instructions have the same form, just the operation
differs
</p>

<ul class="org-ul">
<li>add  R2,R2,R5     ; R2 = R2 + R5</li>
<li>sub  R3,R1,R3     ; R3 = R1 - R3</li>
<li>mul  R8,R6,R7     ; R8 = R6 * R7</li>
</ul>

<p>
In add R2,R5,R9 we call R5 the first operand, R9 the second operand,
and R2 the destination.  It's ok to use the same register as an
operand and destination!  Later we'll see some more RRR instructions,
obut they all have the same form as these do.
</p>

<p>
Here are the RRR operation codes:
</p>

<p>
 mnemonic   opcode
-----&#x2013;&#x2014; ---&#x2013;&#x2014;
 add        0
 sub        1
 mul        2
 div        3
 trap       d
</p>

<p>
Don't memorise this table!  You just need to understand how it's used.
</p>

<p>
Example of RRR:
</p>

<pre class="example" id="org4a2d937">
add  R13,R6,R9
</pre>

<ul class="org-ul">
<li>The opcode (operation code) is 0</li>
<li>Destination register is 13 (hex d)</li>
<li>Source operand registers are 6 and 9 (hex 6 and 9)</li>
<li>So the instruction is  0d69</li>
</ul>

<p>
Representing RX instructions
</p>

<p>
Every RX instruction contains two operands:
</p>

<ul class="org-ul">
<li>A \important{register}</li>
<li>A \important{memory location}</li>
</ul>

<p>
We have seen several so far:
</p>

<ul class="org-ul">
<li>lea  R5,19[R0]  ; R5 = 19</li>
<li>load R1,x[R0]  ; R1 = x</li>
<li>store R3,z[R0] ; z = R3</li>
<li>jump  finished[R0] ; goto finished</li>

<li>The first operand (e.g. R1 here) is called the destination
register, just like for RRR instructions</li>
<li>The second operand x[R0] specifies a memory address</li>
<li>Each variable is kept in memory at a specific location which is
identified by its address</li>
</ul>

<p>
The memory operand has two parts:
</p>

<ul class="org-ul">
<li>The variable x is a name for the address where x is kept &#x2014; called
the displacement.</li>
<li>The R0 part is just a register, called the index register.</li>
</ul>

<p>
Format of RX instruction
</p>
<pre class="example" id="orgb75a6ed">
load R1,x[R0]
</pre>

<p>
There are two words in the machine language code.
The first word has 4 fields: op, d, a, b, where
</p>

<ul class="org-ul">
<li>op contains f for every RX instruction</li>
<li>d contains the register operand (in the example, 1)</li>
<li>a contains the index register (in the example, 0)</li>
<li>b contains a code indicating \emph{which} RX instruction this is (1
means load)</li>
</ul>

<p>
The second word contains the <b>displacement</b>.  In the example, this is
the address of x.  Suppose x has memory address 0008.  Then the
machine code for load R1,x[R0] is:
</p>

<pre class="example" id="orgfe98251">
f101
0008
</pre>

<p>
Operation codes for RX instructions
</p>

<p>
Recall, for RRR the op field contains a number saying which RRR
instruction it is.  For RX, the op field always contains f.  So how
does the machine know which RX instruction it is?  Answer: there is a
secondary code in the b field.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">mnemonic</th>
<th scope="col" class="org-right">b field</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">lea</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left">load</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">store</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org3dbbfab" class="outline-4">
<h4 id="org3dbbfab">A strange program</h4>
<div class="outline-text-4" id="text-org3dbbfab">
<p>
Consider ``Program Strange'' below.  This program doesn't compute
anything particularly useful.  It's rather strange and not a model for
good programming style, but it illustrates an extremely important
concept, which is discussed below.
</p>

<p>
You can find the program on the Examples page, in the Core section, or
you can copy it below and paste it into the Editor page.  Run the
program with different initial values of a variable <b>y</b>, as described
below.  For each value of <b>y</b>, first try executing the program
manually, with paper and pencil, and then run it on the emulator to
check whether your execution was correct.  Give the final values of
the registers, and think about what is going on as the program runs.
For each run, assume that all the registers contain 0 after the
program is booted, before it begins execution.
</p>

<ol class="org-ol">
<li>Run the program in its original form, with <b>y data 0</b></li>
<li>Change the last line to <b>y data 1</b> and run it again</li>
<li>Now use <b>y data 256</b></li>
<li><b>y data 8192</b></li>
<li><b>y data -5424</b></li>
</ol>

<pre class="example" id="org77a2276">
; Strange: A Sigma16 program that is a bit strange    
        load   R1,y[R0]
        load   R2,x[R0]
        add    R2,R2,R1
        store  R2,x[R0]
        lea    R3,3[R0]
        lea    R4,4[R0]
x       add    R5,R3,R3
        add    R0,R0,R7
        trap   R0,R0,R0
y       data   0
</pre>

<p>
<b>Solution</b> &#x2013; it's best to try answering the questions on your own
first, and then to check by running the program on the emulator,
before reading the solution!
</p>

<p>
The program loads an <b>instruction</b> into a register, does arithmetic on
it by adding <b>y</b> to it, and stores the result back into memory.  This
phenomenon is called <b>self-modifying code</b>, and it exploits the fact
that instructions and data are held in the same memory (this is the
<b>stored program computer</b> concept).  The original instruction is <b>add
R5,R3,R3</b>, and its machine language code is 0533.
</p>

<ol class="org-ol">
<li>When y=0, the final values are: R1=0, R2=0533, R3=3, R4=4, R5=6.
The only notable points are that the store instruction doesn't
actually change the value of the word in memory (it was 0533 and
0533 is being stored there), and the last add instruction doesn't
change the value in R0 because R0 can never change; it is always 0.
(Of course if R7=0 then the result of the addition is 0 anyway.)</li>

<li>When y=1, the final values are: R1=1, R2=0534, R3=3, R4=4, R5=7.
Note that R5 is <b>not</b> 3+3=6.  When y=1 is added to the instruction,
the result is 0534 which means <b>add R5,R3,R4</b>, so instead of adding
R3+R3 it adds R3+R4.</li>

<li>When y=256, the final values are: R1=256=0100, R2=0633, R3=3, R4=4,
R5=0, R6=6. The decimal number 256 is 0100 in hexadecimal.  When
this is added to the instruction, the result is 0633, which means
<b>add R6,R3,R3</b> so R3+R3 is loaded into R6, not into R5.</li>

<li>When y=8192, the final values are: R1=4096=2000, R2=2533, R3=3,
R4=4, R5=9.  The decimal number 8192 is 2000 in hexadecimal, and
when this is added to the instruction the result is 2533, which
means <b>mul R5,R3,R3</b>.  It's no longer an <b>add</b> instruction, it's a
<b>multiply</b> instruction that calculates R5 := R3*R3 = 9.</li>

<li>When y=-5424 the program goes into an infinite loop. R1=ead0 (the
hexadecimal representation of -5424, R2=f003, R3=3, and R4=4.  What
started out as the <b>add</b> instruction at x has been transformed into
<b>jump 7[R0]</b>, comprising the word at <b>x</b> (f003) and the following
word (which is 0007).  This jump instruction goes back to the first
lea instruction, and the program runs for ever (lea, lea, jump).</li>
</ol>

<p>
There is a lot to say about the phenomenon of self-modifying code.
</p>

<p>
This program shows clearly that a computer does not execute assembly
language; it executes machine language.  Try running it on the Sigma16
application (single step each instruction).  You'll see that the
assembly language statement <b>add R5,R3,R3</b> is highlighted in red, but
that is just the GUI trying to be helpful.  What's important is that
the machine language instruction is fetched from memory and loaded
into ir (the instruction register), and that is not 0533.  The machine
decodes the contents of ir and does whatever that says to do; it isn't
aware of the assembly language statement.  Indeed, a machine doesn't
even understand the concept of assembly language &#x2014; everything is
just bits!
</p>

<p>
To follow exactly what is happening in the emulator, it's important to
look at the pc and ir registers.  These reflect what the machine is
doing.  The assembly language does not.
</p>

<p>
What is self-modifying code good for?  The answer lies in the early
history of electronic computers.  Early computers (late 1940s and
early 1950s) did not use an effective address (i.e.  displacement +
index) like Sigma16; the instructions simply specified the absolute
memory address of an operand.  This is ok for simple variables, but
how could they process arrays?
</p>

<p>
The solution was to use self modifying code.  In a loop that traverses
an array, there would be a load instruction using address 0.  In the
body of the loop, there would be instructions to calculate the address
of x[i] by loading the address of x and adding i; this is then stored
into the address field of the load instruction.  That instruction is
then executed, obtaining the value of x[i].  This technique became
obsolete in the early 1950s with the invention of index registers and
effective addresses.
</p>

<p>
The pioneers of computers considered the concept of the <b>stored
program computer</b> (i.e. the program and data are in the same memory)
to be fundamental and essential.  One of the most important reasons
was that it made arrays possible.  Now we consider the stored program
concept to be fundamental <b>for different reasons</b>.
</p>

<p>
Self modifying code is tricky, and difficult to debug.  It makes
programs hard to read: you can't rely on what the program says, but on
what its instructions will become in the future.  For these reasonas,
self modifying code is now considered to be bad programming practice.
</p>

<p>
If a program modifies itself, you can't have one copy of the program
in memory and allow it to be shared by several users.  For example,
it's common now to have a web browser open with several tabs.  Each
tab is served by an independent process (a separate running instance
of a program that updates the window showing the web page).  If you
have 5 tabs open, there are 5 processes, each running the same machine
language code, and there's only one copy of that in memory.  This
wouldn't work if the program modified itself!
</p>

<p>
Self modifying code leads to security holes: if a hacker has the
ability to change your machine language code in memory, they could
make your own program act against you.
</p>

<p>
Modern computers use a technique called <b>segmentation</b> that prevents a
program from modifying itself.  This leads to increased reliability
and security.
</p>

<p>
Some computers have a facility that allows you to gain the power of
self modifying code without actually modifying the code in memory.
The idea is to have an instruction <b>execute R1,x[R0]</b> which calculates
the logical or of the two operands and then executes the result; x is
the address of an instruction and R1 contains the modification to it.
The modified instruction is executed, but there is no change to the
machine code in memory.  This idea was used in the IBM 360 and its
successors.  However, as the design of effective addresses has become
more sophisticated, the execute instruction is rarely needed, and most
modern computers don't provide it.
</p>

<ul class="org-ul">
<li>Architecture</li>
</ul>

<p>
Our focus is on fundamental concepts, ideas and principles.  Sigma16
illustrates the fundementals of computer systems but it avoids
unnecessary complexity.  For example, Sigma16 has just one word size
(16 bits) while most commercial machines provide a variety.  That
variety is useful for practical applications but it complicates many
of the details while not adding any new fundamental ideas.  Most
commercial computers that achieve success in the marketplace
eventually become encrusted with complications that help support
backward compatibility; this can lead to great complexity.
</p>
</div>
</div>

<div id="outline-container-org40c0a69" class="outline-4">
<h4 id="org40c0a69">Testing and debugging</h4>
</div>
<div id="outline-container-org4e1e6a8" class="outline-4">
<h4 id="org4e1e6a8">Breakpoints</h4>
<div class="outline-text-4" id="text-org4e1e6a8">
<p>
Quick summary, explanation follows.  There are two ways to set a
breakpoint:
</p>

<ol class="org-ol">
<li>Insert a breakpoint in code: <i>lea  R10,4; trap R10,R0,R0</i>  Any
register (except R0) can be used in place of R10.</li>
<li>Request a breakpoint in the user interface: Click Breakpoint, type
in address (e.g. $00b6), click Refresh, Enable, Close.</li>
</ol>

<p>
If you're debugging some code in a large program, you may need to
execute a lot of instructions before reaching the point you're
interested in.  For example, many programs execute thousands of
instructions just to initialize.  It's infeasible to step through all
those instructions, yet if you just run at full speed you won't be
able to see in detail what's happening in the section you are working
on.
</p>

<p>
A <i>breakpoint</i> is a location in a program where execution will stop
automatically.  The breakpoint indicates a specific instruction.  You
Boot the program and set a breakpoint and then click Run.  It will
execute at full speed until it reaches the instruction you've selected
(the "breakpoint") and then execution stops.  You can examine the
registers and memory and single step through the section of code
you're working on.  At any time you can click Run and full speed
execution resumes, until either another breakpoint is encountered or
the program terminates.
</p>

<p>
Both a breakpoint ahd halt will stop execution of the program.  The
difference is that after a break you can click Step or Run to
continue, but after halt the program cannot execute any more
instructions.
</p>

<p>
There are two ways to set a breakpoint
</p>

<ul class="org-ul">
<li><i>Trap break</i>: Insert an instruction into the program that breaks
execution at that point.</li>
<li><i>External break</i>: Define a breakpoint in the user interface, without
modifying the program.</li>
</ul>

<p>
Both forms are useful.  Most of the time, while debugging a program, a
trap break is easier and more convenient.  However, if you don't want
to modify the program or reassemble it, or if you realise that you
want a breakpoint after execution has already started, then an
external break is better.
</p>
</div>

<ul class="org-ul">
<li><a id="orgd5ea2ff"></a>Trap break<br />
<div class="outline-text-5" id="text-orgd5ea2ff">
<p>
You can use a trap instruction to break execution when it executes.
The first operand of the instruction is a register that must contain
4, the trap code for breakpoint.  The other two operands are ignored.
</p>

<p>
Suppose you want to check in detail what the load instruction is doing
in this code.
</p>

<pre class="example" id="org6cd87b9">
...
add    R1,R2,R3
load   R4,x[R1]
...
</pre>

<p>
Insert a breakpoint just <i>before</i> the instruction you want to examine.
The breakpoint requires two instructions.  The first instruction loads
the break code into some register (say R9 but it doesn't matter
which), and the second instruction is a trap which actually performs
the break.
</p>

<pre class="example" id="org458c1c9">
...
add    R1,R2,R3
lea    R9,4       ; R9 := trap break code
trap   R9,R0,R0   ; breakpoint
load   R4,x[R1]
...
</pre>

<p>
Now you can run the program at full speed, but when it executes the
trap instruction, the emulator will stop.  Since the trap instruction
has just executed, it will be highlighted in red, and the instruction
you're interested in &#x2013; the load &#x2013; will be highlighted in blue.
</p>

<p>
Now you can single step for a while, and click Run again at any time
to resume full speed execution.
</p>

<p>
For an example of a long running program with a trap break, see
Examples / Testing / Looper.
</p>
</div>
</li>

<li><a id="org0926ab7"></a>External break<br />
<div class="outline-text-5" id="text-org0926ab7">
<p>
You can also tell the user interface to perform a breakpoint without
modifying the program.  You need to know the address of the
instruction to stop at; find that from the assembly listing.
</p>

<ol class="org-ol">
<li>In the processor page, click Breakpoint</li>
<li>This pops up a small window.  Type in the breakpoint address.  It
must be a hexadecimal address in assembly language format: it must
begin with a $ and then contain four hex digits.  No other
characters may be present, not even white space.</li>
<li>Click Refresh.  This parses the address you entered and remembers
it.</li>
<li>Click Enable.  This turns on the breakpoint.</li>
<li>Click CLose.  This closes the breakpoint popup so you can see the
Processor again.</li>
</ol>

<p>
Now click Run and the program will execute at full speed.  When the pc
register is equal to the breakpoint address, the emulator will stop.
Then you can Step or Run to continue execution.
</p>

<p>
As long as the breakpoint is enabled, execution will stop every time
that location is encountered.  To prevent this, open the breakpoint
popup again and click Disable.
</p>
</div>
</li>
</ul>
</div>


<div id="outline-container-org4386609" class="outline-4">
<h4 id="org4386609">List of Core instructions</h4>
<div class="outline-text-4" id="text-org4386609">
<p>
The following table summarises the instructions in the Core subset of
Sigma16.  This is an extract from the table for the full architecture
which appears below, in the Architecture section.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Mnemonic</th>
<th scope="col" class="org-left">ISA</th>
<th scope="col" class="org-left">P</th>
<th scope="col" class="org-left">Fmt</th>
<th scope="col" class="org-left">Args</th>
<th scope="col" class="org-left">Code</th>
<th scope="col" class="org-left">Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">add</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">0</td>
<td class="org-left">Rd := Ra + Rb</td>
</tr>

<tr>
<td class="org-left">sub</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">1</td>
<td class="org-left">Rd := Ra - Rb</td>
</tr>

<tr>
<td class="org-left">mul</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">2</td>
<td class="org-left">Rd := Ra * Rb</td>
</tr>

<tr>
<td class="org-left">div</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">3</td>
<td class="org-left">Rd := Ra / Rb, R15 := Ra rem Rb</td>
</tr>

<tr>
<td class="org-left">cmp</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RR</td>
<td class="org-left">4</td>
<td class="org-left">R15 := Ra cmp Rb</td>
</tr>

<tr>
<td class="org-left">trap</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">b</td>
<td class="org-left">user interrupt</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">f</td>
<td class="org-left">escape to RX format</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">lea</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,0</td>
<td class="org-left">Rd := ea</td>
</tr>

<tr>
<td class="org-left">load</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,1</td>
<td class="org-left">Rd := M[ea]</td>
</tr>

<tr>
<td class="org-left">store</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,2</td>
<td class="org-left">M[ea] := Rd</td>
</tr>

<tr>
<td class="org-left">jump</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,3</td>
<td class="org-left">pc := ea</td>
</tr>

<tr>
<td class="org-left">jumpc0</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">kX</td>
<td class="org-left">f,4</td>
<td class="org-left">if R15.k=0 then pc := ea</td>
</tr>

<tr>
<td class="org-left">jumpc1</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">kX</td>
<td class="org-left">f,5</td>
<td class="org-left">if R15.k=1 then pc := ea</td>
</tr>

<tr>
<td class="org-left">jal</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,a</td>
<td class="org-left">Rd := pc, pc := ea</td>
</tr>
</tbody>
</table>

<p>
Pseudoinstructions for comparisons
</p>

<ul class="org-ul">
<li>jumplt jump if &lt;</li>
<li>jumple jump if &lt;=</li>
<li>jumpeq jump if =</li>
<li>jumpne jump if !=</li>
<li>jumpge jump if &gt;-</li>
<li>jumpgt jump if &gt;</li>
</ul>

<p>
Assembly directives
</p>

<ul class="org-ul">
<li>data</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org94c312e" class="outline-3">
<h3 id="org94c312e">Standard architecture tutorial</h3>
</div>
<div id="outline-container-org70f6adf" class="outline-3">
<h3 id="org70f6adf">Systems architecture tutorial</h3>
</div>
<div id="outline-container-org7841034" class="outline-3">
<h3 id="org7841034">S32 architecture tutorial</h3>
</div>
</div>

<div id="outline-container-sec-architecture" class="outline-2">
<h2 id="sec-architecture">Sigma16 Architecture reference</h2>
<div class="outline-text-2" id="text-sec-architecture">
</div>

<div id="outline-container-orga8a3d0c" class="outline-3">
<h3 id="orga8a3d0c">Subsystems</h3>
<div class="outline-text-3" id="text-orga8a3d0c">
<p>
The system contains several main subsystems.  The most important of
these are <b>registers</b>, <b>memory</b>, and <b>logic and arithmetic</b>, and
<b>Input/Output</b>.  These are described in detail later, but here is a
brief synopsis:
</p>

<ul class="org-ul">
<li>A register is a digital circuit that can retain one word of data.  A
new value can be loaded into a register, and the current contents
may be read out.  There are a number of special registers as well as
a <b>register file</b> that contains 16 registers.</li>

<li>The memory can hold a large number of words.  It's similar to the
register file, but significantly slower and much larger.</li>

<li>The ALU (arithmetic and logic unit) is a circuit that can do
arithmetic, such as addition, subtraction, comparison, and some
other operations</li>

<li>The Input/Output system can transfer data between the computer and
the outside world.</li>
</ul>
</div>
</div>

<div id="outline-container-org541fdf7" class="outline-3">
<h3 id="org541fdf7">Words</h3>
<div class="outline-text-3" id="text-org541fdf7">
<p>
Sigma16 uses the following terminology:
</p>
<ul class="org-ul">
<li>A <b>word</b> is a sequence of 16 bits.</li>
<li>A <b>double word</b> is a sequence of 32 bits.</li>
<li>A <b>generic word</b> is a sequence of bits of arbitrary length.</li>
</ul>

<p>
In S16, every data value is a word.  S32 allows computations on both
words and double words.  The system does not use bytes (a byte is 8
bits) or extended words (64 bits).
</p>

<p>
The bits of a word are indexed from right to left, starting with 0.
The rightmost (least significant) bit has index 0.  For a word, the
leftmost (most significant) bit has index 15.  For a double word, the
leftmost bit has index 31.
</p>

<div class='AsideNote'>
<p>
<b>Word terminology.</b> A byte is almost universally agreed to be 8 bits,
but the terminology for words is not standard.  Computers have been
built with many different word sizes, including 1 bit (Goodyear
Aerospace MPP), 4 bits (Intel 4004), 7 bits (IBM 1401), 8 bits (Intel
8080), 12 bits (PDP-8), 15 bits (Apollo Guidance Computer), 16 bits
(IBM 1130), 17 bits (EDSAC), 18 bits (PDP-15), 24 bits (CDC 924), 32
bits (IBM 360), 36 bits (IBM 7094), 40 bits (IAS), 44 bits (M-EDVAC),
48 bits (Burroughs 5000), 60 bits (CDC 6600), and 64 bits (Cray 1).
Much of the variation appears in early computers; most current
machines have a word size which is a power of 2.  (Some of these
computers have an additional parity bit, which is invisible to
software and not included in the figures.)
</p>
<asidepar>
<p>
Many computers have shorter and longer words as well as their standard
size.  For example, IBM 360 and its descendants have a 32-bit full
word, a 16-bit half word, and a 64-bit double word.  For Sigma16, a
word is 16 bits and a double word is 32 bits.
</p>
</div>

<p>
Every data type must be represented as one or more words.  By itself,
a word has no inherent meaning: it is just a sequence of bits.
However, some instructions act on a word assuming that it represents
some particular data type.  Sigma16 supports natural numbers,
integers, and Booleans.  Addresses and characters are both represented
as natural numbers.
</p>

<p>
Natural numbers are represented in binary.  The binary value of an
n-bit generic word x is
</p>

<p>
binval (x) = &sum;<sub>0&le;i&lt;n</sub> (x<sub>i</sub> * 2<sup>i</sup>)
</p>

<p>
For a word (16 bits), natural numbers are restricted to the range from
0 through  2 <sup>16</sup> - 1; that is, from 0 through
65,535.  For a double word (32 bits), natural numbers are restricted
to the range from 0 and  2 <sup>32</sup> - 1; that is, from 0
through 4,294,967,295.
</p>

<p>
Integers are represented using two's complement notation.  If the
leftmost (most significant) bit of a word is 0, its two's complement
value is the same as its binary value.  If the leftmost bit is 1, the
two's complement value is negative.  Any two's complement number can
be negated by inverting all the bits (replace 0 by 1 and vice versa)
and then adding 1.  To get the two's complement value of x = 1111
1010, we can negate x, obtaining 0000 0101 + 1 = 0000 0110 which is 6.
Since -x = 6, we know that x = -6.
</p>

<p>
Assembly language provides several notations for expressing the value
of a word.  If a numeric value is out of range it is truncated.
</p>

<ul class="org-ul">
<li>An unsigned integer between 0 and 65,535 (2<sup>16</sup> - 1)</li>
<li>A signed integer between -32,768 and 32,767 (-2<sup>15</sup> and 2<sup>15</sup> - 1)</li>
<li>A 4-digit hexadecimal constant, where the digits are 0-9 a-f.
Sometimes, when the context is clear, this is written as just the
hex digits (e.g 3b2f).  In assembly language programs, hex constants
are written with a preceding $ sign (e.g. $3b2f).  This is necessary
to avoid ambiguity: 1234 is a decimal number and $1234 is a
hexadecimal number.  In contexts where there is no ambiguiity, the $
may be omitted: for example, the GUi shows register and memory
contents as hexadecimal without the leading $.</li>
</ul>
</div>
</div>

<div id="outline-container-orgf86b28a" class="outline-3">
<h3 id="orgf86b28a">Bits and fields</h3>
<div class="outline-text-3" id="text-orgf86b28a">
</div>
<ul class="org-ul">
<li><a id="org43f3fc0"></a>add<br />
<div class="outline-text-5" id="text-org43f3fc0">
<p>
Example: add R1,R2,R3 ; R1 := R2 + R3
</p>

<p>
The instruction add Rd,Ra,Rb has operands Ra and Rb and destination
Rd.  It fetches the operands Ra and Rb, calculates the sum Ra + Rb,
and loads the result into the destination Rd.  The effect is Rd :=
Ra + Rb.  For example, add R5,R12,R2 performs R5 := R12 + R3.
</p>

<p>
The add instruction is RRR format with opcode=0.  Given destination Rd
and operands Ra and Rb (where d, a, b are hex digits), add Rd,Ra,Rb is
reprseented by 0dab.
</p>

<p>
Code    Assembly          Effect
&#x2013;&#x2014;   -----------&#x2013;&#x2014;  -------------&#x2013;&#x2014;
062c    add R6,R2,R12     ; R6 := R2 + R12
0d13    add R13,R1,R3     ; R13 := R1 + R3
</p>

<p>
In addition to setting the destination register, the add instruction
sets several bits in the condition code R15 and may set a bit in the
req register.
</p>

<p>
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
 R15.ccG    result &gt; 0 (binary)
 R15.ccg    result &gt; 0 (two's complement)
 R15.ccE    result = 0
 R15.ccl    result &lt;tc 0 (two's complement)
 R15.ccV    overflow (binary)
 R15.CCv    overflow (two's complement)
 R15.CCc    carry output
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
</p>

<p>
The bits in a word are numbered from right to left, starting at bit
index 0 in the rightmost (least significant) position, up to index 15
at the leftmost (most significant) position.  The notation x.n denotes
the bit in x with index n.
</p>

<p>
A field is a consecutiave sequence of bits within a word.  A field is
specified with the index of the leftmost bit in the field, along with
the size of the field.  For example, the field in x with index 9 and
size 3 consists of the bits x.9 x.8 x.7.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org5695711" class="outline-3">
<h3 id="org5695711">Memory</h3>
<div class="outline-text-3" id="text-org5695711">
<p>
The memory is a hardware array of words that are accessed by address.
A memory address is 16 bits wide, and there is one memory location
corresponding to each address, so there are 2<sup>16</sup> = 64k memory
locations.  Each memory location is a 16-bit word.
</p>

<p>
Instructions specify memory addresses in two parts: the
<b>displacement</b>, which is a word representing a binary number, and the
<b>index</b>, which is one of the registers in the register file.  For
example, a memory address could be specified as $003c[R5]; the
displacement is 003c and the index is R5.
</p>

<p>
When the instruction is executed, the computer calculates the
<b>effective address</b> by adding the value of the displacement and the
value in the index register.  If R5 contains 2, then the effective
address of $003c[R5] is 003e.
</p>

<p>
This scheme may seem more complicated than simply specifying the
address directly, but it is extraordinarily flexible.  If the machine
language just gave the address as a single binary number, it would be
limited to accessing simple static variables.  The effective address
mechanism is simple to implement in hardware, as you can see in the
digital circuit processor, yet it allows the implementation of local
variables, records, arrays, pointers and linked data structures, jump
tables, and more.  These techniques are described later.
</p>
</div>
</div>

<div id="outline-container-orgca9571c" class="outline-3">
<h3 id="orgca9571c">Registers</h3>
<div class="outline-text-3" id="text-orgca9571c">
</div>
<div id="outline-container-org23d5c87" class="outline-4">
<h4 id="org23d5c87">Register file</h4>
<div class="outline-text-4" id="text-org23d5c87">
<p>
The <b><b>register file</b></b> is a set of 16 general registers that hold a 16
bit word.  A register is referenced by a 4-bit binary number.  In
assembly language, we use the notations R0, R1, R2, &#x2026;, R9, R10, R11,
R12, R13, R14, R15 to refer to the registers.  The state of the
register file can be written as a table showing the value of each
register:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Register</th>
<th scope="col" class="org-left">Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">R0</td>
<td class="org-left">0000</td>
</tr>

<tr>
<td class="org-left">R1</td>
<td class="org-left">fffe</td>
</tr>

<tr>
<td class="org-left">R2</td>
<td class="org-left">13c4</td>
</tr>

<tr>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
</tr>

<tr>
<td class="org-left">R14</td>
<td class="org-left">03c8</td>
</tr>

<tr>
<td class="org-left">R15</td>
<td class="org-left">0020</td>
</tr>
</tbody>
</table>

<p>
Sigma16 is a load/store style architecture; that is, it does not
combine memory accesses with arithmetic.  All calculations are carried
out in the register file, and explicit load and store instructions
must be used to copy data between the memory and the register file.
</p>

<p>
There are some programming conventions that use certain registers for
special purposes.  The hardware does not enforce, or even know about,
these conventions, and you do not have to follow the conventions in
programming.  However, it is necessary to obey the conventions in
order to use the standard software libraries in your program.  See the
section on Programming for a discussion of these standard usage
conventions.
</p>
</div>

<ul class="org-ul">
<li><a id="org8a75aab"></a>R0 contains the constant 0<br />
<div class="outline-text-5" id="text-org8a75aab">
<p>
One of the registers, R0, has a special property: it always contains
the constant 0.  It is legal to perform an instruction that attempts
to load some other value into R0, but the register will still contain
0 after executing such an instruction.  Such an instruction will
simply have no lasting effect.
</p>
</div>
</li>

<li><a id="orgf4f8aa1"></a>R15 is the condition code register<br />
<div class="outline-text-5" id="text-orgf4f8aa1">
<p>
Several instructions produce status information: the result of a
comparison, whether there was an overflow, etc.  This information is
automatically loaded into R15, which is the condition code register.
The description of each instruction states whether R15 is modified,
and what goes into it.
</p>

<p>
The bits in R15 are indexed from bit 0 (the most significant, or
lefttmost bit) to bit 15 (the least significant, or rightmost).  The
condition code bits that have specific meanings are called <b>flags</b>.
</p>

<ul class="org-ul">
<li>Each bit position holds a Boolean value, either False or True,
represented by 0 or 1 respectively.</li>
<li>Each flag gives the status of a relation or event.  If the flag is
True (1) the relation holds or the event has occurred.  If the flag
is False (0) the relation does not hold, or the event has not
occurred.</li>
</ul>

<p>
One way to use flags in the condition code is to control conditional
jumps:
</p>
<ul class="org-ul">
<li>Use jumpc0 to jump if the Boolean is False</li>
<li>Use jumpc1 to jump if the Boolean is True</li>
</ul>

<p>
Another way to use condition code flags is to save them as Boolean
variables and perform logic operations on them.  This is done using
the extract and logicb instructions.
</p>

<p>
There are separate flags for integers (represented as two's complement) and natural
numbers (represented as binary).  This is necessary because the
relation between two words sometimes depends on the type of the data.
For example, consider the word ffff (all 1 bits).  On its own, ffff is
just a word of bits and has no inherent meaning.
</p>
<ul class="org-ul">
<li>If ffff is interpreted as a natural number (i.e. binary), it is
positive and has the value 65,535, and ffff &gt; 0000</li>
<li>If ffff is interpreted as an integer (i.e. two's complement), then
it is negative and has the value -1, and ffff &lt; 0000.</li>
</ul>
<p>
Each flag has a short 1-character name to enable them to be displayed
compactly.  A naming convention is that flags for integers (two's
complement) have lower case letters, while flags for natural numbers
(binary) have upper case letters.  For example:
</p>
<ul class="org-ul">
<li>l means &lt; for integers</li>
<li>L means &gt; for integers</li>
</ul>
<p>
However, equality is the same regardless of type.  If two words
consist of exactly the same bits, then they have the same value as
integers, natural numbers, characters, addresses, and for any other
possible type as well.  Therefore there is only one flag for equality,
and its symbol is =.
</p>

<p>
The following table lists all the condition code flags.  The index is
the bit position in the condition code register (bit index 0 is the
leftmost bit).  The symbol is a character that is displayed if the
flag is 1.  The name is an alphabetic letter used in programs where
the symbol is not allowed: for example you can't have a variable named
is&lt; so isE can be used instead.
</p>

<ul class="org-ul">
<li>index: Each flag has an index which gives its bit position in the
condition code.  Bits are numbered from right to left, starting
with 0.  Thus the least significant bit has index 0, and the most
significant bit has index 15.</li>
<li>meaning: Description using English or mathematical notation</li>
<li>symbol: Character that is displayed when the flag is True</li>
<li>name: Alphabetical name suggested for use within variable names.</li>
</ul>

<p>
There is an exception for division by zero, but no corresponding flag
in the condition code.  The reason is that the div instruction places
the remainder in R15, so the condition code isn't available to
represent division by 0.  You can test explicity for division by 0 by
using jumpz specifying the register containing the divisor <i>before</i>
execuing the div instruction.
</p>

<p>
Bits are indexed from the right, starting from bit 0.  This bit with
index 0 is the least significant, the bit with index 15 is the most
significant bit.
</p>

<p>
Table: Condition code flags
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">bit index</th>
<th scope="col" class="org-left">Relation</th>
<th scope="col" class="org-left">Symbol</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">&gt; Int</td>
<td class="org-left">g</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">&gt; Nat</td>
<td class="org-left">G</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">=</td>
<td class="org-left">=</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">&lt; Nat</td>
<td class="org-left">L</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">&lt; Int</td>
<td class="org-left">&lt;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Int overflow</td>
<td class="org-left">v</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">Nat overflow</td>
<td class="org-left">V</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">Carry</td>
<td class="org-left">C</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">Stack overflow</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">Stack underflow</td>
<td class="org-left">s</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</div>

<div id="outline-container-org11d7716" class="outline-4">
<h4 id="org11d7716">Instruction control registers</h4>
<div class="outline-text-4" id="text-org11d7716">
<p>
There are several instruction control registers that enable the
processor to keep track of the state of the running program.  These
registers are rarely used directly by the machine language program,
but they are essential for keeping track of the execution of the
program, and some instructions use them directly.
</p>

<ul class="org-ul">
<li>ir &#x2013; instruction register (16-bit word)</li>

<li>pc &#x2013; program counter (16-bit word)</li>

<li>adr &#x2013; address register (16-bit word)</li>

<li>dat &#x2013; data register (16-bit word)</li>

<li>status &#x2013; collection of control flags</li>
</ul>
</div>
</div>

<div id="outline-container-org764cdbf" class="outline-4">
<h4 id="org764cdbf">System control registers</h4>
<div class="outline-text-4" id="text-org764cdbf">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">status</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">mask</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">req</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">istat</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">ipc</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">vect</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">psegBeg</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">psecEnd</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">dsegBeg</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">dsegEnd</td>
</tr>
</tbody>
</table>
</div>

<ul class="org-ul">
<li><a id="orge6176d0"></a>Status register flags<br />
<div class="outline-text-5" id="text-orge6176d0">
<p>
The processor can be executing in several modes, which are determined
by the <b><b>system control registers</b></b>.
</p>
</div>
</li>

<li><a id="org08ff9e6"></a>req and mask registers<br />
<div class="outline-text-5" id="text-org08ff9e6">
<p>
Interrupt request and mask bits (req and mask registers)
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">inp</td>
<td class="org-left">input</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">out</td>
<td class="org-left">output</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-left">timer</td>
<td class="org-left">timer interrupt request</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">seg fault</td>
<td class="org-left">segmentation fault</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">bin ovfl</td>
<td class="org-left">natural overflow</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">tc ovfl</td>
<td class="org-left">integer overflow</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">zdiv</td>
<td class="org-left">divide by 0</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">sovfl</td>
<td class="org-left">stack overflow</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">sufl</td>
<td class="org-left">stack underflow</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">utrap</td>
<td class="org-left">user trap</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>sys (bit 0)  &#x2013; system state (1-bit flag)</li>

<li>ie (bit 1)   &#x2013; interrupts enabled (1-bit flag)</li>
</ul>

<p>
Table: Processor status flags
</p>

<p>
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Bit&lt;/th&gt;
    &lt;th&gt;Flag&lt;/th&gt;
    &lt;th&gt;Meaning&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;0&lt;/td&gt;
    &lt;td&gt;**U**&lt;/td&gt;
    &lt;td&gt;User state&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;1&lt;/td&gt;
    &lt;td&gt;**E**&lt;/td&gt;
    &lt;td&gt;Interrupts enabled&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgec2bb76" class="outline-4">
<h4 id="orgec2bb76">Interrupts and exceptions</h4>
<div class="outline-text-4" id="text-orgec2bb76">
<ul class="org-ul">
<li>mask</li>

<li>req</li>

<li>istat</li>

<li>ipc</li>

<li>vect</li>
</ul>
</div>

<ul class="org-ul">
<li><a id="org316a9ea"></a>Mask and request flags<br />
<div class="outline-text-5" id="text-org316a9ea">
<p>
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Bit&lt;/th&gt;
    &lt;th&gt;Flag&lt;/th&gt;
    &lt;th&gt;Meaning&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;0&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;0&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;1&lt;/td&gt;
    &lt;td&gt;Overflow&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;2&lt;/td&gt;
    &lt;td&gt;Div0&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;3&lt;/td&gt;
    &lt;td&gt;StackFault&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;4&lt;/td&gt;
    &lt;td&gt;SegFault&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;5&lt;/td&gt;
    &lt;td&gt;Privelege&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;6&lt;/td&gt;
    &lt;td&gt;Timer&lt;/td&gt;
    &lt;td&gt;Interrupt&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;7&lt;/td&gt;
    &lt;td&gt;Input&lt;/td&gt;
    &lt;td&gt;Interrupt&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;8&lt;/td&gt;
    &lt;td&gt;Output&lt;/td&gt;
    &lt;td&gt;Interrupt&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</p>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org3ac2ced" class="outline-3">
<h3 id="org3ac2ced">Instruction representation</h3>
<div class="outline-text-3" id="text-org3ac2ced">
<p>
Instructions are represented in the memory of the computer using
words, just like all other kinds of data.  From the programmer's
perspective, an instruction is like a simple statement in a
programming language.  From the circuit designer's perspective,
instructions must be executed using logic gates, and the specific way
it is represented as a word of bits is important.
</p>

<p>
An instruction specifies several pieces of information.  For example,
add R1,R2,R3 is an instruction that says four things: it's an
addition, the operands come from R2 and R3, and the result goes into
R1.  Therefore to represent instructions we need to organize a word as
a collection of several <b>fields</b>, with each field giving one specific
piece of information about the instruction.
</p>

<p>
The particular scheme for describing an instruction as a collection of
fields is called an <b>instruction format</b>.  Like most computers,
Sigma16 has a small number of instruction formats and a larger number of
instructions.  The key to understanding the interface between machine
language and digital circuit design is to master the instruction
formats.
</p>

<p>
The core architecture (the simplest part of the system) uses just two
instruction formats: the <b><b>RRR format</b></b> for instructions that perform
operations in the registers, and the <b><b>RX format</b></b> for instructions
that refer to a memory location.
</p>

<p>
The advanced parts of the architecture provide additional instructions
which are represented with the EXP format. The name EXP stands
simultaneously for <b>expansion</b> (because it provides for many
additional instructions) and <b>experimental</b> (because it allows for
experimentation with the design and implementation of new
instructions).
</p>

<p>
The S32 architecture extends Sigma16 to handle 32-bit words, and it
uses the EXP3 format.
</p>


<p>
Every instruction has a 4-bit field called the opcode (op for short).
This gives 16 values of the opcode: 14 of them (0 through 13) denote
the 14 RRR instructions, described later.  If the op field is 14 (hex
e) the instruction is EXP format and has a secondary opcode in the a
and b fields.  If the op field contains 15 (hex f) the instruction is
RX format with a secondary opcode in the b field.  The instruction
formats are described below.
</p>

<p>
The first word of every instruction contains the
following fields.
</p>

<ul class="org-ul">
<li>op  (bits 0-3) opcode, determines instruction format</li>
<li>d   (bits 4-7) 4-bit destination</li>
<li>a   (bits 8-11) 4-bit operand</li>
<li>b   (bits 12-15) 4-bit operand, or expanded opcode for RX</li>
</ul>


<p>
The details of each format and its fields are given below, and The
following table gives an overview.
</p>
<ul class="org-ul">
<li>Each instruction format has a fixed size, which is the number of
words used to represent any instruction of that format.</li>
<li>These words are subdivided into 4-bit fields, each with a unique
name: op, d, a, b, etc.</li>
<li>The type of instruction is specified by the opcode, which is the op
field for RRR instructions, and which consists of several fields for
the other formats.</li>
<li>The instruction operands are specified by further fields.</li>
<li>Some instructions combine two 4-bit fields into a single 8-bit
field.
<ul class="org-ul">
<li>The a and b fields may be combined to form an 8-bit field called ab
(only for the EXP format)</li>
<li>The g and h fields may be combined to form an 8-bit field called gh</li>
</ul></li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Format</th>
<th scope="col" class="org-right">Size</th>
<th scope="col" class="org-left">Opcode</th>
<th scope="col" class="org-left">Operands</th>
<th scope="col" class="org-left">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">RRR</td>
<td class="org-right">1</td>
<td class="org-left">op</td>
<td class="org-left">d,a,b</td>
<td class="org-left">add Rd,Ra,Rb</td>
</tr>

<tr>
<td class="org-left">RX</td>
<td class="org-right">2</td>
<td class="org-left">op,b</td>
<td class="org-left">d,a disp</td>
<td class="org-left">load Rd,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">EXP</td>
<td class="org-right">2</td>
<td class="org-left">op,ab</td>
<td class="org-left">d,e,f,g,h</td>
<td class="org-left">save Rd,Re,gh[Rf]</td>
</tr>

<tr>
<td class="org-left">EXP3</td>
<td class="org-right">3</td>
<td class="org-left">op,ab</td>
<td class="org-left">d,e,f,g,h,p,q,r</td>
<td class="org-left">extractl</td>
</tr>
</tbody>
</table>

<p>
There are two kinds of format: the machine instruction formats, and
the assembly language instruction statement formats.  There are three
machine instruction formats: RRR, RX, EXP.  However, there is a
larger set of assembly language statement formats, because there are
special syntaxes for some instructions, and there are assembler
directives that aren't instructions at all.  The assembly language
formats are described later.
</p>
</div>

<div id="outline-container-org7b2ef9e" class="outline-4">
<h4 id="org7b2ef9e">RRR format</h4>
<div class="outline-text-4" id="text-org7b2ef9e">
<p>
RRR instructions are represented in one word comprising four 4-bit
fields:
</p>


<div id="orga8f92f9" class="figure">
<p><object type="image/svg+xml" data="./svg/RRRformat.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
Each field contains 4 bits representing a binary number between 0
and 15.
</p>

<ul class="org-ul">
<li>op (bits 15 to 12) is the operation code, usually called <i>opcode</i>.
This determines the operation to be performed.  If the opcode is
between 0 and 12 it specifies an RRR instruction.  An opcode greater
than 12 indicates an <i>expanding opcode</i>: the instruction is not RRR
but one of the other formats, and it has a secondary opcode that
specifies precisely which instruction it is.  This is explained in
the sections on RX and EXP formats.</li>
<li>d (bits 11 to 8) is the <i>destination register</i>; the register where
(in most cases) the result will be loaded.</li>
<li>a (bits 7 to 4) is the register containing the first operand.</li>
<li>b (bits 3 to 0) is the register containing the second operand.</li>
</ul>

<p>
In most cases, an RRR instruction takes two operands in registers
specified by the a and b fields and produces a result which is loaded
into the register specified by the d field.  A typical example of an
RRR instruction is add R4,R9,R2, which adds the contents of registers
R9 and R2, and loads the result into R4.  It's equivalent to R4 :=
R9 + R2.  The opcode for add is 0, so the machinen language code for
this instruction is 0492.
</p>
</div>
</div>

<div id="outline-container-orgb15c99b" class="outline-4">
<h4 id="orgb15c99b">RX format</h4>
<div class="outline-text-4" id="text-orgb15c99b">
<p>
RX instructions specify a memory location as well as a register
operand.  The machine language representation is two words:
</p>

<svg width="160" height="80" 
  xmlns="http://www.w3.org/2000/svg">

  <title>RX format</title>
  <desc>Fields of RX instruction format</desc>


  <g style="font-size: 14pt; font-family: sans-serif">
  
    <rect x="0" y="0" width="160" height="80"
          style="fill: none; stroke: black"/>
    <line x1="0" y1="40" x2="1600" y2="40" style="stroke: black"/>
    <line x1="40" y1="0" x2="40" y2="40" style="stroke: black"/>
    <line x1="80" y1="0" x2="80" y2="40" style="stroke: black"/>
    <line x1="120" y1="0" x2="120" y2="40" style="stroke: black"/>

    <text x="20" y="25" style="text-anchor: middle">op</text>
    <text x="60" y="25" style="text-anchor: middle">d</text>
    <text x="100" y="25" style="text-anchor: middle">a</text>
    <text x="140" y="25" style="text-anchor: middle">b</text>

    <text x="80" y="65" style="text-anchor: middle">disp</text>

  </g>
</svg>

<p>
The RX instruction format is used for instructions that use a memory
address, which is specified by an index register and a displacement.
The name of the format describes briefly the two operands: a register
(R) and an indexed memory address (X).
</p>

<p>
An RX instruction contains two operands: one is a memory address, and
the other is a register.  Typical RX instructions are loads, stores,
and jumps.  The instruction consists of two consecutive words.  The
first has the same format as an RRR instruction, with four fields: op,
d, sa, sb.  The second word is a single 16-bit binary number, and is
called the displacement.
</p>

<p>
An RX instruction is represented by two words, with the following
fields: op=15, b contains the secondary opcode which specifies which
RX instruction it is, d is the destination, a is the index register,
and the second word is a 16 bit constant called the displacement
(often written disp for short).
</p>

<ul class="org-ul">
<li>op field (bits 0-3 of ir) is f for all RX instructions</li>
<li>d field (bits 4-7 of ir) has several uses</li>
<li>a field (bits 8-11 of ir) is index register for effective address</li>
<li>b field (bits 12-15 of ir) is secondary opcode</li>
<li>disp (displacement) is the second word of the instruction</li>
<li>ea (effective address) = displacement + r[a]</li>
</ul>

<p>
The memory address is specified in two parts: an index register and
the displacement.  The index register is specified in the sa field.
In assembly language, the notation used is number[reg], where the
number is the value of the displacement, and the reg is the index
register.  Thus $20b3[R2] means the address has displacement $20b3 and
the index register is R2.
</p>

<p>
When the machine executes an RX instruction, it begins by calculating
the effective address.  This is abbreviated "ea", and its value is the
sum of the displacement and the contents of the index register.
</p>

<p>
RX instructions are represented in two words, and they use an
"expanding opcode".  That is, the op field of the first word of the
instruction contains the constant f (the bits 1111) for every RX
instruction, and the sb field is used to hold a secondary opcode
indicating which RX instruction it is.
</p>

<p>
The register operand is specified in the d field.  For several RX
instructions, this is indeed the destination of the instruction: for
example, load places data into Rd.  However, a few RX instructions use
the d field differently (see, for example, the conditional jump
instructions).
</p>

<p>
The memory address is specified using the sa field and the
displacement, which is the entire second word of the instruction.
</p>
</div>
</div>

<div id="outline-container-orge7e6c57" class="outline-4">
<h4 id="orge7e6c57">EXP format</h4>
<div class="outline-text-4" id="text-orge7e6c57">
<p>
An EXP instruction contains 14 (hex e) in the op field, and the a and
b fields are combined into a single 8-bit number that contains a
secondary opcode.  This means that the EXP format allows for 256
instructions.  This greatly expands the number of instructions that
can be accommodated, and it allows for experimental instructions for
research purposes.  (The name EXP stands simultaneously for both
EXPansion and EXPerimentation.)
</p>

<svg width="160" height="80" 
  xmlns="http://www.w3.org/2000/svg">

  <title>EXP2 format</title>
  <desc>Fields of EXP2 instruction format</desc>


  <g style="font-size: 14pt; font-family: sans-serif">
  
    <rect x="0" y="0" width="160" height="80"
          style="fill: none; stroke: black"/>
    <line x1="0" y1="40" x2="1600" y2="40" style="stroke: black"/>
    <line x1="40" y1="0" x2="40" y2="80" style="stroke: black"/>
    <line x1="80" y1="0" x2="80" y2="80" style="stroke: black"/>
    <line x1="120" y1="40" x2="120" y2="80" style="stroke: black"/>

    <text x="20" y="25" style="text-anchor: middle">op</text>
    <text x="60" y="25" style="text-anchor: middle">d</text>
    <text x="120" y="25" style="text-anchor: middle">ab</text>

    <text x="20" y="65" style="text-anchor: middle">e</text>
    <text x="60" y="65" style="text-anchor: middle">f</text>
    <text x="100" y="65" style="text-anchor: middle">g</text>
    <text x="140" y="65" style="text-anchor: middle">h</text>

  </g>
</svg>

<p>
There are two variants: EXP1 format requires one word, and EXP
requires two words.  For both variants, the format of the first word
is the same, with op=14 (4 bits), d (4 bits), and ab (8 bits).  The
secondary operation code in the ab field determines whether the
instruction consists of just one word (EXP1) or two (EXP).
</p>

<p>
Some EXP instructions combine the g and h fields to provide an 8-bit
operand.
</p>

<p>
The a and b fields form an 8-bit value called ab.
</p>


<div id="orgd3b3a0e" class="figure">
<p><object type="image/svg+xml" data="svg/EXPformat.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
A second word is needed to represent RX and EXP formats.  There
are individual names for the individual 4-bit fields, as well as names
(disp, gh) for larger fields.
</p>

<ul class="org-ul">
<li>e (bits 0-3) 4-bit operand</li>
<li>f (bits 4-7) 4-bit operand</li>
<li>g (bits 8-11) 4-bit operand</li>
<li>h (bits 12-15) 4-bit operand</li>
<li>gh (bits 8-15) 8-bit operand</li>
<li>disp (bits 0-15) 16 bit operand "displacement"</li>
</ul>
</div>
</div>

<div id="outline-container-org70a0567" class="outline-4">
<h4 id="org70a0567">EXP3 format</h4>
<div class="outline-text-4" id="text-org70a0567">
<p>
The EXP3 format uses three words to represent an instruction.  The
first two words have the same layout as for EXP, and the third word
contains three 5-bit fields and a 1-bit field.  The 5-bit fields
represent numbers in the range from 0 through 31, and are used to
specify bit indexes and field sizes for the 32-bit architecture
extension.
</p>

<svg width="160" height="120" 
  xmlns="http://www.w3.org/2000/svg">

  <title>EXP3 format</title>
  <desc>Fields of EXP3 instruction format</desc>


  <g style="font-size: 14pt; font-family: sans-serif">
  
    <rect x="0" y="0" width="160" height="120"
          style="fill: none; stroke: black"/>
    <line x1="0" y1="40" x2="160" y2="40" style="stroke: black"/>
    <line x1="0" y1="80" x2="160" y2="80" style="stroke: black"/>

    <line x1="40" y1="0" x2="40" y2="80" style="stroke: black"/>
    <line x1="80" y1="0" x2="80" y2="80" style="stroke: black"/>
    <line x1="120" y1="40" x2="120" y2="80" style="stroke: black"/>

    <text x="20" y="25" style="text-anchor: middle">op</text>
    <text x="60" y="25" style="text-anchor: middle">d</text>
    <text x="120" y="25" style="text-anchor: middle">ab</text>

    <text x="20" y="65" style="text-anchor: middle">e</text>
    <text x="60" y="65" style="text-anchor: middle">f</text>
    <text x="100" y="65" style="text-anchor: middle">g</text>
    <text x="140" y="65" style="text-anchor: middle">h</text>

    <line x1="10" y1="80" x2="10" y2="120" style="stroke: black"/>
    <line x1="60" y1="80" x2="60" y2="120" style="stroke: black"/>
    <line x1="110" y1="80" x2="110" y2="120" style="stroke: black"/>

    <text x="35" y="105" style="text-anchor: middle">p</text>
    <text x="85" y="105" style="text-anchor: middle">q</text>
    <text x="135" y="105" style="text-anchor: middle">r</text>

  </g>
</svg>
</div>
</div>
</div>

<div id="outline-container-sec-instruction-set" class="outline-3">
<h3 id="sec-instruction-set">Instructions</h3>
<div class="outline-text-3" id="text-sec-instruction-set">
</div>

<div id="outline-container-orgf1e81d1" class="outline-4">
<h4 id="orgf1e81d1">Arithmetic</h4>
<div class="outline-text-4" id="text-orgf1e81d1">
</div>
<ul class="org-ul">
<li><a id="org23dc5d1"></a>add<br />
<div class="outline-text-5" id="text-org23dc5d1">
<p>
The bits in a word are numbered from right to left, starting at bit
index 0 in the rightmost (least significant) position, up to index 15
at the leftmost (most significant) position.  The notation x.n denotes
the bit in x with index n.
</p>

<p>
A field is a consecutiave sequence of bits within a word.  A field is
specified with the index of the leftmost bit in the field, along with
the size of the field.  For example, the field in x with index 9 and
size 3 consists of the bits x.9 x.8 x.7.
</p>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org9add3e3" class="outline-3">
<h3 id="org9add3e3">Memory</h3>
<div class="outline-text-3" id="text-org9add3e3">
<p>
The memory is a hardware array of words that are accessed by address.
A memory address is 16 bits wide, and there is one memory location
corresponding to each address, so there are 2<sup>16</sup> = 64k memory
locations.  Each memory location is a 16-bit word.
</p>

<p>
Instructions specify memory addresses in two parts: the
<b>displacement</b>, which is a word representing a binary number, and the
<b>index</b>, which is one of the registers in the register file.  For
example, a memory address could be specified as $003c[R5]; the
displacement is 003c and the index is R5.
</p>

<p>
When the instruction is executed, the computer calculates the
<b>effective address</b> by adding the value of the displacement and the
value in the index register.  If R5 contains 2, then the effective
address of $003c[R5] is 003e.
</p>

<p>
This scheme may seem more complicated than simply specifying the
address directly, but it is extraordinarily flexible.  If the machine
language just gave the address as a single binary number, it would be
limited to accessing simple static variables.  The effective address
mechanism is simple to implement in hardware, as you can see in the
digital circuit processor, yet it allows the implementation of local
variables, records, arrays, pointers and linked data structures, jump
tables, and more.  These techniques are described later.
</p>
</div>
</div>

<div id="outline-container-orgf5df672" class="outline-3">
<h3 id="orgf5df672">Registers</h3>
<div class="outline-text-3" id="text-orgf5df672">
</div>
<div id="outline-container-orge1ad717" class="outline-4">
<h4 id="orge1ad717">Register file</h4>
<div class="outline-text-4" id="text-orge1ad717">
<p>
The <b><b>register file</b></b> is a set of 16 general registers that hold a 16
bit word.  A register is referenced by a 4-bit binary number.  In
assembly language, we use the notations R0, R1, R2, &#x2026;, R9, R10, R11,
R12, R13, R14, R15 to refer to the registers.  The state of the
register file can be written as a table showing the value of each
register:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Register</th>
<th scope="col" class="org-left">Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">R0</td>
<td class="org-left">0000</td>
</tr>

<tr>
<td class="org-left">R1</td>
<td class="org-left">fffe</td>
</tr>

<tr>
<td class="org-left">R2</td>
<td class="org-left">13c4</td>
</tr>

<tr>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
</tr>

<tr>
<td class="org-left">R14</td>
<td class="org-left">03c8</td>
</tr>

<tr>
<td class="org-left">R15</td>
<td class="org-left">0020</td>
</tr>
</tbody>
</table>

<p>
Sigma16 is a load/store style architecture; that is, it does not
combine memory accesses with arithmetic.  All calculations are carried
out in the register file, and explicit load and store instructions
must be used to copy data between the memory and the register file.
</p>

<p>
There are some programming conventions that use certain registers for
special purposes.  The hardware does not enforce, or even know about,
these conventions, and you do not have to follow the conventions in
programming.  However, it is necessary to obey the conventions in
order to use the standard software libraries in your program.  See the
section on Programming for a discussion of these standard usage
conventions.
</p>
</div>

<ul class="org-ul">
<li><a id="org1432738"></a>R0 contains the constant 0<br />
<div class="outline-text-5" id="text-org1432738">
<p>
One of the registers, R0, has a special property: it always contains
the constant 0.  It is legal to perform an instruction that attempts
to load some other value into R0, but the register will still contain
0 after executing such an instruction.  Such an instruction will
simply have no lasting effect.
</p>
</div>
</li>

<li><a id="org77b510c"></a>R15 is the condition code register<br />
<div class="outline-text-5" id="text-org77b510c">
<p>
Several instructions produce status information: the result of a
comparison, whether there was an overflow, etc.  This information is
automatically loaded into R15, which is the condition code register.
The description of each instruction states whether R15 is modified,
and what goes into it.
</p>

<p>
The bits in R15 are indexed from bit 0 (the most significant, or
lefttmost bit) to bit 15 (the least significant, or rightmost).  The
condition code bits that have specific meanings are called <b>flags</b>.
</p>

<ul class="org-ul">
<li>Each bit position holds a Boolean value, either False or True,
represented by 0 or 1 respectively.</li>
<li>Each flag gives the status of a relation or event.  If the flag is
True (1) the relation holds or the event has occurred.  If the flag
is False (0) the relation does not hold, or the event has not
occurred.</li>
</ul>

<p>
One way to use flags in the condition code is to control conditional
jumps:
</p>
<ul class="org-ul">
<li>Use jumpc0 to jump if the Boolean is False</li>
<li>Use jumpc1 to jump if the Boolean is True</li>
</ul>

<p>
Another way to use condition code flags is to save them as Boolean
variables and perform logic operations on them.  This is done using
the extract and logicb instructions.
</p>

<p>
There are separate flags for integers (represented as two's complement) and natural
numbers (represented as binary).  This is necessary because the
relation between two words sometimes depends on the type of the data.
For example, consider the word ffff (all 1 bits).  On its own, ffff is
just a word of bits and has no inherent meaning.
</p>
<ul class="org-ul">
<li>If ffff is interpreted as a natural number (i.e. binary), it is
positive and has the value 65,535, and ffff &gt; 0000</li>
<li>If ffff is interpreted as an integer (i.e. two's complement), then
it is negative and has the value -1, and ffff &lt; 0000.</li>
</ul>
<p>
Each flag has a short 1-character name to enable them to be displayed
compactly.  A naming convention is that flags for integers (two's
complement) have lower case letters, while flags for natural numbers
(binary) have upper case letters.  For example:
</p>
<ul class="org-ul">
<li>l means &lt; for integers</li>
<li>L means &gt; for integers</li>
</ul>
<p>
However, equality is the same regardless of type.  If two words
consist of exactly the same bits, then they have the same value as
integers, natural numbers, characters, addresses, and for any other
possible type as well.  Therefore there is only one flag for equality,
and its symbol is =.
</p>

<p>
The following table lists all the condition code flags.  The index is
the bit position in the condition code register (bit index 0 is the
leftmost bit).  The symbol is a character that is displayed if the
flag is 1.  The name is an alphabetic letter used in programs where
the symbol is not allowed: for example you can't have a variable named
is&lt; so isE can be used instead.
</p>

<ul class="org-ul">
<li>index: Each flag has an index which gives its bit position in the
condition code.  Bits are numbered from right to left, starting
with 0.  Thus the least significant bit has index 0, and the most
significant bit has index 15.</li>
<li>meaning: Description using English or mathematical notation</li>
<li>symbol: Character that is displayed when the flag is True</li>
<li>name: Alphabetical name suggested for use within variable names.</li>
</ul>

<p>
There is an exception for division by zero, but no corresponding flag
in the condition code.  The reason is that the div instruction places
the remainder in R15, so the condition code isn't available to
represent division by 0.  You can test explicity for division by 0 by
using jumpz specifying the register containing the divisor <i>before</i>
execuing the div instruction.
</p>

<p>
Bits are indexed from the right, starting from bit 0.  This bit with
index 0 is the least significant, the bit with index 15 is the most
significant bit.
</p>

<p>
Table: Condition code flags
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">bit index</th>
<th scope="col" class="org-left">Relation</th>
<th scope="col" class="org-left">Symbol</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">&gt; Int</td>
<td class="org-left">g</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">&gt; Nat</td>
<td class="org-left">G</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">=</td>
<td class="org-left">=</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">&lt; Nat</td>
<td class="org-left">L</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">&lt; Int</td>
<td class="org-left">&lt;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Int overflow</td>
<td class="org-left">v</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">Nat overflow</td>
<td class="org-left">V</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">Carry</td>
<td class="org-left">C</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">Stack overflow</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">Stack underflow</td>
<td class="org-left">s</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</div>

<div id="outline-container-org5c108b0" class="outline-4">
<h4 id="org5c108b0">Instruction control registers</h4>
<div class="outline-text-4" id="text-org5c108b0">
<p>
There are several instruction control registers that enable the
processor to keep track of the state of the running program.  These
registers are rarely used directly by the machine language program,
but they are essential for keeping track of the execution of the
program, and some instructions use them directly.
</p>

<ul class="org-ul">
<li>ir &#x2013; instruction register (16-bit word)</li>

<li>pc &#x2013; program counter (16-bit word)</li>

<li>adr &#x2013; address register (16-bit word)</li>

<li>dat &#x2013; data register (16-bit word)</li>

<li>status &#x2013; collection of control flags</li>
</ul>
</div>
</div>

<div id="outline-container-org8966926" class="outline-4">
<h4 id="org8966926">System control registers</h4>
<div class="outline-text-4" id="text-org8966926">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">status</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">mask</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">req</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">istat</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">ipc</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">vect</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">psegBeg</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">psecEnd</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">dsegBeg</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">dsegEnd</td>
</tr>
</tbody>
</table>
</div>

<ul class="org-ul">
<li><a id="orge4f08f9"></a>Status register flags<br />
<div class="outline-text-5" id="text-orge4f08f9">
<p>
The processor can be executing in several modes, which are determined
by the <b><b>system control registers</b></b>.
</p>
</div>
</li>

<li><a id="org8debcdf"></a>req and mask registers<br />
<div class="outline-text-5" id="text-org8debcdf">
<p>
Interrupt request and mask bits (req and mask registers)
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">inp</td>
<td class="org-left">input</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">out</td>
<td class="org-left">output</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-left">timer</td>
<td class="org-left">timer interrupt request</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">seg fault</td>
<td class="org-left">segmentation fault</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">bin ovfl</td>
<td class="org-left">natural overflow</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">tc ovfl</td>
<td class="org-left">integer overflow</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">zdiv</td>
<td class="org-left">divide by 0</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">sovfl</td>
<td class="org-left">stack overflow</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">sufl</td>
<td class="org-left">stack underflow</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">utrap</td>
<td class="org-left">user trap</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>sys (bit 0)  &#x2013; system state (1-bit flag)</li>

<li>ie (bit 1)   &#x2013; interrupts enabled (1-bit flag)</li>
</ul>

<p>
Table: Processor status flags
</p>

<p>
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Bit&lt;/th&gt;
    &lt;th&gt;Flag&lt;/th&gt;
    &lt;th&gt;Meaning&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;0&lt;/td&gt;
    &lt;td&gt;**U**&lt;/td&gt;
    &lt;td&gt;User state&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;1&lt;/td&gt;
    &lt;td&gt;**E**&lt;/td&gt;
    &lt;td&gt;Interrupts enabled&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org5741e77" class="outline-4">
<h4 id="org5741e77">Interrupts and exceptions</h4>
<div class="outline-text-4" id="text-org5741e77">
<ul class="org-ul">
<li>mask</li>

<li>req</li>

<li>istat</li>

<li>ipc</li>

<li>vect</li>
</ul>
</div>

<ul class="org-ul">
<li><a id="org220b8f4"></a>Mask and request flags<br />
<div class="outline-text-5" id="text-org220b8f4">
<p>
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Bit&lt;/th&gt;
    &lt;th&gt;Flag&lt;/th&gt;
    &lt;th&gt;Meaning&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;0&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;0&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;1&lt;/td&gt;
    &lt;td&gt;Overflow&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;2&lt;/td&gt;
    &lt;td&gt;Div0&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;3&lt;/td&gt;
    &lt;td&gt;StackFault&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;4&lt;/td&gt;
    &lt;td&gt;SegFault&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;5&lt;/td&gt;
    &lt;td&gt;Privelege&lt;/td&gt;
    &lt;td&gt;Trap&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;6&lt;/td&gt;
    &lt;td&gt;Timer&lt;/td&gt;
    &lt;td&gt;Interrupt&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;7&lt;/td&gt;
    &lt;td&gt;Input&lt;/td&gt;
    &lt;td&gt;Interrupt&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;8&lt;/td&gt;
    &lt;td&gt;Output&lt;/td&gt;
    &lt;td&gt;Interrupt&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</p>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org84488cf" class="outline-3">
<h3 id="org84488cf">Instruction representation</h3>
<div class="outline-text-3" id="text-org84488cf">
<p>
Instructions are represented in the memory of the computer using
words, just like all other kinds of data.  From the programmer's
perspective, an instruction is like a simple statement in a
programming language.  From the circuit designer's perspective,
instructions must be executed using logic gates, and the specific way
it is represented as a word of bits is important.
</p>

<p>
An instruction specifies several pieces of information.  For example,
add R1,R2,R3 is an instruction that says four things: it's an
addition, the operands come from R2 and R3, and the result goes into
R1.  Therefore to represent instructions we need to organize a word as
a collection of several <b>fields</b>, with each field giving one specific
piece of information about the instruction.
</p>

<p>
The particular scheme for describing an instruction as a collection of
fields is called an <b>instruction format</b>.  Like most computers,
Sigma16 has a small number of instruction formats and a larger number of
instructions.  The key to understanding the interface between machine
language and digital circuit design is to master the instruction
formats.
</p>

<p>
The core architecture (the simplest part of the system) uses just two
instruction formats: the <b><b>RRR format</b></b> for instructions that perform
operations in the registers, and the <b><b>RX format</b></b> for instructions
that refer to a memory location.
</p>

<p>
The advanced parts of the architecture provide additional instructions
which are represented with the EXP format. The name EXP stands
simultaneously for <b>expansion</b> (because it provides for many
additional instructions) and <b>experimental</b> (because it allows for
experimentation with the design and implementation of new
instructions).
</p>

<p>
The S32 architecture extends Sigma16 to handle 32-bit words, and it
uses the EXP3 format.
</p>


<p>
Every instruction has a 4-bit field called the opcode (op for short).
This gives 16 values of the opcode: 14 of them (0 through 13) denote
the 14 RRR instructions, described later.  If the op field is 14 (hex
e) the instruction is EXP format and has a secondary opcode in the a
and b fields.  If the op field contains 15 (hex f) the instruction is
RX format with a secondary opcode in the b field.  The instruction
formats are described below.
</p>

<p>
The first word of every instruction contains the
following fields.
</p>

<ul class="org-ul">
<li>op  (bits 0-3) opcode, determines instruction format</li>
<li>d   (bits 4-7) 4-bit destination</li>
<li>a   (bits 8-11) 4-bit operand</li>
<li>b   (bits 12-15) 4-bit operand, or expanded opcode for RX</li>
</ul>


<p>
The details of each format and its fields are given below, and The
following table gives an overview.
</p>
<ul class="org-ul">
<li>Each instruction format has a fixed size, which is the number of
words used to represent any instruction of that format.</li>
<li>These words are subdivided into 4-bit fields, each with a unique
name: op, d, a, b, etc.</li>
<li>The type of instruction is specified by the opcode, which is the op
field for RRR instructions, and which consists of several fields for
the other formats.</li>
<li>The instruction operands are specified by further fields.</li>
<li>Some instructions combine two 4-bit fields into a single 8-bit
field.
<ul class="org-ul">
<li>The a and b fields may be combined to form an 8-bit field called ab
(only for the EXP format)</li>
<li>The g and h fields may be combined to form an 8-bit field called gh</li>
</ul></li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Format</th>
<th scope="col" class="org-right">Size</th>
<th scope="col" class="org-left">Opcode</th>
<th scope="col" class="org-left">Operands</th>
<th scope="col" class="org-left">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">RRR</td>
<td class="org-right">1</td>
<td class="org-left">op</td>
<td class="org-left">d,a,b</td>
<td class="org-left">add Rd,Ra,Rb</td>
</tr>

<tr>
<td class="org-left">RX</td>
<td class="org-right">2</td>
<td class="org-left">op,b</td>
<td class="org-left">d,a disp</td>
<td class="org-left">load Rd,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">EXP</td>
<td class="org-right">2</td>
<td class="org-left">op,ab</td>
<td class="org-left">d,e,f,g,h</td>
<td class="org-left">save Rd,Re,gh[Rf]</td>
</tr>

<tr>
<td class="org-left">EXP3</td>
<td class="org-right">3</td>
<td class="org-left">op,ab</td>
<td class="org-left">d,e,f,g,h,p,q,r</td>
<td class="org-left">extractl</td>
</tr>
</tbody>
</table>

<p>
There are two kinds of format: the machine instruction formats, and
the assembly language instruction statement formats.  There are three
machine instruction formats: RRR, RX, EXP.  However, there is a
larger set of assembly language statement formats, because there are
special syntaxes for some instructions, and there are assembler
directives that aren't instructions at all.  The assembly language
formats are described later.
</p>
</div>

<div id="outline-container-org3c6e609" class="outline-4">
<h4 id="org3c6e609">RRR format</h4>
<div class="outline-text-4" id="text-org3c6e609">
<p>
RRR instructions are represented in one word comprising four 4-bit
fields:
</p>


<div id="org3d374f0" class="figure">
<p><object type="image/svg+xml" data="./svg/RRRformat.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
Each field contains 4 bits representing a binary number between 0
and 15.
</p>

<ul class="org-ul">
<li>op (bits 15 to 12) is the operation code, usually called <i>opcode</i>.
This determines the operation to be performed.  If the opcode is
between 0 and 12 it specifies an RRR instruction.  An opcode greater
than 12 indicates an <i>expanding opcode</i>: the instruction is not RRR
but one of the other formats, and it has a secondary opcode that
specifies precisely which instruction it is.  This is explained in
the sections on RX and EXP formats.</li>
<li>d (bits 11 to 8) is the <i>destination register</i>; the register where
(in most cases) the result will be loaded.</li>
<li>a (bits 7 to 4) is the register containing the first operand.</li>
<li>b (bits 3 to 0) is the register containing the second operand.</li>
</ul>

<p>
In most cases, an RRR instruction takes two operands in registers
specified by the a and b fields and produces a result which is loaded
into the register specified by the d field.  A typical example of an
RRR instruction is add R4,R9,R2, which adds the contents of registers
R9 and R2, and loads the result into R4.  It's equivalent to R4 :=
R9 + R2.  The opcode for add is 0, so the machinen language code for
this instruction is 0492.
</p>
</div>
</div>

<div id="outline-container-org243f765" class="outline-4">
<h4 id="org243f765">RX format</h4>
<div class="outline-text-4" id="text-org243f765">
<p>
RX instructions specify a memory location as well as a register
operand.  The machine language representation is two words:
</p>

<svg width="160" height="80" 
  xmlns="http://www.w3.org/2000/svg">

  <title>RX format</title>
  <desc>Fields of RX instruction format</desc>


  <g style="font-size: 14pt; font-family: sans-serif">
  
    <rect x="0" y="0" width="160" height="80"
          style="fill: none; stroke: black"/>
    <line x1="0" y1="40" x2="1600" y2="40" style="stroke: black"/>
    <line x1="40" y1="0" x2="40" y2="40" style="stroke: black"/>
    <line x1="80" y1="0" x2="80" y2="40" style="stroke: black"/>
    <line x1="120" y1="0" x2="120" y2="40" style="stroke: black"/>

    <text x="20" y="25" style="text-anchor: middle">op</text>
    <text x="60" y="25" style="text-anchor: middle">d</text>
    <text x="100" y="25" style="text-anchor: middle">a</text>
    <text x="140" y="25" style="text-anchor: middle">b</text>

    <text x="80" y="65" style="text-anchor: middle">disp</text>

  </g>
</svg>

<p>
The RX instruction format is used for instructions that use a memory
address, which is specified by an index register and a displacement.
The name of the format describes briefly the two operands: a register
(R) and an indexed memory address (X).
</p>

<p>
An RX instruction contains two operands: one is a memory address, and
the other is a register.  Typical RX instructions are loads, stores,
and jumps.  The instruction consists of two consecutive words.  The
first has the same format as an RRR instruction, with four fields: op,
d, sa, sb.  The second word is a single 16-bit binary number, and is
called the displacement.
</p>

<p>
An RX instruction is represented by two words, with the following
fields: op=15, b contains the secondary opcode which specifies which
RX instruction it is, d is the destination, a is the index register,
and the second word is a 16 bit constant called the displacement
(often written disp for short).
</p>

<ul class="org-ul">
<li>op field (bits 0-3 of ir) is f for all RX instructions</li>
<li>d field (bits 4-7 of ir) has several uses</li>
<li>a field (bits 8-11 of ir) is index register for effective address</li>
<li>b field (bits 12-15 of ir) is secondary opcode</li>
<li>disp (displacement) is the second word of the instruction</li>
<li>ea (effective address) = displacement + r[a]</li>
</ul>

<p>
The memory address is specified in two parts: an index register and
the displacement.  The index register is specified in the sa field.
In assembly language, the notation used is number[reg], where the
number is the value of the displacement, and the reg is the index
register.  Thus $20b3[R2] means the address has displacement $20b3 and
the index register is R2.
</p>

<p>
When the machine executes an RX instruction, it begins by calculating
the effective address.  This is abbreviated "ea", and its value is the
sum of the displacement and the contents of the index register.
</p>

<p>
RX instructions are represented in two words, and they use an
"expanding opcode".  That is, the op field of the first word of the
instruction contains the constant f (the bits 1111) for every RX
instruction, and the sb field is used to hold a secondary opcode
indicating which RX instruction it is.
</p>

<p>
The register operand is specified in the d field.  For several RX
instructions, this is indeed the destination of the instruction: for
example, load places data into Rd.  However, a few RX instructions use
the d field differently (see, for example, the conditional jump
instructions).
</p>

<p>
The memory address is specified using the sa field and the
displacement, which is the entire second word of the instruction.
</p>
</div>
</div>

<div id="outline-container-org27d015b" class="outline-4">
<h4 id="org27d015b">EXP format</h4>
<div class="outline-text-4" id="text-org27d015b">
<p>
An EXP instruction contains 14 (hex e) in the op field, and the a and
b fields are combined into a single 8-bit number that contains a
secondary opcode.  This means that the EXP format allows for 256
instructions.  This greatly expands the number of instructions that
can be accommodated, and it allows for experimental instructions for
research purposes.  (The name EXP stands simultaneously for both
EXPansion and EXPerimentation.)
</p>

<svg width="160" height="80" 
  xmlns="http://www.w3.org/2000/svg">

  <title>EXP2 format</title>
  <desc>Fields of EXP2 instruction format</desc>


  <g style="font-size: 14pt; font-family: sans-serif">
  
    <rect x="0" y="0" width="160" height="80"
          style="fill: none; stroke: black"/>
    <line x1="0" y1="40" x2="1600" y2="40" style="stroke: black"/>
    <line x1="40" y1="0" x2="40" y2="80" style="stroke: black"/>
    <line x1="80" y1="0" x2="80" y2="80" style="stroke: black"/>
    <line x1="120" y1="40" x2="120" y2="80" style="stroke: black"/>

    <text x="20" y="25" style="text-anchor: middle">op</text>
    <text x="60" y="25" style="text-anchor: middle">d</text>
    <text x="120" y="25" style="text-anchor: middle">ab</text>

    <text x="20" y="65" style="text-anchor: middle">e</text>
    <text x="60" y="65" style="text-anchor: middle">f</text>
    <text x="100" y="65" style="text-anchor: middle">g</text>
    <text x="140" y="65" style="text-anchor: middle">h</text>

  </g>
</svg>

<p>
There are two variants: EXP1 format requires one word, and EXP
requires two words.  For both variants, the format of the first word
is the same, with op=14 (4 bits), d (4 bits), and ab (8 bits).  The
secondary operation code in the ab field determines whether the
instruction consists of just one word (EXP1) or two (EXP).
</p>

<p>
Some EXP instructions combine the g and h fields to provide an 8-bit
operand.
</p>

<p>
The a and b fields form an 8-bit value called ab.
</p>


<div id="org316f24d" class="figure">
<p><object type="image/svg+xml" data="svg/EXPformat.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
A second word is needed to represent RX and EXP formats.  There
are individual names for the individual 4-bit fields, as well as names
(disp, gh) for larger fields.
</p>

<ul class="org-ul">
<li>e (bits 0-3) 4-bit operand</li>
<li>f (bits 4-7) 4-bit operand</li>
<li>g (bits 8-11) 4-bit operand</li>
<li>h (bits 12-15) 4-bit operand</li>
<li>gh (bits 8-15) 8-bit operand</li>
<li>disp (bits 0-15) 16 bit operand "displacement"</li>
</ul>
</div>
</div>

<div id="outline-container-org503db1d" class="outline-4">
<h4 id="org503db1d">EXP3 format</h4>
<div class="outline-text-4" id="text-org503db1d">
<p>
The EXP3 format uses three words to represent an instruction.  The
first two words have the same layout as for EXP, and the third word
contains three 5-bit fields and a 1-bit field.  The 5-bit fields
represent numbers in the range from 0 through 31, and are used to
specify bit indexes and field sizes for the 32-bit architecture
extension.
</p>

<svg width="160" height="120" 
  xmlns="http://www.w3.org/2000/svg">

  <title>EXP3 format</title>
  <desc>Fields of EXP3 instruction format</desc>


  <g style="font-size: 14pt; font-family: sans-serif">
  
    <rect x="0" y="0" width="160" height="120"
          style="fill: none; stroke: black"/>
    <line x1="0" y1="40" x2="160" y2="40" style="stroke: black"/>
    <line x1="0" y1="80" x2="160" y2="80" style="stroke: black"/>

    <line x1="40" y1="0" x2="40" y2="80" style="stroke: black"/>
    <line x1="80" y1="0" x2="80" y2="80" style="stroke: black"/>
    <line x1="120" y1="40" x2="120" y2="80" style="stroke: black"/>

    <text x="20" y="25" style="text-anchor: middle">op</text>
    <text x="60" y="25" style="text-anchor: middle">d</text>
    <text x="120" y="25" style="text-anchor: middle">ab</text>

    <text x="20" y="65" style="text-anchor: middle">e</text>
    <text x="60" y="65" style="text-anchor: middle">f</text>
    <text x="100" y="65" style="text-anchor: middle">g</text>
    <text x="140" y="65" style="text-anchor: middle">h</text>

    <line x1="10" y1="80" x2="10" y2="120" style="stroke: black"/>
    <line x1="60" y1="80" x2="60" y2="120" style="stroke: black"/>
    <line x1="110" y1="80" x2="110" y2="120" style="stroke: black"/>

    <text x="35" y="105" style="text-anchor: middle">p</text>
    <text x="85" y="105" style="text-anchor: middle">q</text>
    <text x="135" y="105" style="text-anchor: middle">r</text>

  </g>
</svg>
</div>
</div>
</div>

<div id="outline-container-sec-instruction-set" class="outline-3">
<h3 id="sec-instruction-set">Instructions</h3>
<div class="outline-text-3" id="text-sec-instruction-set">
</div>

<div id="outline-container-orgb4d11c9" class="outline-4">
<h4 id="orgb4d11c9">Arithmetic</h4>
<div class="outline-text-4" id="text-orgb4d11c9">
</div>
<ul class="org-ul">
<li><a id="org3f7390e"></a>add<br />
<div class="outline-text-5" id="text-org3f7390e">
<pre class="example" id="orgc2fe1c4">
add R1,R2,R3    ; R1 := R2 + R3
</pre>

<p>
The instruction add Rd,Ra,Rb has operands Ra and Rb and destination
Rd.  It fetches the operands Ra and Rb, calculates the sum Ra + Rb,
and loads the result into the destination Rd.  The effect is Rd :=
Ra + Rb.  For example, add R5,R12,R2 performs R5 := R12 + R3.
</p>

<p>
The add instruction is RRR format with opcode=0.  Given destination Rd
and operands Ra and Rb (where d, a, b are hex digits), add Rd,Ra,Rb is
reprseented by 0dab.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Code</th>
<th scope="col" class="org-left">Assembly</th>
<th scope="col" class="org-left">Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">062c</td>
<td class="org-left">add R6,R2,R12</td>
<td class="org-left">; R6 := R2 + R12</td>
</tr>

<tr>
<td class="org-left">0d13</td>
<td class="org-left">add R13,R1,R3</td>
<td class="org-left">; R13 := R1 + R3</td>
</tr>
</tbody>
</table>

<p>
In addition to setting the destination register, the add instruction
sets several bits in the condition code R15 and may set a bit in the
req register.
</p>

<p>
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
 R15.ccG    result &gt; 0 (binary)
 R15.ccg    result &gt; 0 (two's complement)
 R15.ccE    result = 0
 R15.ccl    result &lt;tc 0 (two's complement)
 R15.ccV    overflow (binary)
 R15.CCv    overflow (two's complement)
 R15.CCc    carry output
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
</p>

<p>
The add instruction can be used for both binary addition (on natural
numbers) and for two's complement addition (on signed integers).
</p>

<ul class="org-ul">
<li>16-bit natural numbers are unsigned integers 0, 1, 2, &#x2026;, 65535.
If two natural numbers are added, the result is a natural number
(the result cannot be negative).  If the result is 65536 or larger,
it cannot be represented as a 16 bit binary number.  If this
happens, the destination register is set to the lower 16 bits of the
true result, and the binary overflow flag is set in the Condition Code.</li>

<li>16-bit two's complement numbers are signed integers -32999?, &#x2026;,
-1, 0, 1, &#x2026;, 32???.  If two signed integers are added, the result
is a signed integer.  If the result is less than -32000 or greater
than 32000, then the result cannot be represented as a 16 bit two's
complement number.  If this happens, the destination register is set
to the lower 16 bits of the true result, and the two's complement
overflow flag is set in the Condition Code.  Furthermore, the
overflow flag is set in the req register.  If interrupts are enabled
and the overflow flag is 1 in the mask register, then an interrupt
will occur immediatelhy after the add instruction executes.</li>
</ul>

<p>
The add instruction can be used for both binary addition (on natural
numbers) and for two's complement addition (on signed integers).
</p>

<ul class="org-ul">
<li>16-bit natural numbers are unsigned integers 0, 1, 2, &#x2026;, 65535.
If two natural numbers are added, the result is a natural number
(the result cannot be negative).  If the result is 65536 or larger,
it cannot be represented as a 16 bit binary number.  If this
happens, the destination register is set to the lower 16 bits of the
true result, and the binary overflow flag is set in the Condition Code.</li>

<li>16-bit two's complement numbers are signed integers -32999?, &#x2026;,
-1, 0, 1, &#x2026;, 32???.  If two signed integers are added, the result
is a signed integer.  If the result is less than -32000 or greater
than 32000, then the result cannot be represented as a 16 bit two's
complement number.  If this happens, the destination register is set
to the lower 16 bits of the true result, and the two's complement
overflow flag is set in the Condition Code.  Furthermore, the
overflow flag is set in the req register.  If interrupts are enabled
and the overflow flag is 1 in the mask register, then an interrupt
will occur immediatelhy after the add instruction executes.</li>
</ul>
</div>
</li>

<li><a id="org87e0420"></a>sub<br />
<div class="outline-text-5" id="text-org87e0420">
<p>
Example: sub R1,R2,R3 ; R1 := R2 - R3
</p>

<p>
This instruction is similar to add; the only difference is that it
calculates R2-R3 and places the result in R1.  The effect on the
condition code is the same as for add.
</p>

<p>
The instruction sub Rd,Ra,Rb has operands Ra and Rb and destination
Rd.  It fetches the operands Ra and Rb, calculates the difference Ra -
Rb, and loads the result into the destination Rd.  The effect is Rd :=
Ra - Rb.  For example, sub R5,R12,R2 performs R5 := R12 - R3.
</p>

<p>
The sub instruction is RRR format with opcode=1.
</p>

<p>
Code    Assembly          Effect
&#x2013;&#x2014;   -----------&#x2013;&#x2014;  -------------&#x2013;&#x2014;
162c    sub R6,R2,R12     ; R6 := R2 - R12
1d13    sub R13,R1,R3     ; R13 := R1 - R3
</p>

<p>
In addition to setting the destination register, the sub instruction
sets several bits in the condition code R15 and may set a bit in the
req register.
</p>

<p>
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
 R15.ccG    result &gt; 0 (binary)
 R15.ccg    result &gt; 0 (two's complement)
 R15.ccE    result = 0
 R15.ccl    result &lt; 0 (two's complement)
 R15.ccV    overflow (binary)
 R15.CCv    overflow (two's complement)
 R15.CCc    carry output
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
</p>
</div>
</li>

<li><a id="orgb2b0f04"></a>mul<br />
<div class="outline-text-5" id="text-orgb2b0f04">
<p>
Example: mul R1,R2,R3 ; R1 := R2 * R3
</p>

<p>
The multiply instruction mul Rd,Ra,Rb calculates the integer (two's
complement) product of the operands Ra and Rb, and places the result
in the destination register Rd.  The mul instruction does not produce
the natural (binary) product.
</p>

<p>
If the magnitude of the product is too large to be representable as a
16 bit two's complement integer, this is an overflow.  If overflow
occurs, the integer overflow bit is set in the condition code (F15)
and the integer overflow bit is also set in the interrupt request
register (req), and the lower order 16 bits of the product are loaded
into Rd.
</p>

<p>
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
 R15.ccg    result &gt; 0 (two's complement)
 R15.ccE    result = 0
 R15.ccl    result &lt; 0 (two's complement)
 R15.CCv    overflow (two's complement)
 R15.CCc    carry output
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
</p>
</div>
</li>

<li><a id="orgd2e4a57"></a>div<br />
<div class="outline-text-5" id="text-orgd2e4a57">
<p>
Example: div R1,R2,R3 ; R1 := R2 / R3, R15 := R2 rem R3
</p>

<p>
Unlike the other arithmetic operations, the divide instruction div
Rd,Ra,Rb produces two results: the quotient Ra / Rb and the remainder
Ra rem Rb.  It loads the quotient into the destination register Rd,
and the remainder is loaded into R15.
</p>

<p>
If the destination register Rd is actually R15, then the quotient is
placed in R15, and the remainder is discarded.
</p>

<p>
The divide instruction doesn't set the condition code, since R15 is
used for the remainder.  Therefore there is no condition code bit to
indicate division by 0.  However, it is easy for a program to detect a
division by 0.
</p>

<ul class="org-ul">
<li>(Explicit test for error) The program can compare the divisor with 0
before or after executing the divide instruction, and jump to an
error handler if the divisor is 0.  This is similar to testing the
condition code after an add, sub, or mul instruction, but it does
require two instructions: a compare followed by a conditional jump.
For example:</li>
</ul>

<pre class="example" id="orgca7e7fe">
div    R1,R2,R3       ; R1 := R2/R3, R15 := R2 rem R3
cmp    R3,R0       ; Did we divide by 0?
jumpeq zeroDivide[R0] ; If yes, handle error
</pre>

<ul class="org-ul">
<li>(Exception) The program can detect division by 0 using an interrupt.
To do this, enable interrupts and enable the interrupt mask for
division by 0.  See the section on Interrupts.  This approach does
not require a compare or jump instruction for each division.</li>
</ul>
</div>
</li>

<li><a id="orgccd2780"></a>addc<br />
<div class="outline-text-5" id="text-orgccd2780">
<p>
The addc instruction performs a binary addition with carry
propagation.  It adds the two operand registers and the carry bit in
the condition code register, R15.  The sum is loaded into the
destination register Rd and the carry output is written back into the
carry bit, overwriting its previous value.  Overflow is not possible
with this instruction.
</p>
</div>
</li>

<li><a id="org17dce63"></a>muln<br />
<div class="outline-text-5" id="text-org17dce63">
<pre class="example" id="orgdc58f00">
muln   Rd,Ra,Rb
</pre>

<p>
The muln instruction calculates the product of two natural numbers in
Ra and Rb.  The result is 32 bits; the leftmost 16 bits (the most
significant part) is loaded into R15, and the rightmost 16 bits (the
least significant part) is loaded into Rd.  If Rd is R15, the most
significant part is discarded.
</p>
</div>
</li>

<li><a id="org955faa1"></a>divn<br />
<div class="outline-text-5" id="text-org955faa1">
<pre class="example" id="org5fa216e">
divn   Rd,Ra,Rb
</pre>

<p>
The divn instruction divides two natural numbers: dividend / divisor.
All the numbers &#x2013; numerator, denominator, quotient, remainder &#x2013; are
natural numbers represented in binary.
</p>

<ul class="org-ul">
<li>The dividend is a 32 bit natural number; its leftmost 16 bits are in
R15 and the rightmost 16 bits are in Ra.  Thedenominator is in Rb.</li>
<li>Two results are produced: a 32-bit quotient anda 16-bit remainder.</li>
<li>The leftmost 16 bits of the quotient are placedin R15 (replacing the
leftmost part of the dividend).  The rightmost16 bits of the
quotient are placed in Rd.</li>
<li>The remainder is placed in Ra, overwriting the least significant
half of the dividend operand</li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-org922633e" class="outline-4">
<h4 id="org922633e">Memory</h4>
<div class="outline-text-4" id="text-org922633e">
<p>
A memory address is a 16-bit binary number.  Instructions don't
specify addresses directly; they specify an address with two
components: a <b>displacement</b> and an <b>index</b>, written as
"displacement[index]".  The displacement is a 16 bit constant, and in
assembly language it may be given as a decimal integer, a hexadecimal
word, or a label.  The index is a register.  For example,$0c45[R5] has a
displacement of 0c45 and an index of R5.
</p>

<p>
When an instruction executes, the machine takes the displacement and
index and calculates the <b>effective address</b>.  This is defined to be
the binary sum of the displacement and the curent value in the index
register.  In the example above, if R5 contains 3, then the effective
address of $0c45[R5] is $0c48.
</p>

<p>
If you just want to specify an address <b>a</b> in an instruction, this can
be written as "a[R0]".  Since R0 contains the constant 0, the
effective address is just <b>a</b>.
</p>
</div>

<ul class="org-ul">
<li><a id="org84218d9"></a>lea<br />
<div class="outline-text-5" id="text-org84218d9">
<p>
The <b><b>load effective address</b></b> instruction <b>lea Rd,disp[Rx]</b> calculates
the effective address of the operand disp[Rx] and places the result in
the destination register Rd.  The effective address is the binary sum
disp+Rx.
</p>
</div>
</li>

<li><a id="orgde76a72"></a>load<br />
<div class="outline-text-5" id="text-orgde76a72">
<p>
The <b><b>load</b></b> instruction <b>load Rd,disp[Rx]</b> calculates the effective
address of the operand disp[Rx] and copies the word in memory at the
effective address into the destination register Rd.  The effective
address is the binary sum disp+Rx.
</p>

<p>
------------&#x2013;&#x2014;   ------------------------------------&#x2013;&#x2014;
general form        load Rd,disp[Ra]
effect              reg[Rd] := mem[disp+reg[Ra]]
machine format      RX
assembly format     RX
------------&#x2013;&#x2014;   ------------------------------------&#x2013;&#x2014;
</p>

<p>
Examples
</p>
<pre class="example" id="org5fe7c1c">
load  R12,count[R0]   ; R12 := count
load  R6,arrayX[R2]   ; R6 := arrayX[R2]
load  R3,$2b8e[R5]    ; R3 := mem[2b8e+R5]
</pre>
</div>
</li>

<li><a id="orgf214ab9"></a>store<br />
<div class="outline-text-5" id="text-orgf214ab9">
<p>
The <b><b>store</b></b> instruction <b>store Rd,disp[Rx]</b> calculates the effective
address of the operand disp[Rx] and the value of the destination
register Rd into memory at the effective address.  The effective
address is the binary sum disp+Rx.
</p>

<p>
------------&#x2013;&#x2014;   ------------------------------------&#x2013;&#x2014;
general form        store Rd,disp[Ra]
effect              mem[disp+reg[Ra]] := reg[Rd]
machine format      RX
assembly format     RX
------------&#x2013;&#x2014;   ------------------------------------&#x2013;&#x2014;
</p>

<p>
Store copies the word in the destination register into memory at the
effective address.  This instruction is unusual in that it treats the
"destination register" as the source of data, and the actual
destination which is modified is the memory location.
</p>

<p>
Most instructions take data from the rightmost operands and modify the
leftmost destination, just like an assignment statement (x := y+z).
However, the store instruction operates in the opposite direction.
The reason for this has to do with the circuit design of the
processor.  Although the "left to right" nature of the store
instruction may look inconsistent from the programmer's point of view,
it actually is more consistent from the deeper perspective of circuit
design.
</p>

<p>
Examples
</p>

<pre class="example" id="orgbb9a880">
store  R3,$2b8e[R5]
store  R12,count[R0]
store  R6,arrayX[R2]
</pre>
</div>
</li>

<li><a id="org4b3596d"></a>Stack representation<br />
<div class="outline-text-5" id="text-org4b3596d">
<p>
Three instructions (push, pop, top) support operations on a stack
represented as an array of contiguous elements, where the stack grows
from lower to higher addresses.  These instructions provide safe
operations: they never overwrite memory outside the stack, and they
indicate stack underflow and overflow by setting the condition code
and optionaly performing an exception.
</p>

<p>
A stack is represented by three addresses, which are provided to the
push, pop, and top instructions in registers:
</p>
<ul class="org-ul">
<li>The <i>stack base</i> is the address of the first word allocated for the
stack.</li>
<li>The <i>stack limit</i> is the address of the last word allocated for the
stack.</li>
<li>The <i>stack top</i> is the address of the stack element that was pushed
most recently.</li>
</ul>

<p>
Although three addresses are required to characterise the state of a
stack, each individual stack instruction (push, pop, top) requires
only two of those addresses.  These are supplied as the Ra and Rb
operands, while Rd is used to supply or receive the data value.
</p>

<p>
The maximum number of elements the stack may contain is <i>stack
limit</i> - <i>stack base</i> + 1.  Normally, <i>stack limit</i> is greater than
<i>stack base</i>.  If they are equal, there is only one word allocated for
the stack (which is generally not useful), and if <i>stack base</i> &gt;
<i>stack limit</i> then no memory at all is allocated and every stack
operation will signal an underflow or overflow error.
</p>

<p>
If the stack is not empty, then <i>stack top</i> is the address of the top
element in the stack.  If the stack is empty, then <i>stack top</i> must be
<i>stack base</i> - 1.
</p>

<p>
A stack can be created and initialized by allocating a region of
memory, setting <i>stack base</i> to the first word and <i>stack limit</i> to
the last word, and setting <i>stack top</i> to <i>stack base</i> - 1.
</p>
</div>
</li>

<li><a id="org32869c2"></a>push<br />
<div class="outline-text-5" id="text-org32869c2">
<p>
The push instruction pushes an element onto a stack.  It is RRR
format, and its general form is:
</p>

<pre class="example" id="org2dd7a44">
push   Rd,Ra,Rb
</pre>

<ul class="org-ul">
<li>Rd = <i>stack data</i>: value to be pushed, unchanged</li>
<li>Ra = <i>stack top</i>: incremented unless stack was full</li>
<li>Rb = <i>stack limit</i>: unchanged</li>
<li>R15 condition code indicates stack overflow</li>
<li>System interrupt request register indicates stack overflow</li>
</ul>

<p>
This instruction pushes the word in Rd onto a stack with <i>stack top</i>
in Rd and <i>stack limit</i> in Rb, provided that the stack is not full.
The push stores the data word in Ra into memory and increments <i>stack
top</i> Rd.  If the stack is full, nothing is stored into memory and a stack
overflow error is indicated in the condition code and interrupt
request registers; an interrupt will occur if interrupts are enabled
and the stack mask bit is set.  The operational semantics is:
</p>

<pre class="example" id="orgd1384e0">
if Ra &lt; Rb
  then Ra := Ra + 1; mem[Ra] := Rd
  else R15.sovfl := 1, req.sovfl := 1
</pre>

<p>
If Rd = Rb this means the stack completely fills the region of memory
allocated for the stack, and there is no space to store a new element.
In this case, the push instruction does not store Ra, it doesn't
modify Rd, it doesn't modify memory outside the block, and it doesn't
overwrite data in the stack.  Instead, the instruction indicates a
stack overflow by setting the sovfl (stack overflow) bit in the
condition code (R15), and it also sets the stack fault bit in the
interrupt request register.  If interrupts are enabled and the stack
fault bit is set in the interrupt mask register, then an interrupt
will occur after the push instruction completes.  There will be no
interrupt if interrupts are disabled, or the stack fault bit is not
set in the mask register.
</p>
</div>
</li>

<li><a id="org06271fe"></a>pop<br />
<div class="outline-text-5" id="text-org06271fe">
<p>
The push instruction removes an element onto a stack and returns it.
The instruction is RRR format, and its general form is:
</p>

<pre class="example" id="orgd53af35">
pop    Rd,Ra,Rb
</pre>

<ul class="org-ul">
<li>Rd = <i>stack data</i>: destination for the popped stack element</li>
<li>Ra = <i>stack top</i>: decremented unless stack was empty</li>
<li>Rb = <i>stack base</i>: unchanged</li>
<li>R15 condition code indicates stack underflow</li>
<li>System interrupt request register indicates stack underflow</li>
</ul>

<p>
This instruction pops the word from a stack with <i>stack top</i> in Ra and
<i>stack base</i> in Rb, provided that the stack is not empty.  The pop
loads the top element of the stack into Rd and decrements <i>stack top</i>.
If the stack is empty, <i>stack top</i> is not decremented, Rd is not
modified, and a stack underflow error is indicated in the condition
code and interrupt request registers; an interrupt will occur if
interrupts are enabled and the stack mask bit is set.  The operational
semantics is:
</p>

<pre class="example" id="orgdb35ab0">
if Ra &gt;= Rb
  then Rd := mem[Ra]; Ra := Ra - 1
  else R15.suvfl := 1, req.suvfl := 1
</pre>
</div>
</li>

<li><a id="org27b0538"></a>top<br />
<div class="outline-text-5" id="text-org27b0538">
<p>
The top instruction returns the top element on a stack but does not
remove it.  The instruction is RRR format, and its general form is:
</p>

<pre class="example" id="org583fbda">
top    Rd,Ra,Rb
</pre>

<ul class="org-ul">
<li>Rd = <i>stack data</i>: destination for the top element of the stack;
unchanged if stack is empty</li>
<li>Ra = <i>stack top</i>: unchanged</li>
<li>Rb = <i>stack base</i>: unchanged</li>
<li>R15 condition code indicates stack underflow</li>
<li>System interrupt request register indicates stack underflow</li>
</ul>

<p>
This instruction loads the element at <i>stack top</i> into Rd, provided
that the stack is not empty.  If the stack is empty, Rd is not
modified and a stack underflow error is indicated in the condition
code and interrupt request registers; an interrupt will occur if
interrupts are enabled and the stack mask bit is set.  The operational
semantics is:
</p>

<pre class="example" id="org5e0df39">
if Ra &gt;= Rb
  then Rd := mem[Ra]
  else R15.suvfl := 1, req.suvfl := 1
</pre>
</div>
</li>

<li><a id="orge4961f4"></a>save<br />
<div class="outline-text-5" id="text-orge4961f4">
<p>
The <b>save</b> instruction stores a sequence of adjacent registers into a
block of contiguous memory locations.  The sequence of registers is
specified by giving the first and last register, and the starting
address of the memory block is specified by the effective address.
The instruction does not change the value of any register, including
the index register.
</p>

<p>
A save instruction is equivalent to a fixed sequence of store
instructions; The save instruction stores a set of contiguous
registers into memory.  The starting address of the memory block is
specified by an index register and an 8-bit displacement.  The
instruction <b>save Re,Rf,gh[Ra]</b> stores the contents of Re, Re+1, &#x2026;,
Rf into memory at consecutive locations beginning with <b>mem[Ra+gh]</b>.
</p>

<p>
For example, the following save instruction
</p>

<pre class="example" id="org289e948">
save R2,R9,20[R14]
</pre>

<p>
is equivalent to the following sequence of store instructions:
</p>

<pre class="example" id="orgddae14a">
store  R2,20[R14]
store  R3,21[R14]
store  R4,22[R14]
store  R5,23[R14]
store  R6,24[R14]
store  R7,25[R14]
store  R8,26[R14]
store  R9,27[R14]
</pre>

<p>
The assembly language notation for a save instruction is similar to an
RX instruction, but two registers are used to specify a block of
registers, and the displacement is an 8-bit field gh. Its assembly
language operand format is RRX.  Because of these differences, save is
an EXP format instruction:
</p>

<pre class="example" id="orga3bc3fd">
save Rd,Re,gh[Rf]
</pre>

<p>
asm format RRx  (x is short displacement and index register)
</p>

<p>
The purpose of save is to copy the state of a block of
registers into memory during a procedure call or a context switch.
The registers can be reloaded by the restore instruction.
</p>



<p>
The instruction is EXP format, and the offset is limited to 8 bits,
because it is specified in the <b>gh</b> field, which is the rightmost 8
bits of the second word of the instruction.  The secondary opcode is
8, which is in the ab field of the first word of the instruction.
</p>

<p>
The first register to be saved is in the <b>e</b> field, and the last
register to be saved is in the <b>f</b> field.  The instruction always
stores at least one register.  If <b>e</b> and <b>f</b> are the same, for
example <b>save R5,R5,0[F14]</b> then that register (R5 in the example) is
stored.  If <b>e</b> &gt; <b>f</b> then the register numbers wrap around  For
example, 
</p>

<pre class="example" id="orgb6818c4">
save    R11,R3,3[R5]
</pre>

<p>
is equivalent to
</p>
<pre class="example" id="orgef301ae">
store   R11,3[R5]
store   R12,4[R5]
store   R13,5[R5]
store   R14,6[R5]
store   R15,7[R5]
store   R0,8[R5]
store   R1,9[R5]
store   R2,10[R5]
store   R3,11[R5]
</pre>
</div>
</li>

<li><a id="org043bd2a"></a>restore<br />
<div class="outline-text-5" id="text-org043bd2a">
<p>
Restore Rd,disp[Ra] loads R1, &#x2026;, Rd from consecutive memory
locations starting from the effective address.
For example,
</p>

<pre class="example" id="org2d46790">
restore R5,20[R14]
</pre>

<p>
is equivalent to
</p>

<pre class="example" id="org2f8977c">
load   R1,20[R14]
load   R2,21[R14]
load   R3,22[R14]
load   R4,23[R14]
load   R5,24[R14]
</pre>

<p>
The <b><b>restore</b></b> instruction copies a sequence of consecutive memory
locations starting from the effecive address into a sequence of
adjacent registers.  The index register (R14 in this example) is not
changed.  Restore is equivalent to a fixed sequence of load
instructions; its purpose of restore is to restore the state of
registers from memory after a procedure call or a context switch.
</p>

<p>
Typically, save is used as part of a procedure call and restore is
used as part of the return.
</p>

<p>
The instruction <b>restore Re,Rf,gh[Rd]</b> copies the contents of memory
at consecutive locations beginning with mem[gh+Rf] into registers Re,
Re+1, &#x2026;, Rf.
</p>

<p>
The instruction is EXP format, and the displacement is limited to 8
bits, because it is specified in the gh field (the rightmost 8 bits)
of the second word of the instruction.  The secondary opcode is 9,
which is in the ab field of the first word of the instruction. The
assembly language statement format is RRXEXP.
</p>

<p>
For example, consider this instruction:
</p>
<pre class="example" id="orgaaedd3a">
restore  R3,R10,4[R14]
</pre>

<p>
The effect is equivalent to
</p>

<pre class="example" id="org860d5db">
load  R3,4[R14]
load  R4,5[R14]
load  R5,6[R14]
load  R6,7[R14]
load  R7,8[R14]
load  R8,9[R14]
load  R9,10[R14]
load  R10,11[R14]
</pre>
</div>
</li>
</ul>
</div>

<div id="outline-container-org5321f2e" class="outline-4">
<h4 id="org5321f2e">Logic and bits</h4>
<div class="outline-text-4" id="text-org5321f2e">
<p>
The instructions in this section treat a word as a sequence of bits,
not as a number.  There are instructions that perform logic operations
on individual bits, on all the bits in a word, and that operate on bit
fields.
</p>

<p>
The bits in a word x are indexed from 0 to 15, where 0 is the index of
the leftmost (most significant) bit and 15 is the index or the
rightmost (least significant) bit.  The notation x.i means the bit
with index i in the word x.  For example, x.0 is the leftmost bit and
x.15 is the rightmost bit.  When used in an instruction, a bit index
is specified as a 4-bit binary number <i>i</i> such that 0 &lt;= <i>i</i> &lt;= 15.
</p>

<p>
A bit field is a contiguous sequence of bits in a word.  It is
specified by the register containing a word, the index of the starting
bit in the field, and the size of the field.
</p>

<p>
The bit field instructions can be implemented using a combination of
logic and shift instructions.  They are included in the architecture
for several reasons:
</p>

<ul class="org-ul">
<li>These operations provide useful abstractions for writing
interpreters and simulators.</li>
<li>When used in an interpreter, bit field operations are executed
frequently: they are a crucial part of the "inner loop".  Therefore
the efficiency of common bit field operations is important.</li>
<li>The bit field instructions are easier to use and more readable than
the corresponding logic and shifts.</li>
<li>These instructions can be implemented efficiently in a digital
circuit and this implementation is an interesting design problem.</li>
</ul>
</div>

<ul class="org-ul">
<li><a id="orgefbdbe6"></a>cmp<br />
<div class="outline-text-5" id="text-orgefbdbe6">
<p>
The compare instruction <code>cmp Ra,Rb</code> compares the values in the operand
registers <code>Ra</code> and <code>Rb</code>, and then sets flags in the condition code
(R15) to indicate the result. The notation R15.i means bit <i>i</i> in R15;
thus R15.0 is the leftmost bit of R15.  The instruction performs both
natural number comparison (binary) and integer comparison (two's
complement).  The resulting flags are
</p>

<ul class="org-ul">
<li>binary less than (L) in R15.0</li>
<li>two's complement less than (&lt;) in R15.1</li>
<li>equal in R15.2</li>
<li>binary greater than (G) in R15.3</li>
<li>two's complement greater than (&gt;) in R15.4</li>
</ul>

<p>
The result of a cmp instruction can be used to control a conditional
jump.  The jumpc0 instruction jumps is a specified bit of R15 is 0,
and the jumpc1 instruction jumps if a specified bit is 1.
</p>

<p>
Pseudoinstructions provide the most common cases; for example jumple
jumps if the condition code indicates that a comparison produced
either integer less-than or equal.  A common pattern is a cmp followed
by a jump pseudoinstruction, for example:
</p>

<pre class="example" id="org778277c">
cmp     R4,R9      ; compare R4 with R9
jumpgt  abc]R0]    ; if R4 &gt; R9 then goto abc
</pre>
</div>
</li>

<li><a id="org856fd4b"></a>logicw<br />
<div class="outline-text-5" id="text-org856fd4b">
<p>
The logicw instruction performs a bitwise logic operation on two
operands: each bit of the result is obtained by performing the logic
function on the corresponding bits of the two operands.  The
instruction allows an arbitrary logic function on two bits.
</p>

<p>
A logic function is specified by g; the function itself is denoted
<b>function g</b>.  This function is applied to the two operand registers
Re and Rf, and the result is loaded into the destination register Rd.
</p>

<ul class="org-ul">
<li>General form: logicw Rd,Re,Rf,g</li>
<li>Instruction format: EXP</li>
<li>Assembly format: RRRKEXP</li>
<li>Rd := (function g) Re Rf</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">y</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-left">a</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-left">b</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-left">c</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">d</td>
</tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">abcd</td>
<td class="org-right">hex</td>
<td class="org-left">function</td>
</tr>

<tr>
<td class="org-right">0000</td>
<td class="org-right">0</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">0001</td>
<td class="org-right">1</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">0010</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">0011</td>
<td class="org-right">3</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">0100</td>
<td class="org-right">4</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">0101</td>
<td class="org-right">5</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">0110</td>
<td class="org-right">6</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">0111</td>
<td class="org-right">7</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1000</td>
<td class="org-right">8</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1001</td>
<td class="org-right">9</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1010</td>
<td class="org-right">10</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1011</td>
<td class="org-right">11</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1100</td>
<td class="org-right">12</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1101</td>
<td class="org-right">13</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1110</td>
<td class="org-right">14</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1111</td>
<td class="org-right">15</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">y</th>
<th scope="col" class="org-right">x and y</th>
<th scope="col" class="org-right">x xor y</th>
<th scope="col" class="org-right">x or y</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">1</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">y</th>
<th scope="col" class="org-right">x nor y</th>
<th scope="col" class="org-right">inv y</th>
<th scope="col" class="org-right">inv x</th>
<th scope="col" class="org-right">x nand y</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">8</td>
<td class="org-right">a</td>
<td class="org-right">c</td>
<td class="org-right">e</td>
</tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">function</th>
<th scope="col" class="org-right">abcd</th>
<th scope="col" class="org-right">code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">and</td>
<td class="org-right">0001</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">or</td>
<td class="org-right">0111</td>
<td class="org-right">7</td>
</tr>

<tr>
<td class="org-left">xor</td>
<td class="org-right">0110</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-left">inv x</td>
<td class="org-right">1100</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-left">inv y</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</li>

<li><a id="org6e93c38"></a>logicb<br />
<div class="outline-text-5" id="text-org6e93c38">
<p>
The <i>logicb</i> instruction performs an arbitrary Boolean logic function
on two operand bits, producing a result bit.  All three bits must be
in the same register.  If a program keeps a collection of Boolean
variables in one register, logicb supports evaluation of general
expressions using those variables.
</p>

<p>
This logicb instruction performs R1.3 := R1.9 xor R1.2:
</p>

<pre class="example" id="orgb71881f">
logicb  R1,3,9,2,6
logicb  d,e,f,g,h
</pre>

<p>
This instruction performs logic on bits within R1.  The logic function
is 6 (see Logic Functions), the operands are bits 9 and 2, and the
result is placed into bit 3.  The instruction could be read as: within
R1, perform logic function 6 on bits 9 and 2, and place the result in
bit 3.
</p>

<p>
Pseudoinstructions are provided for the most common logic functions;
these all generate a logicb instruction.  The operands for these are
the same as for logicb, except that the last operand (the logic
function) is omitted.  Since the logical negation (invert) function
has only one operand, the invb pseudoinstruction also omits the second
operand bit index.  Here are examples of the logicb
pseudoinstructions:
</p>

<pre class="example" id="org6423b56">
invb    R1,3,9     ; R1.3 := !R1.9
andb    R1,3,9,2   ; R1.3 := R1.9 &amp; R1.2
orb     R1,3,9,2   ; R1.3 := R1.9 | R1.2
xorb    R1,3,9,2   ; R1.3 := R1.9 xor R1.2
</pre>

<p>
The instruction format is EXP, with the following fields:
</p>

<pre class="example" id="orgec8fe23">
logicb  Rd,e,f,g,h
</pre>

<ul class="org-ul">
<li>Rd is the destination register, which also contains both source
operands bits</li>
<li>e is the index of the destination bit</li>
<li>f is the index of the first argument bit</li>
<li>g is the index of the second argument bit</li>
<li>h is the logic function</li>
</ul>
</div>
</li>

<li><a id="org4aeae7c"></a>shiftl<br />
<div class="outline-text-5" id="text-org4aeae7c">
<p>
The instruction shiftl Rd,Ra,k shifts the value in the operand
register Ra by k bits to the left, and the result is placed in the
destination register Rd.  The operand Ra is not modified.  During the
shift, the leftmost k bits of the value are discarded and the
rightmost k bits become 0.
</p>

<pre class="example" id="org0a2556c">
shiftl  R2,R3,5
op = e (EXP format)
d = 2 (destination register)
ab = secondary opcode
e = 3 (register operand)
f = 0 (unused, don't care)
gh = 5 (constant)
</pre>

<p>
The instruction format is EXP, and the assembly language statement format
is RRKEXP.
</p>
</div>
</li>

<li><a id="orgf94ddf7"></a>shiftr<br />
<div class="outline-text-5" id="text-orgf94ddf7">
<p>
Shift to the right.
</p>

<p>
The instruction shiftr Rd,Ra,k shifts the value in the operand
register Ra by k bits to the right, and the result is placed in the
destination register Rd.  The operand Ra is not modified.  During the
shift, the rightmost k bits of the value are discarded and the
leftmost k bits become 0.
</p>

<p>
The following instruction shifts the value in R3 to the right by 5
bits and place the result in R2.  The operand register R3 is not
changed.
</p>

<pre class="example" id="orgecb80f8">
shiftr  R2,R3,5
</pre>

<p>
The instruction format is EXP, and the assembly language statement format
is RRKEXP
</p>
</div>
</li>

<li><a id="org8234b75"></a>extract<br />
<div class="outline-text-5" id="text-org8234b75">
<p>
The extract instruction copies an arbitrary field of bits from a
source register and inserts those bits into an arbitrary position in a
destination register.  The bits in the destination field are
overwritten; other bits in the destination as well as all bits in the
source are unchanged.
</p>

<p>
Bit positions are numbered from right to left: least significant bit
has index 0, and most significant bit has index 15.  The vertical bars
show the groups of 4 bits: they have no effect on the instructions,
but are just to help figure out the expected results in hex notation.
</p>

<pre class="example" id="orgca6f70f">
|----------------|---------------|---------------|---------------|
|   .   .   .   .|  .   .   .   .|  .   .   .   .|  .   .   .   .|
|  15  14  13  12| 11  10   9   8|  7   6   5   4|  3   2   1   0|
|----------------|---------------|---------------|---------------|
</pre>

<p>
The assembly language format isRRkkk.  The general form is
</p>

<pre class="example" id="org9e6b8b0">
extract  Rd,Rs,d_index,s_index,size
</pre>

<ul class="org-ul">
<li>Rd is the destination register</li>
<li>d<sub>index</sub> (0..15) is the starting bit index in the destination register</li>
<li>size (0..15) is the number of bits in the field</li>
<li>Rs is the source register (field is obtained from this register)</li>
<li>s<sub>index</sub> (0..15) is the starting bit index in the source register</li>
</ul>

<pre class="example" id="org51d16b4">
lea      R1,$ffff[R0]     ; ffff
add      R2,R0,R0         ; 0000
extract  R2,R1,11,3,4     ; 0f00  R2.11-8 := R1.3-0
</pre>

<p>
The effect of an extract instruction can be described by writing each
bit assignment individually, so there are <i>size</i> individual bit
assignments.  The notation R2.7 means <i>the bit at position 7 in
register R2</i>.  Using this notation, the example above performs the
following bit assignments:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">extract R2,R1,11,3,4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">R2.11 := R1.3</td>
</tr>

<tr>
<td class="org-left">R2.10 := R1.2</td>
</tr>

<tr>
<td class="org-left">R2.9 := R1.1</td>
</tr>

<tr>
<td class="org-left">R2.8 := R1.0</td>
</tr>
</tbody>
</table>

<p>
Although extract performs a number of bit assignments, it is a single
instruction and its execution time is a small fixed number of clock
cycles.  The execution time does not depend on the value of the field
size, and extracting a large field doesn't require more time than
extracting a small field. The hardware implementation of the
instruction does not use an iteration to copy the bits; they are all
copied in parallel in one clock cycle.
</p>

<p>
Any register may be specified for the source and destination.  If they
are the same, the effect is to move a bit field from one place to
another within the register (this is not the same as a shift).  If the
destination is R0, the result is discarded and the instruction has no
effect.
</p>

<p>
The size is a 4-bit field, and its value is between 0 and 15.  Thus an
extract instruction cannot copy the entire word in one regsiter to
another register, as a size of 16 cannot be specified.  If size=0 then
the instruction does nothing.  the source and destination fields
cannot extend beyond the rightmost bit in a register.
</p>

<p>
Here is another example:
</p>

<pre class="example" id="org6ef491b">
add      R3,R0,R0
extract  R3,R1,13,5,1     ; 2000
lea      R4,$ffff[R0]
extract  R4,R0,13,5,1     ; dfff
</pre>

<p>
The machine language format is EXP
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">op</th>
<th scope="col" class="org-left">d</th>
<th scope="col" class="org-left">a</th>
<th scope="col" class="org-left">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">e</td>
<td class="org-left">f</td>
<td class="org-left">g</td>
<td class="org-left">h</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>op  = e (escape to EXP)</li>
<li>d   = Rd (destination register)</li>
<li>ab  = secondary opcode for extract</li>
<li>e   = Rs</li>
<li>f   = d<sub>index</sub></li>
<li>g   = s<sub>index</sub></li>
<li>h   = size</li>
</ul>
</div>
</li>

<li><a id="org0303e0d"></a>extracti<br />
<div class="outline-text-5" id="text-org0303e0d">
<p>
The extracti instruction is similar to extract, but extracti inverts
the bits in the source field before they are inserted into the destination.
</p>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org4434bdd" class="outline-3">
<h3 id="org4434bdd">Assembly language instruction formats with examples</h3>
<div class="outline-text-3" id="text-org4434bdd">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">afmt</th>
<th scope="col" class="org-left">operand general form</th>
<th scope="col" class="org-left">example</th>
<th scope="col" class="org-left">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">RRR</td>
<td class="org-left">Rd,Ra,Rb</td>
<td class="org-left">add R1,R2,R3</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RR</td>
<td class="org-left">Ra,Rb</td>
<td class="org-left">cmp R1,R2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RX</td>
<td class="org-left">Rd,disp[Ra]</td>
<td class="org-left">load R1,xyz[R2]</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">kX</td>
<td class="org-left">k,disp[Ra]</td>
<td class="org-left">jumpc0 6,loop[R2]</td>
<td class="org-left">0 &lt;= k &lt;= 15</td>
</tr>

<tr>
<td class="org-left">RRRk</td>
<td class="org-left">Rd,Ra,Rb,K[Re]</td>
<td class="org-left">save R1,R5,3[R14]</td>
<td class="org-left">0 &lt;= K &lt;= 255</td>
</tr>

<tr>
<td class="org-left">RRk</td>
<td class="org-left">Ra,Rb,k</td>
<td class="org-left">shiftl R1,R2,5</td>
<td class="org-left">0 &lt;= k &lt;= 15</td>
</tr>

<tr>
<td class="org-left">Rkkkk</td>
<td class="org-left">Rd,e,f,g,h</td>
<td class="org-left">logicb R1,</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RkkRk</td>
<td class="org-left">Ra,j,n,Rb,k</td>
<td class="org-left">extract</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RC</td>
<td class="org-left">Rc,Rd</td>
<td class="org-left">putctl vect,R4</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org4fadd7c" class="outline-3">
<h3 id="org4fadd7c">Instruction set</h3>
<div class="outline-text-3" id="text-org4fadd7c">
<div style="overflow-x: auto">

<p>
Instructions marked x are not are not implemented in this version.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Mnemonic</th>
<th scope="col" class="org-left">ISA</th>
<th scope="col" class="org-left">P</th>
<th scope="col" class="org-left">Fmt</th>
<th scope="col" class="org-left">Args</th>
<th scope="col" class="org-left">Code</th>
<th scope="col" class="org-left">Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">add</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">0</td>
<td class="org-left">Rd := Ra + Rb</td>
</tr>

<tr>
<td class="org-left">sub</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">1</td>
<td class="org-left">Rd := Ra - Rb</td>
</tr>

<tr>
<td class="org-left">mul</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">2</td>
<td class="org-left">Rd := Ra * Rb</td>
</tr>

<tr>
<td class="org-left">div</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">3</td>
<td class="org-left">Rd := Ra / Rb, R15 := Ra rem Rb</td>
</tr>

<tr>
<td class="org-left">cmp</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RR</td>
<td class="org-left">4</td>
<td class="org-left">R15 := Ra cmp Rb</td>
</tr>

<tr>
<td class="org-left">addc</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">5</td>
<td class="org-left">Rd := Ra + Rb + R15.carry</td>
</tr>

<tr>
<td class="org-left">muln</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">6</td>
<td class="org-left">R15++Rd := Ra :*: Rb</td>
</tr>

<tr>
<td class="org-left">divn</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">7</td>
<td class="org-left">R15++Rd := R15++Ra :/: Rb</td>
</tr>

<tr>
<td class="org-left">push</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">8</td>
<td class="org-left">M[ea] := Rd, Rb++</td>
</tr>

<tr>
<td class="org-left">pop</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">9</td>
<td class="org-left">Rb&#x2013;, Rd := M[ea]</td>
</tr>

<tr>
<td class="org-left">nop</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">a</td>
<td class="org-left">&#x2013; reserved --</td>
</tr>

<tr>
<td class="org-left">trap</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRR</td>
<td class="org-left">RRR</td>
<td class="org-left">b</td>
<td class="org-left">user interrupt</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">c</td>
<td class="org-left">&#x2013; reserved --</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">d</td>
<td class="org-left">escape to EXP3 format</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">e</td>
<td class="org-left">escape to EXP format</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">f</td>
<td class="org-left">escape to RX format</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">lea</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,0</td>
<td class="org-left">Rd := ea</td>
</tr>

<tr>
<td class="org-left">load</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,1</td>
<td class="org-left">Rd := M[ea]</td>
</tr>

<tr>
<td class="org-left">store</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,2</td>
<td class="org-left">M[ea] := Rd</td>
</tr>

<tr>
<td class="org-left">jump</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,3</td>
<td class="org-left">pc := ea</td>
</tr>

<tr>
<td class="org-left">jumpc0</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">kX</td>
<td class="org-left">f,4</td>
<td class="org-left">if R15.k=0 then pc := ea</td>
</tr>

<tr>
<td class="org-left">jumpc1</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">kX</td>
<td class="org-left">f,5</td>
<td class="org-left">if R15.k=1 then pc := ea</td>
</tr>

<tr>
<td class="org-left">jal</td>
<td class="org-left">Core</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,6</td>
<td class="org-left">Rd := pc, pc := ea</td>
</tr>

<tr>
<td class="org-left">jumpz</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,7</td>
<td class="org-left">if Rd = 0 then pc := ea</td>
</tr>

<tr>
<td class="org-left">jumpnz</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,8</td>
<td class="org-left">if Rd != 0 then pc := ea</td>
</tr>

<tr>
<td class="org-left">x brc0</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,9</td>
<td class="org-left">Rd := M[ea], M[ea] := 1</td>
</tr>

<tr>
<td class="org-left">x brc1</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,a</td>
<td class="org-left">Rd := M[ea], M[ea] := 1</td>
</tr>

<tr>
<td class="org-left">x testset</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,b</td>
<td class="org-left">Rd := M[ea], M[ea] := 1</td>
</tr>

<tr>
<td class="org-left">x leal</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,c</td>
<td class="org-left">Rd := ea</td>
</tr>

<tr>
<td class="org-left">x loadl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,d</td>
<td class="org-left">Rd := M[ea]</td>
</tr>

<tr>
<td class="org-left">x storel</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">RX</td>
<td class="org-left">f,e</td>
<td class="org-left">M[ea] := Rd</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RX</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">f,f</td>
<td class="org-left">&#x2013; reserved --</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">save</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRx</td>
<td class="org-left">e,00</td>
<td class="org-left">M[ea] := R1, &#x2026;, M[ea+d-1] := Rd</td>
</tr>

<tr>
<td class="org-left">restore</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRx</td>
<td class="org-left">e,01</td>
<td class="org-left">R1 := M[ea], &#x2026;, Rd := M[ea+d-1]</td>
</tr>

<tr>
<td class="org-left">shiftl</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRk</td>
<td class="org-left">e,02</td>
<td class="org-left">Rd := Ra shl b</td>
</tr>

<tr>
<td class="org-left">shiftr</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRk</td>
<td class="org-left">e,03</td>
<td class="org-left">Rd := Ra shr b</td>
</tr>

<tr>
<td class="org-left">logicw</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRRk</td>
<td class="org-left">e,04</td>
<td class="org-left">Rd := Re (lut g) Rf</td>
</tr>

<tr>
<td class="org-left">logicb</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">Rkkkk</td>
<td class="org-left">e,05</td>
<td class="org-left">Rd.e := Rd.f (lut h) Rd.g</td>
</tr>

<tr>
<td class="org-left">extract</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RkkRk</td>
<td class="org-left">e,06</td>
<td class="org-left">Rd := extract Rd di size Rs si</td>
</tr>

<tr>
<td class="org-left">extracti</td>
<td class="org-left">Std</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RkkRk</td>
<td class="org-left">e,07</td>
<td class="org-left">Rd := extracti Rd di size Rs si</td>
</tr>

<tr>
<td class="org-left">getctl</td>
<td class="org-left">Sys</td>
<td class="org-left">P</td>
<td class="org-left">EXP</td>
<td class="org-left">RC</td>
<td class="org-left">e,08</td>
<td class="org-left">Rd := Sc</td>
</tr>

<tr>
<td class="org-left">putctl</td>
<td class="org-left">Sys</td>
<td class="org-left">P</td>
<td class="org-left">EXP</td>
<td class="org-left">RC</td>
<td class="org-left">e,09</td>
<td class="org-left">Sc := Rd</td>
</tr>

<tr>
<td class="org-left">resume</td>
<td class="org-left">Sys</td>
<td class="org-left">P</td>
<td class="org-left">EXP</td>
<td class="org-left">R</td>
<td class="org-left">e,0a</td>
<td class="org-left">pc := ipc, status := istatus</td>
</tr>

<tr>
<td class="org-left">x addl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,0b</td>
<td class="org-left">Rd := Ra + Rb</td>
</tr>

<tr>
<td class="org-left">x subl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,0c</td>
<td class="org-left">Rd := Ra - Rb</td>
</tr>

<tr>
<td class="org-left">x mull</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,0d</td>
<td class="org-left">Rd := Ra * Rb</td>
</tr>

<tr>
<td class="org-left">x divl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,0e</td>
<td class="org-left">Rd := Ra / Rb, R15 := Ra rem Rb</td>
</tr>

<tr>
<td class="org-left">x cmpl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,0f</td>
<td class="org-left">Rd := Ra / Rb, R15 := Ra rem Rb</td>
</tr>

<tr>
<td class="org-left">x addcl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,10</td>
<td class="org-left">Rd := Ra + Rb + R15.carry</td>
</tr>

<tr>
<td class="org-left">x pushl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,11</td>
<td class="org-left">M[ea] := Rd, Rb++</td>
</tr>

<tr>
<td class="org-left">x popl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,12</td>
<td class="org-left">Rb&#x2013;, Rd := M[ea]</td>
</tr>

<tr>
<td class="org-left">x topl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,13</td>
<td class="org-left">Rd := M[ea]</td>
</tr>

<tr>
<td class="org-left">x savel</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRRk</td>
<td class="org-left">e,14</td>
<td class="org-left">M[ea] := R1, &#x2026;, M[ea+d-1] := Rd</td>
</tr>

<tr>
<td class="org-left">x restorel</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRRk</td>
<td class="org-left">e,15</td>
<td class="org-left">R1 := M[ea], &#x2026;, Rd := M[ea+d-1]</td>
</tr>

<tr>
<td class="org-left">x addf</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,16</td>
<td class="org-left">Rd := Ra + Rb</td>
</tr>

<tr>
<td class="org-left">x subf</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,17</td>
<td class="org-left">Rd := Ra - Rb</td>
</tr>

<tr>
<td class="org-left">x mulf</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,18</td>
<td class="org-left">Rd := Ra * Rb</td>
</tr>

<tr>
<td class="org-left">x divf</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RRR</td>
<td class="org-left">e,19</td>
<td class="org-left">Rd := Ra / Rb, R15 := Ra rem Rb</td>
</tr>

<tr>
<td class="org-left">x cmpf</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">RR</td>
<td class="org-left">e,1a</td>
<td class="org-left">R15 := Ra cmp Rb</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">e,1b</td>
<td class="org-left">&#x2013; reserved --</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2013; reserved --</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">e,ff</td>
<td class="org-left">&#x2013; reserved --</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">x shiftll</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP3</td>
<td class="org-left">RRk</td>
<td class="org-left">d,00</td>
<td class="org-left">Rd := Ra shl b</td>
</tr>

<tr>
<td class="org-left">x shiftrl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP3</td>
<td class="org-left">RRk</td>
<td class="org-left">d,01</td>
<td class="org-left">Rd := Ra shr b</td>
</tr>

<tr>
<td class="org-left">x logicwl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP3</td>
<td class="org-left">RRRk</td>
<td class="org-left">d,02</td>
<td class="org-left">Rd := Re (lut g) Rf</td>
</tr>

<tr>
<td class="org-left">x logicbl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP3</td>
<td class="org-left">Rkkkk</td>
<td class="org-left">d,03</td>
<td class="org-left">Rd.e := Rd.f (lut h) Rd.g</td>
</tr>

<tr>
<td class="org-left">x extractl</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP3</td>
<td class="org-left">RkkRk</td>
<td class="org-left">d,04</td>
<td class="org-left">Rd := extract Rd di size Rs si</td>
</tr>

<tr>
<td class="org-left">x extractil</td>
<td class="org-left">S32</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP3</td>
<td class="org-left">RkkRk</td>
<td class="org-left">d,05</td>
<td class="org-left">Rd := extracti Rd di size Rs si</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP3</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">d,06</td>
<td class="org-left">&#x2013; reserved --</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP3</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2013; reserved --</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">EXP3</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">d,ff</td>
<td class="org-left">&#x2013; reserved --</td>
</tr>
</tbody>
</table>

</div">
</div>

<ul class="org-ul">
<li><a id="orgd2b618c"></a>Pseudoinstructions<br />
<div class="outline-text-5" id="text-orgd2b618c">
<p>
save  
save     |       RX   | RX    | f,9  | M[ea] := R1, &#x2026;, M[ea+d-1] := Rd  M[Rb+ofs+(f-e+1)] := Rf |
restore  |   | RX   | RX    | f,a  | R1 := M[ea], &#x2026;, Rd := M[ea+d-1] |
</p>
</div>
</li>
</ul>
</div>
</div>


<div id="outline-container-org4d90adc" class="outline-2">
<h2 id="org4d90adc">Sigma32 Architecture reference</h2>
<div class="outline-text-2" id="text-org4d90adc">
<p>
(Future extension - no currently available)
</p>

<p>
Sigma16 consists of a 16-bit architecture (S16) and a 32 bit extended
architecture (S32).  This section discusses 
</p>

<p>
The processor has buttons to select whether it is emulating S16 or
S32.  When you first enter the processor page, it is in S16 mode.
Clicking the S16 or S32 button will set the mode and clear the
registers and memory.
</p>

<p>
S16 and S32 are different but closely related machines.  S16 is a
subset of S32.  Every feature in S16 is also present in S32, and every
S16 program will run the same on either architecture.  A program that
uses S32 instructions will execute correctly only on S32.  Any S32
instruction executed on S16 will be treated just like any other
instruction with an illegal opcode.
</p>
</div>
</div>

<div id="outline-container-orgb702f85" class="outline-2">
<h2 id="orgb702f85">Assembly language reference</h2>
<div class="outline-text-2" id="text-orgb702f85">
<p>
:CUSTOM<sub>ID</sub>: sec-assembly-language
</p>

<p>
A computer is a digital circuit that executes programs in machine
language, which is hard for humans to read because it consists
entirely of numbers.  Assembly language provides a readable notation
for writing machine language programs.  It uses names for instructions
and variables, as well as other notations to make the code easier to
understand.
</p>

<p>
An instruction in machine language is just one or more words (often
written in hexadecimal notation), while the corresponding instruction
in assembly language uses mnemonic names so the programmer doesn't
have to memorise all the operation codes, addresses of variables, and
so on. For example, the assembly language statement mul R12,R3,R8 is
more readable than the corresponding machine language instruction
2c38.  However, the assembly language still gives the programmer
complete control over every bit a program.
</p>


<p>
A programmer writes a machine-level program in assembly language.  A
software application called the <b>assembler</b> reads it in and translates
it to machine language.  When it sees an instruction mnemonic like add
or div, it replaces it with the operation code (0, 3, or whatever).
The assembler helps with variable names &#x2014; the machine language needs
addresses (numbers) and the assembler calculates them
</p>

<ul class="org-ul">
<li>You can use names (add, div) rather than numeric codes (0, 3)</li>
<li>You can use variable names (x, y, sum) rather than memory addresses
(02c3, 18d2)</li>
<li>You write a program in assemply language</li>
<li>The assembler translates it into machine language</li>
</ul>

<p>
Compilers and assemblers are similar in some ways: both of them
translate a program from one language to another.  The main difference
is that compilers translate between languages that are very different,
while assemblers translate between very similar languages.
</p>

<p>
Example: a sequence of RRR instructions
</p>

<p>
Assembly language
</p>
<pre class="example" id="orge2ad0a3">
add    R3,R5,R1
sub    R4,R2,R3
mul    R1,R9,R10   
</pre>

<p>
Machine language
</p>
<pre class="example" id="org2e1614d">
0351
1423
219a
</pre>
</div>

<div id="outline-container-org19cfbba" class="outline-3">
<h3 id="org19cfbba">Assembly language statement formats</h3>
<div class="outline-text-3" id="text-org19cfbba">
<p>
Assembly language statements generally correspond to the instruction
formats, but there is not an exact correspondence for several reasons:
</p>

<ul class="org-ul">
<li>Sometimes an instruction is written in assembly language with a
field omitted which exists in the machine language code but is
ignored.  For example, the instruction <b>cmp R1,R2</b> generates an RRR
instruction, but the third operand field is omitted because the
instruction requires only one operand, not two.  The assembler sets
the unused operand to 0, but the machine ignores it.  This is called
a "don't care" field in the instruction.</li>

<li>Sometimes two instructions look the same in assembly language but
use different machine language instruction formats.  For example,
<b>add R1,R2,R3</b> and <b>push R1,R2,R3</b> look similar, but <b>add</b> uses the
RRR instruction format and <b>push</b> uses the EXP instruction format.
The reason for this is that there are not enough bits in the op
field to accommodate all the instructions with three register
operands, so an <b>expanding opcode</b> is used.  Thus push is
represented with op=14, indicating EXP format, and the EXP variant
is used for this instruction.</li>

<li>The 4-bit fields are sometimes used to denote a register from the
register file (R3), or a control register (mask), or a constant .
In assembly language the constants are written just as a number
(e.g. shiftl R1,R2,5).  Control registers are written by name rather
than their number in the control register file (e.g. getctl
R3,mask).</li>

<li>Some assembly language statements are <b>pseudoinstructions</b>.  These
are special cases of more general instructions.  For example, <b>and</b>
is a pseudoinstruction which generates a <b>logicw</b> instruction
specialised to perform a logical and.</li>
</ul>

<p>
Table: <b><b>Assembly language statement formats</b></b>
</p>

<hr />
<p>
 Asm   Example                  ML formats
--&#x2013;&#x2014; ----------------&#x2013;&#x2014;  ----------------------&#x2013;&#x2014;
 RRR     add     Rd,Ra,Rb       RRR
 RX      lea     Rd,disp[Ra]    RX
</p>

<p>
RR      inv     Rd,Ra          RRR (b ignored), RREXP
JX      jump    disp[Ra]       RX (b ignored)
KX      jumpc0  d,disp[Ra]     RX (d is constant)
</p>

<p>
RRK     shiftl  Rd,Ra,k        EXP
RkkRk   extract Rd,e,f,Rg,h    EXP
RCEXP   getctl  Re,Cf          EXP
</p>
<hr />

<p>
An EXP instruction may use the fields op, d, ab, e, f, g, h.  The g
and h fields can be combined into a single 8-bit field gh All EXP
instructions combine the a and b fields into a single 8-bit field
called ab.  Some EXP instructions combine the g and h fields into a
single 8-bit field called gh.  The EXP format has the following
variants.
</p>

<ul class="org-ul">
<li>The RREXP format takes two register operands, which are in the e and
f fields of the second word. The d field of the first word and the g
and h fields of the second word are ignored (the assembler will set
these to 0).  Any RREXP instruction could be reprsented as RRR, but
there are only a few RRR opcodes avaiable, so uncommon instructions
that require two registers are represented as RREXP.  Example:
<b>execute R5,R6</b> is RREXP.</li>

<li>The RCEXP format takes two register operands; the first is a general
register and the second is a control register.  An example of the
operand field is <b>R3,mask</b>.  The operands are in the e and f fields
of the second word.  The d field of the first word and the g and h
fields of the second word are ignored (the assembler will set these
to 0.)  The first operand is an element of the register file (for
example, R4).  The second operand is a control register, which is
specified by a 4-bit number.  In assembly language, we normally
refer to the control registers by name rather than number, to make
it easier to remember which is which.  For example, <b>getctl
R3,status</b> has RCEXP format.</li>

<li>The RRREXP format takes three register operands, which are in the f,
g, and h fields of the second word. An example of the operand field
is $R1,R2,R3*.  The d field of the first word and the e field of the
second word are ignored (the assembler will set these to 0).  The
RRREXP instructions would be a natural fit for the RRR format, but
there are not enough RRR opcodes available, so the EXP format is
used to expand the number of instructions that can be represented.
For example, <b>push R5,R8,R9</b> has RRREXP format.</li>

<li>The RRKEXP format takes two register operands and a 4-bit constant
number.  An example of the operand field is <b>R1,R2,13</b>.  The
register operands are in the f and g fields of the second word, and
constant is in the h field of the second word.  The d field of the
first word and the e field of the second word are ignored (the
assembler sets these to 0).  For example, <b>shiftr R3,R6,7</b> has
RRKEXP format.</li>

<li>The RRKKEXP format takes two register operands and two 4-bit
constant binary number operands.  The register operands are in the e
and f fields of the second word, while the two constants are in the
g and h fields.  The d field of the first word is ignored (the
assembler sets it to 0).</li>

<li>The RRXEXP format takes two register operands as well as a memory
address specified with an 8-bit offset and index register.  Thus
these instructions require three registers to be specified, as well
as the offset.  Thus every bit of both instruction words is needed
to represent an RRXEXP format instruction.  In assembly language,
the memory address is written as <b>offset[Rh]</b> where <b>offset</b> is an
-bit binary number and Rh is a register.  The effective memory
address is <b>offset+Rh</b>. This is similar to ordinary memory
addresses; the only difference is that it uses an 8-bit offset
rather than a 16-bit displacement. For example, <b>save R1,R9,2[R14]</b>
has RRKEXP format.</li>
</ul>

<p>
*- Expressions, values and relocatables
</p>

<ul class="org-ul">
<li>An expression is syntax: 23, -5, $b23e, struc+5, arrEnd-arrStart</li>
<li>A value denotes a word (it is a number) and is the result of
evaluating an expression</li>
<li>A value is marked as either relocatable or fixed</li>
<li>Expressions may occur in
<ul class="org-ul">
<li>Displacement field of an assembly language statement; the value of
the expression is placed in the displacement field of the
corresponding machine language instruction.</li>
<li>If a displacement value is relocatable, its address is recorded in
the list of addressess of words to be relocated</li>
<li>Right hand side of an equ statement.  The value may be fixed or
relocatable.  The name (the left hand side) is defined as a new
identifier, the definition line is the line containing the equ,
the value is the evaluation of the right hand side, which may be
either fixed or relocatable.  Identifiers used in the expression
on the RHS have the line number included in their usage lines.</li>
<li>But identifiers that appear in an expression (even if relocatable)
are not recorded in the relocation list; only displacements are
placed in the relocation list.</li>
</ul></li>
</ul>


<ul class="org-ul">
<li>Instruction set</li>
</ul>

<p>
The following sections describe the instructions in groups organized
by their function.  Some of the groups contain instructions with
different formats.  From the programmer's perspective the function is
more important, so these groups are useful in finding the right
instruction to use.  (From the perspective of designing a digital
circuit to impleemnt the architecture, the format is essential.)
</p>
</div>
</div>


<div id="outline-container-org9882d78" class="outline-3">
<h3 id="org9882d78">Programs, modules, and files</h3>
<div class="outline-text-3" id="text-org9882d78">
<p>
The assembler inputs a program in assembly language.  Its primary
output is an <b>object module</b> which contains the machine language code.
The assembler also produces an <b>assembly listing</b>, which presents the
program in a form useful for the programmer, and a <b>metadata module</b>
which enables the emulator to track the source statement corresponding
to each instruction.
</p>

<p>
Each module has an associated object code, which may be empty. The
object code can be produced by a successful assembly (i.e. an assembly
with no errors) or it can be obtained from the Editor.  This allows
object code to be read from a file or entered directly by the user.
</p>


<p>
There is a standard convention for file names.  If, for example, you
have a program named MyProgram, then the files associated with it
should be as follows:
</p>

<p>
------------&#x2013;&#x2014;  ------&#x2013;&#x2014;
module name        MyProgram
source file        MyProgram.asm.txt
object file        MyProgram.obj.txt
assembly listing   MyProgram.lst.txt
------------&#x2013;&#x2014;  ------&#x2013;&#x2014;
</p>
</div>
</div>

<div id="outline-container-org5db3993" class="outline-3">
<h3 id="org5db3993">Values</h3>
<div class="outline-text-3" id="text-org5db3993">
<p>
A value is a 16-bit word.  An assembly language program uses
expressions to denote values, but the actual underlying quantity is a
value.  A value consists of a word and several attributes:
</p>

<ul class="org-ul">
<li>word is a natural number in the range from 0 to 2<sup>16</sup>-1.</li>
<li>origin
<ul class="org-ul">
<li>if origin=Local, the value is defined within the module</li>
<li>if origin=External, the value is imported from another module</li>
</ul></li>
<li>movability
<ul class="org-ul">
<li>If movability=Relocatable, the value must be adjusted by the
relocation constant when the module is relocated</li>
<li>If movability=Fixed, the value is not affected during relocation</li>
</ul></li>
</ul>
</div>

<div id="outline-container-org3335b69" class="outline-4">
<h4 id="org3335b69">Expressions</h4>
<div class="outline-text-4" id="text-org3335b69">
<p>
An expression is syntax that denotes a value. 
</p>

<p>
A <b>name</b> must begin with a letter (a-z or A-Z), and may contain
letters, digits, or underscore characters.
</p>

<p>
Constants can be written in decimal, hexadecimal, or binary:
</p>

<ul class="org-ul">
<li><b>Decimal constants</b> consist of a sequence of digits, with an
optional leading - sign.  Examples: 42 55039 -1</li>

<li><b>Hexadecimal constants</b> are written with a dollar sign $ followed by
four hex digits (0 1 2 3 4 5 6 7 8 9 a b c d e f).  Examples: $0249
$c78a</li>

<li><b>Binary constants</b> are written with a hash sign # followed by any
number of 0 or 1 characters.  You can write fewer than 16 bits; they
will be padded on the left with zeros.  Examples: #1101
#000100000001101</li>
</ul>

<p>
Expressions may contain arithmetic operators + - * /.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">operand</th>
<th scope="col" class="org-left">operator</th>
<th scope="col" class="org-left">operator</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">fixed</td>
<td class="org-left">+</td>
<td class="org-left">fixed</td>
<td class="org-left">fixed</td>
</tr>

<tr>
<td class="org-left">fixed</td>
<td class="org-left">+</td>
<td class="org-left">relocatable</td>
<td class="org-left">relocatable</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">+</td>
<td class="org-left">fixed</td>
<td class="org-left">relocatable</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">+</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">fixed</td>
<td class="org-left">-</td>
<td class="org-left">fixed</td>
<td class="org-left">fixed</td>
</tr>

<tr>
<td class="org-left">fixed</td>
<td class="org-left">-</td>
<td class="org-left">relocatable</td>
<td class="org-left">relocatable</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">-</td>
<td class="org-left">fixed</td>
<td class="org-left">relocatable</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">-</td>
<td class="org-left">relocatable</td>
<td class="org-left">fixed</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">fixed</td>
<td class="org-left">*</td>
<td class="org-left">fixed</td>
<td class="org-left">fixed</td>
</tr>

<tr>
<td class="org-left">fixed</td>
<td class="org-left">*</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">*</td>
<td class="org-left">fixed</td>
<td class="org-left">error</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">*</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">fixed</td>
<td class="org-left">/</td>
<td class="org-left">fixed</td>
<td class="org-left">fixed</td>
</tr>

<tr>
<td class="org-left">fixed</td>
<td class="org-left">/</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">/</td>
<td class="org-left">fixed</td>
<td class="org-left">error</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">/</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>
</tbody>
</table>


<p>
relocatable 
</p>


<p>
An expression can do arithmetic on a local label, but not on an
imported name.  The reason is that arithmetic requires that the value
of the name is known.  That's why an expression like a equ rcd+5 can
be used only after the label rcd is defined: it enables the value of
each name to be calculated during pass 1.  But the values of imported
names are not known at all during assembly; they become defined only
during linking.  Such a value can affect the values of words in the
object code, but not their locations.
</p>

<p>
An expression is assembly language syntax that, when evaluated,
denotes a value (i.e. a 16-bit word).  Evaluation takes place entirely
at assembly time.  Expressions may be labels, constants, or
may be calculated.
</p>
</div>
</div>

<div id="outline-container-orgf468e46" class="outline-4">
<h4 id="orgf468e46">Location counter</h4>
<div class="outline-text-4" id="text-orgf468e46">
<p>
The assembler maintains a variable called the location counter, which
is the address where the next word of object code will be loaded.  The
location counter is a local value.  It is initialized to 0000
Relocatable.
</p>

<p>
When an instruction word or data word is generated, its address is set
to the current value of the location counter, which is then
incremented.
</p>

<p>
The org directive specifies a new value of the location counter.
First the operand of the org statement is evaluated.  This value must
be local (it is an error if the value is external).  The location
counter and its movability are set to the value and movability of the
operand.
</p>
</div>
</div>

<div id="outline-container-org3bc5934" class="outline-4">
<h4 id="org3bc5934">Attributes</h4>
<div class="outline-text-4" id="text-org3bc5934">
<p>
A machine language program consists of words stored in memory at
particular addresses.  A word is just a collection of 16 bits; it has
no type.
</p>

<p>
An assembly language program specifies all the words that comprise a
program.  In principle you could just write out all the words as
numbers, but this is difficult and prone to errors.  Thw whole point
of assembly language is to provide notations that make it easier to
specify these numbers, while retaining total control&#x2014;every single
bit in the object code is determined by the assembly language.
</p>

<p>
A <b>value</b> is a word of 16 bits.  Values do not have types; their type
depends entirely on usage.  Values may be used in generating object
code, either as the displacment field of an RX instruction or as the
operand of a data statement.
</p>

<p>
Every value is either <b>fixed</b> or <b>relocatable</b>.  If a module is
linked, then its relocatable values may be translated, but the fixed
values remain unchanged.
</p>
</div>
</div>
</div>

<div id="outline-container-org07e5793" class="outline-3">
<h3 id="org07e5793">Code statements</h3>
<div class="outline-text-3" id="text-org07e5793">
<p>
Each line of source code is an assembly language statement.  Unlike
higher level languages, assembly language statements are not nested.
There are three kinds of assembly language statement:
</p>

<ul class="org-ul">
<li><i>Comments</i> (blank lines, or lines beginning with ;)</li>
<li><i>Code</i> statements define instructions or constant data</li>
<li>/Directives provide metadata but don't generate any code</li>
</ul>

<p>
An assembly language statement contains one or more fields.  A field
consists of non-space characters (with one exception: a space may
appear in a string literal).  Fields are separated from each other by
one or more white space characters.
</p>

<ul class="org-ul">
<li>Label.  The label field is optional.  If present, the label must be
a name and it must begin in the first character of the line.  If the
first character is a space, then that line has no label.</li>

<li>Operation.  The operation field is an identifier that specifies an
instruction or assembler directive.  It must be preceded by one or
more white space characters.  Every statement (apart from a full
line comment) must have an operation field.</li>

<li>Operands.  The operands field specifies operands for an instruction
or arguments for assembly directives.  There may be several
operands, which must be separated by commas.  Each type of statement
(determined by the operation field) requires a specific syntax for
the operands.  Most instructions and assembler directives require
operands, but some do not.</li>

<li>Comment.  All text that either (1) follows white space after the
operands field, or (2) follows a semicolon (;), is a comment, and is
ignored by the assembler.  If one or more of the other fields
(label, operation, operands) is missing, the comment must be
preceded by a semicolon to prevent it from being interpreted as
operands.  The rule is: all text after a semicolon is a comment, and
all text after white space following operands is a comment.  A
statement where the first non-space character is a semicolon is a
full line comment.  If the statement has no operands, then all text
after the operation field is a comment.  It is good practice always
to begin a comment with a semicolon.</li>
</ul>
</div>

<div id="outline-container-orgf220ad6" class="outline-4">
<h4 id="orgf220ad6">Instructions</h4>
<div class="outline-text-4" id="text-orgf220ad6">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Label</th>
<th scope="col" class="org-left">Statement</th>
<th scope="col" class="org-left">Operands</th>
<th scope="col" class="org-left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">optname</td>
<td class="org-left">data</td>
<td class="org-left">exprs</td>
<td class="org-left">generate word for each exp</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRRop</td>
<td class="org-left">r,r,r</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">RXop</td>
<td class="org-left">r,exp[r]</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRop</td>
<td class="org-left">r,r</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Rop</td>
<td class="org-left">r</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRKKop</td>
<td class="org-left">r,r,k,k</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-org890b99d" class="outline-4">
<h4 id="org890b99d">data</h4>
<div class="outline-text-4" id="text-org890b99d">
<p>
The data statement specifies a sequence of constants to be placed in
consecutive memory locations starting at the location counter, subject
to relocation.  Its argument is a list of one or more 4-digit hex
constants separated by commas.
</p>

<p>
A long block of data can be broken up into several data statements.
Suppose x1, x2, etc are 4-digit hex constants.  Then
</p>

<pre class="example" id="org07f4672">
data  x1,x2,x3,x4,x5,x6
</pre>

<p>
is equivalent to
</p>

<pre class="example" id="orgf6a14fc">
data x1,x2,x3
data x4,x5,x6
</pre>

<p>
Suppose
</p>

<ul class="org-ul">
<li>The module's relocation constant is r</li>
<li>The location counter has been set to c</li>
<li>The i'th constant (counting from 0) in a data statement is x.</li>
</ul>

<p>
Then the linker will set mem[r+c+i] := x.
</p>

<p>
One point to watch out for is that an assembly language data statement
uses $ to indicate that a number is a hex constant (e.g. $03b7) but
the object language data statement requires all numbers to be 4-digit
hex constants, and does not require (or allow) a preceding $ character
</p>
</div>
</div>
</div>


<div id="outline-container-org6a62764" class="outline-3">
<h3 id="org6a62764">Directives</h3>
<div class="outline-text-3" id="text-org6a62764">
<p>
A directive is an assembly language statement that gives further
information about how to translate the program to object code and how
to link the code with other modules.  Directirves specify metadata but
they don't generate an instruction or constant data.
</p>
</div>

<div id="outline-container-org908f58f" class="outline-4">
<h4 id="org908f58f">module</h4>
<div class="outline-text-4" id="text-org908f58f">
<p>
A program may be organized as a collection of modules, where each
module appears in a separate file.  When several modules are present,
each one needs a unique name.  The <i>module</i> statement declares the
name of the module, which is specified in the label field.  There are
no operands.  The following statement says that this is the object
code for module named <i>abc</i>:
</p>

<pre class="example" id="org7a1b575">
abc   module 
</pre>

<p>
A <i>module</i> statement is optional.  If none is present in a file, the
module is anonymous.  If a file does contain a <i>module</i> statement, it
must be the first statement in the file, although it may be preceded
by comments and blank lines.  It is illegal for a file to contain more
than one <i>module</i> statement.
</p>

<p>
An anonymous module can import other modules, but other modules cannot
import anything exported from an anonymous module.  This means, in
effect, that an anonymous module is useful only as a main program.
</p>

<p>
It is good practice for the main program to have a module statement;
in effect, this is the name of the program as well as the name of the
module.
</p>

<p>
An assembly language file should have a name of the form
basename.asm.txt.  If there is a module statement <i>modname module</i>,
then basename should be <i>modname</i>.  For example, the file
Heapsort.asm.txt might contain the statement <i>Heapsort module</i>.  If
there is no module statement, basename is arbitrary.
</p>
</div>
</div>

<div id="outline-container-org693afdf" class="outline-4">
<h4 id="org693afdf">equ</h4>
<div class="outline-text-4" id="text-org693afdf">
<pre class="example" id="orgcc86c23">
codeWrite  equ  2
codeRead   equ  1
</pre>

<p>
The expression in an equ can calculate the size of an object:
</p>

<pre class="example" id="org467df6d">
astart     data 5
           data 9
           data 78
aend
asize      equ  aend-astart
</pre>
</div>
</div>

<div id="outline-container-orgbfaea7c" class="outline-4">
<h4 id="orgbfaea7c">block</h4>
<div class="outline-text-4" id="text-orgbfaea7c">
<pre class="example" id="org4bacbc2">
asize   equ    100
n       data   asize
arr     block  asize
</pre>
</div>
</div>

<div id="outline-container-orgd0b7833" class="outline-4">
<h4 id="orgd0b7833">org</h4>
<div class="outline-text-4" id="text-orgd0b7833">
<p>
The org statement sets the location counter to a specified address.
Subsequent instructions and data will be placed in memory at
contiguous locations starting from that address.
</p>

<p>
There is one argument, which is an expression denoting the new value
of the location counter.  The location counter has an associated
attribute that specifies either Relocatable or Fixed.  The org
statement sets this attribute, as well as the numeric value of the
location counter, to the value of the operand.
</p>

<p>
Examples:
</p>

<p>
org   35     ; subsequent code starts from 0023 (Fixed)
org   @+50   ; skip 50 words (Relocatable)
</p>

<p>
The assembler initializes the location counter to 0 before it begins
translating an assembly language module.  This means that every module
begins implicitly with org 0.
</p>
</div>
</div>

<div id="outline-container-orga1a5997" class="outline-4">
<h4 id="orga1a5997">import</h4>
<div class="outline-text-4" id="text-orga1a5997">
<p>
The import statement states that the value of an identifier is defined
in another module.  During the assembly of the module containing the
import, the identifier is given a provisional value of 0, but this
will be replaced by the actual value by the linker.  For example,
</p>

<pre class="example" id="orgaf3bda5">
x   import  Mod1,x
y   import  Mod1,abc
</pre>

<p>
says that x is a name that can be used in this module, but it is
defined in Mod1; y can be used in this module but it is defined in
Mod1 under the name abc.
</p>
</div>
</div>

<div id="outline-container-org5d351a2" class="outline-4">
<h4 id="org5d351a2">export</h4>
<div class="outline-text-4" id="text-org5d351a2">
<p>
An export statement says that the module is making the value of a
symbol available for use in other modules, which may import it.  The
statement takes two operands: the name being exported and the value,
which must be a 4-digit hex constant.  It makes no difference whether
the name is relocatable, as the linker performs any relocation before
writing the exported value into other modules that import it.
Examples:
</p>

<pre class="example" id="org02c27f2">
export  haltcode,0
export  fcn,002c
</pre>

<p>
The export statement states that the value of an identifier should be
made available for other modules to import.  For example, this module
defines a function and exports it so other modules can import and call
it:
</p>

<pre class="example" id="orge0fd5c7">
Mod1     module
         export fcn

fcn      add    R1,R1,R1
         jump   0[R12]
</pre>

<p>
** Assembly listing
</p>

<p>
The first section of the assembly listing shows each line of the
source program.  The line number appears first, followed by the memory
address that the instruction on this line will be placed in.  The
address is given as a 4 digit hexadecimal number, and it is binary
(not two's complement).  Next comes the machine language code
generated by the line of source code.  If the line contains a two-word
instruction, there will be two 4-digit hexadecimal values; for a
one-word instruction there will be one hex number, and if the line
doesn't produce any code these fields will be blank.  After the code,
the original source statement appears.
</p>

<p>
The second section of the assembly listing is the <b>Symbol Table</b>.
This shows each identifier (or "symbol") that appears in the program,
the address allocated for the symbol, the source code line where it
was defined, and the source code lines where it was used.
</p>
</div>
</div>
</div>

<div id="outline-container-org53efa29" class="outline-3">
<h3 id="org53efa29">Summary of assembly language statements</h3>
<div class="outline-text-3" id="text-org53efa29">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Statement</th>
<th scope="col" class="org-left">Label</th>
<th scope="col" class="org-left">Operands</th>
<th scope="col" class="org-left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">identifier</td>
<td class="org-left">module</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Define name of module</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">org</td>
<td class="org-left">expression</td>
<td class="org-left">Set location counter</td>
</tr>

<tr>
<td class="org-left">identifier</td>
<td class="org-left">equ</td>
<td class="org-left">expression</td>
<td class="org-left">Define value</td>
</tr>

<tr>
<td class="org-left">identifier</td>
<td class="org-left">import</td>
<td class="org-left">identifier,identifier</td>
<td class="org-left">Import  value  from module</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">export</td>
<td class="org-left">identifier</td>
<td class="org-left">Export values</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>



<div id="outline-container-org3a58f9c" class="outline-2">
<h2 id="org3a58f9c">User interface</h2>
<div class="outline-text-2" id="text-org3a58f9c">
</div>
<div id="outline-container-org0cbb1b5" class="outline-4">
<h4 id="org0cbb1b5">Files and modules</h4>
<div class="outline-text-4" id="text-org0cbb1b5">
<ul class="org-ul">
<li>In Modules tab, click Choose Files
<ul class="org-ul">
<li>The dialogue shows .asm.txt, .lnk.txt, .obj.txt, .md.txt</li>
<li>To select all the relevant files in a directory, click the little
box at the left on the row giving "Name, date modified, &#x2026;"</li>
<li>Click Open (or cancel)</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgf9aefb5" class="outline-4">
<h4 id="orgf9aefb5">Simple standalone programs</h4>
<div class="outline-text-4" id="text-orgf9aefb5">
<p>
If a program does not import any names, it is <b>standalone</b>.  The text
of the program is shown in the editor pane.  Go to the Assembler pane
and click Assemble.  If there are no errors, go directly to the
Processor pane (you can skip the Linker) and click Boot.  This will
read the machine language into the memory, and now you can run the
program.
</p>
</div>
</div>

<div id="outline-container-org058a4be" class="outline-4">
<h4 id="org058a4be">Programs with multiple modules</h4>
<div class="outline-text-4" id="text-org058a4be">
<p>
A module consists of program text, and it may have an optional file,
and an optional module name.
</p>

<ul class="org-ul">
<li>The module text is a sequence of assembly language statements.  The
text may exist only in the editor buffer, or it may be associated
with a file.</li>

<li>If there is a file, this may be specified either as a path (the
unique identification of the file (C:\\Users\&#x2026;\prog.asm.txt), or
as just a filename (myprogram.asm.txt) which is relative to the
current directory.</li>
</ul>

<p>
To edit a file, the modDir and modName are both optional.  An edited
file may have a module name specified with a module statement.  To
read or save a file, both the module directory and name must be known.
</p>

<p>
Editor operations on files and modules
</p>

<p>
Each operation that changes the editor buffer (New, Open, Close)
checks first to see whehter the buffer has been changed since it was
last saved.  If so, a dialogue asks whether the file should be saved.
</p>

<ul class="org-ul">
<li>New &#x2013; Check whether text in the editor buffer has been saved; if
not, ask whether to save it.  Create a new module with empty text
and no file name, add it to the module set, and select it as the
current module.  Clear the text in the editor buffer.</li>

<li>Open &#x2013; Check whether text in the editor buffer has been saved; if
not, ask whether to save it.  Enter the open file dialogue where an
existing file can be found by navigation or by typing in its name.
If the dialogue is cancelled, the module set and editor buffer are
left unchanged.  If a file is selected in the dialogue, and it is
already in the module set, then it is selected in the current
module.  Otherwise, a new module is created with the file's
contents, and is selected as the current module.  and The file is
loaded into the editor buffer and added to the module set.</li>

<li>Refresh &#x2013; The file corresponding to the current module is read, and
its contents are loaded into the editor buffer.</li>

<li>SaveAs &#x2013; Enters the save file dialogue where the directory and file
name can be chosen.  The editor buffer is written into this file.</li>

<li>Save &#x2013; Writes the editor buffer into the current file and
directory.  If either the module name or directory is not known,
this reverts to a SaveAs.</li>

<li>Select &#x2013; Opens a list of all modules; you can click one of them
which is then set as the current module.</li>

<li>Close &#x2013; Check whether text in the editor buffer has been saved; if
not, ask whether to save it. The module is removed from the module
set, and the editor buffer is cleared.  The first module (module
number 0) is selected as the current module, but if there is no
module at all, an empty module is created and selected as current
(in effect, if there is only one module and you close it, an
automatic New is performed).</li>

<li>Example &#x2013; Reads in a very simple example program and sets it as the
current module.  This is a standalone program; you can simply click
Editor: Example, then Assembler: Assemble, then Processor: Boot, and
run the program.  This example is used in the first "getting
started" tutorial.  The example program is also available in the
Examples directory, accessible through Editor: Open.</li>
</ul>

<p>
Select is for switching among the existing modules, while New and Open
are for introducing a new module.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-linker" class="outline-2">
<h2 id="sec-linker">Linker</h2>
<div class="outline-text-2" id="text-sec-linker">
<p>
Small programs often consist of just one module (or file).  The
assembler translates the assembly language source code into machine
language which is then executed by the processor.
</p>

<p>
However, there are several reasons for breaking up larger programs
into several modules.  It's easier to work with several modules of
reasonable size rather than one gigantic file.  A module may provide
generic services that can be incorporated into many programs.
Programs can be simplified if they use libraries for common tasks,
rather than implementing everything from scratch.  It is faster to
assemble small files than large ones.
</p>

<p>
When a program consists of several modules, each one has to be
assembled separately.  However, the resulting machine language is not
executable if it refers to procedures or other values defined in
another module.  Therefore the modules need to be combined into a
single executable module; this is called <b>linking</b>.
</p>

<p>
Sigma16 supports linking, but
</p>

<p>
The system supports programs that consist of several modules.  It also
makes it easy to run programs consisting of just one standalone
module.  This is done simply and intuitively, so you can ignore the
issues of modules and linking if you just want to write a andalone
program.
</p>
</div>

<div id="outline-container-orgc5be0ec" class="outline-3">
<h3 id="orgc5be0ec">Object language</h3>
<div class="outline-text-3" id="text-orgc5be0ec">
<p>
Object code is expressed in a textual language, so the object code
readable to a human (at least, for a human who understands machine
language).  For example, binary data is specified using four
hexadecimal characters rather than a word of binary data.
</p>

<p>
The object language has a simple syntax and only a few types of
statement.  Each object statement is written on one line.  It begins
with a keyword indicating the type of statement, followed by one or
more spaces, followed by an operand field which must not contain any
white space.  The operand field is a comma-separated list of tokens;
each token is either a hex constant or an identifier.
</p>

<ul class="org-ul">
<li>In the object language, hex constants are written as four
characters, using digits 0-9 a-f.  Unlike assembly language, a hex
constant is not preceded by $.</li>

<li>Identifiers have the same syntax as in assembly language: a string
of letters, digits, and underscore characters, beginning with a
letter.</li>
</ul>

<p>
The object language has seven statements: module, org, data, import,
export, and relocate.  Some of these are related to corresponding
statements in assembly language, but their syntax is different and in
some cases they may contain different information.
</p>
</div>

<div id="outline-container-org8cc1a74" class="outline-4">
<h4 id="org8cc1a74">Statement syntax</h4>
</div>
<div id="outline-container-org8d6dea2" class="outline-4">
<h4 id="org8d6dea2">module</h4>
</div>

<div id="outline-container-org7502084" class="outline-4">
<h4 id="org7502084">org</h4>
</div>

<div id="outline-container-org85bae53" class="outline-4">
<h4 id="org85bae53">data</h4>
<div class="outline-text-4" id="text-org85bae53">
<p>
data x0,x1,&#x2026;,x<sub>j-1</sub>
</p>

<p>
Let xs be the list of j words in a data statement, and llc is the linker
location counter.  For each word x, the linker performs:
</p>

<pre class="example" id="org15cb822">
mem[llc] := x
llc := llc + 1
</pre>
</div>
</div>

<div id="outline-container-org78c5240" class="outline-4">
<h4 id="org78c5240">import</h4>
<div class="outline-text-4" id="text-org78c5240">
<p>
General form
</p>

<pre class="example" id="org5809f91">
import  modName,externalName,address,field
</pre>

<p>
Examples
</p>

<pre class="example" id="org0e95bbe">
import  Mod2,abc,03c4,dist
import  Mod3,ybit,03be,g
</pre>
</div>
</div>

<div id="outline-container-org976d15b" class="outline-4">
<h4 id="org976d15b">export</h4>
</div>


<div id="outline-container-org8b40026" class="outline-4">
<h4 id="org8b40026">relocate</h4>
<div class="outline-text-4" id="text-org8b40026">
<p>
The relocate statement specifies a list of addresses of words that
must be relocated.  Suppose the value x is specified in a relocate
statement, and the linker is relocating the module by offset y.  Then
the linker will set mem[x+y] = obj[x]+y.
</p>

<pre class="example" id="orgf7cbca2">
relocate hex4,hex4,...
</pre>



<p>
General form:
</p>

<p>
The relocate statement specifies a list of addresses, which refer to
object code words in the module.  The effect is to add the linker
location counter (llc) to each object code word.
</p>

<p>
code[addr] := code[addr] + llc
</p>

<pre class="example" id="orgea90fe8">
relocate  addr,addr,...,addr
</pre>

<p>
Each location is relcated.  The word The addresses 
</p>
</div>
</div>
</div>

<div id="outline-container-org4aa49c7" class="outline-3">
<h3 id="org4aa49c7">Module metadata</h3>
<div class="outline-text-3" id="text-org4aa49c7">
<p>
The assembler and linker create metadata files which enable the
emulator to show the assembly language statement corresponding to the
instruction currently being executed.  The metadata is not part of the
machine language, and the emulator doesn't look at it in order to
execute the program.  It is entirely optional: the emulator can run a
program without any metadata, although without it the emulator cannot
display the current assembly language source statement.  This section
explains how the metadata works and the format of the files.
</p>

<p>
The emulator attempts to show the assembly language source as the
program runs, and it highlights the current and next instruction.  To
do this, the emulator needs to have some information that isn't
present in the object code.  This extra information is supplied in a
separate metadata file produced by the assembler and the linker.
</p>

<p>
An object file foo.obj.txt may have a corresponding metadata file
foo.omd.txt ("object metadata").  An executable file foo.exe.txt may
have a corresponding metadata file foo.xmd.txt ("executable
metadata").  The format of the metadata is identical for object and
executable; the reason for the distinction is that the user might have
a program with main program foo.asm.txt, and later give the executable
the same name foo.  In that case, there will be separate metadata
files for the object and the executable.
</p>

<p>
  The metadata contains the source code in two forms:
plain text and with html tags for highlighting the fields.  In
addition, the metadata contains a mapping from address to source code
line number.
</p>

<p>
The metadata file format is parsed in order to populate several data
structures that enable the emulator to 
The metadata contains the lines of text of the assembly listing.
These lines contain the address, the object code at that address, and
the assembly language source statement.  Each line of the assembly
listing appears t  The emulator displays most
lines of the assembly listing with the same field highlighting
</p>

<p>
A metadata file contains two sections: the ASmap followed by the
source listing text.
A metadata file must have the following contents:
</p>

<p>
\(a0,s0,a1,s1,a2,s2, ..., a_{n-1},s_{n-1}\)
</p>

<p>
When the pc contains address \(a_i\) then the source statement \(s_i\)
should be displayed.
</p>


<ul class="org-ul">
<li><code>fsmap</code> <i>n</i></li>
<li>comma separated list of <i>n</i> numbers, which may be split into lines</li>
<li><code>source</code> <i>n</i></li>
<li><i>n</i> lines of html giving the assembly listing.  Each line appears
twice: first a "plain" form, followed by a "decorated" form that
contains html span elements for highlighting the fields of the text</li>
</ul>

<p>
Here is an example of a metadata file:
</p>

<pre class="example" id="orgf73ca38">
fasmap 17
14,14,15,15,16,16,17,17,18,19
19,20,20,21,21,22,24
source 32
&lt;span class='ListingHeader'&gt;Line Addr Code Code Source&lt;/span&gt;
&lt;span class='ListingHeader'&gt;Line Addr Code Code Source&lt;/span&gt;
   1 0000            ; Main: test linker
   1 0000           &lt;span class='FIELDLABEL'&gt; ... &lt;/span&gt;
</pre>
</div>
</div>

<div id="outline-container-org6f553de" class="outline-3">
<h3 id="org6f553de">Linker</h3>
<div class="outline-text-3" id="text-org6f553de">
<ul class="org-ul">
<li>GUI: selected module is main program and also receives the
executable.  All other modules are linked, and their object code is
placed after that of the selected module.  It is an error if any
module has not been assembled.  The order of the object code depends
on the order of the modules in the module list, which is essentially
arbitrary, except that the selected module always comes first in the
executable.</li>
</ul>
</div>
</div>

<div id="outline-container-org68cdebe" class="outline-3">
<h3 id="org68cdebe">Loader</h3>
<div class="outline-text-3" id="text-org68cdebe">
</div>
<div id="outline-container-org05ba571" class="outline-4">
<h4 id="org05ba571">Executable code</h4>
<div class="outline-text-4" id="text-org05ba571">
<p>
An executable module is written in the same language as object
modules.  The only difference is that an executable module must
contain only these types of statement: module, data, org.  It is now
allowed to contain any of the following statments: import, export,
relocate.
</p>

<p>
If an assembly language program doesn't contain any import or export
directives, then its object code won't contain any import, export, or
relcate statements.  In this case, the object code is already
executable and does not require linking: it can be booted directly by
the processor.
</p>

<p>
The booter (invoked by clicking the Boot button in the processor page)
reads in the currently selected module and checks to see whether it is
a valid executable module.  If so, it loads the code into the memory.
If not, it indicates that the program cannot be booted.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-programming" class="outline-2">
<h2 id="sec-programming">Programming</h2>
<div class="outline-text-2" id="text-sec-programming">
</div>

<div id="outline-container-org79cd4c4" class="outline-3">
<h3 id="org79cd4c4">Structure of a program</h3>
<div class="outline-text-3" id="text-org79cd4c4">
<p>
Simple ("static") variabls need to be declared with a data statement,
which also gives an initial value.
</p>

<pre class="example" id="org1a27628">
x  data  23
</pre>

<p>
This means: allocate a word in memory for x and initialize it to 23.
The data statements should come after the trap instruction that
terminates the program
</p>
</div>
</div>

<div id="outline-container-org6e0aff3" class="outline-3">
<h3 id="org6e0aff3">How to perform commmon tasks</h3>
<div class="outline-text-3" id="text-org6e0aff3">
</div>
<div id="outline-container-org6f23f08" class="outline-4">
<h4 id="org6f23f08">Using extract</h4>
<div class="outline-text-4" id="text-org6f23f08">
<p>
A special case is to move a Boolean from one place to another.
</p>
<ul class="org-ul">
<li>A Boolean is a bit in a register, so it takes two 4-bit fields to
specify an arbitrary Boolean</li>
<li>Would like to make it easy to implement b := c, where b and c are
arbitrary Booleans</li>
<li>This would require two 4-bit fields for each of b and c, for a total
of four 4-bit fields</li>
<li>The Exp format could accommodate this</li>
<li>But this could also be done using the extract instruction</li>
<li>Therefore it should either be omitted, or else be a pseudo
instruction that generates an extract</li>
</ul>

<p>
The extract instruction is not essential: it can be performed by a
sequence of shift and logic instructions.  However, an extract
instruction is faster than the equivalent sequence of shifts and
logic, and it also makes a program more readable by making the
intention clear.
</p>


<p>
Pseudoinstruction
</p>

<p>
Copy a bit
</p>

<p>
Invert a bit
</p>

<p>
Generate a field mask
</p>

<p>
The field pseudoinstruction loads a word into the destination register
Rd; this word consists of 1 bits in the specified field (g,h) and 0 in
all other bit positions.  This provides a field mask that can be used
with logic instructions for a variety of purposes.
</p>

<ul class="org-ul">
<li>General form: <b>field Rd,g,h</b></li>
<li>Pseudo-instruction:  <b>injecti Rd,R0,g,h</b></li>
<li>Assembler format: RKK</li>
</ul>

<p>
Semantics
</p>
<ul class="org-ul">
<li>Rd.i = 1 for g &lt;= i &lt;- h</li>
<li>Rd.i = 0 for i &lt; g or i &gt; h</li>
</ul>

<p>
Example:
</p>

<pre class="example" id="org3672013">
field   R3,4,  ; R3 := 0fc0
</pre>

<p>
Using a field mask
</p>
<ul class="org-ul">
<li>invert it to give negative mask</li>
<li>and R1 with mask to clear bits outside the field</li>
<li>and R1 with negative mask to clear only the field</li>
<li>xor R1 with mask to invert bits in the field</li>
</ul>
</div>
</div>

<div id="outline-container-org2fd04d2" class="outline-4">
<h4 id="org2fd04d2">Copying one register to another</h4>
<div class="outline-text-4" id="text-org2fd04d2">
<p>
Sometimes you want to copy a value from one register to another: R3 :=
R12.  There isn't an instruction specifically for this purpose,
because there is no need: just use the add instruction:
</p>

<pre class="example" id="org598346b">
add R3,R12,R0 ; R3 := R12
</pre>

<p>
Since R12 + 0 = R12, this copies the value in R12 into R3.  One might
think that this is less efficient than having a special instruction to
perform the copy, but it actually turns out to be more efficient to do
it this way!
</p>
</div>
</div>
</div>

<div id="outline-container-orga04609b" class="outline-3">
<h3 id="orga04609b">Compilation</h3>
<div class="outline-text-3" id="text-orga04609b">
<p>
There are two ways to handle variables:
</p>

<p>
The statement-by-statement style: Each statement is compiled
independently.  The pattern is: load, arithmetic, store.
Straightforward but inefficient.
</p>

<p>
The register-variable style: Keep variables in registers across a
group of statements.  Don't need as many loads and stores.  More
efficient.  You have to keep track of whether variables are in memory
or a register.  Use comments to show register usage.  Real compilers
use this style.  Use this style if you like the shorter code it
produces.
</p>

<p>
We'll translate the following program fragment to assembly
language, using each style:
</p>

<pre class="example" id="orgc6899c3">
x = 50;
y = 2*z;
x = x+1+z;
</pre>

<p>
Statement-by-statement style
</p>

<pre class="example" id="orgb66ebf1">
; x = 50;
     lea    R1,$0032   ; R1 = 50
     store  R1,x[R0]   ; x = 50

; y = 2*z;
     lea    R1,$0002   ; R1 = 2
     load   R2,z[R0]   ; R2 = z
     mul    R3,R1,R2   ; R3 = 2*z
     store  R3,y[R0]   ; y = 2*z

; x = x+1+z;
     load   R1,x[R0]   ; R1 = x
     lea    R2,1[R0]   ; R2 = 1
     load   R3,z[R0]   ; R3 = z
     add    R4,R1,R2   ; R4 = x+1
     add    R4,R4,R3   ; R4 = x+1+z
     store  R4,x[R0]   ; x = x+1+z
</pre>

<p>
Register-variable style
</p>

<pre class="example" id="org0244149">
; Usage of registers
;   R1 = x
;   R2 = y
;   R3 = z

; x = 50;
     lea    R1,$0032   ; x = 50
     load   R3,z[R0]   ; R3 = z
     lea    R4,$0002   ; R4 = 2
; y = 2*z;
     mul    R2,R4,R3   ; y = 2*z
; x = x+1+z;
     lea    R4,$0001   ; R4 = 1
     add    R1,R1,R4   ; x = x+1
     add    R1,R1,R3   ; x = x+z
     store  R1,x[R0]   ; move x to memory
     store  R2,y[R0]   ; move y to memory
</pre>

<p>
Comparison of the styles
</p>

<p>
Statement by statement.
</p>
<ul class="org-ul">
<li>Each statement is compiled into a separate block of code.</li>
<li>Each statement requires loads, computation, then stores.</li>
<li>A variable may appear in several different registers.</li>
<li>There may be a lot of redundant loading and storing.</li>
<li>The object code corresponds straightforwardly to the source
code, but it may be unnecessarily long.</li>
</ul>

<p>
Register variable
</p>
<ul class="org-ul">
<li>The instructions corresponding to the statemnts are mixed
together.</li>
<li>Some statements are executed entirely in the registers.</li>
<li>A variable is kept in the same register across many
statments.</li>
<li>The use of loads and stores is minimised.</li>
<li>The object code is concise, but it's harder to see how it
corresponds to the source code.</li>
<li>It's possible to have a mixture of the styles: you don't have
to follow one or the other all the time.</li>
</ul>
</div>
</div>

<div id="outline-container-org42db2c6" class="outline-3">
<h3 id="org42db2c6">Errors: avoiding, finding, and fixing</h3>
<div class="outline-text-3" id="text-org42db2c6">
</div>
<div id="outline-container-org724d028" class="outline-4">
<h4 id="org724d028">Critical regions</h4>
<div class="outline-text-4" id="text-org724d028">
<p>
A testset instruction is not semantically equivalent to a load
followed by a store.  Consider this example:
</p>

<pre class="example" id="org770263a">
; (1) testset
     testset   R1,mutex[R0]
</pre>

<p>
It is not the same as
</p>

<pre class="example" id="org91a3b65">
; (2) sequence of instructions
     load     R1,mutex[R0]
     lea      R2,1[R0]
     store    R2,mutex[R0]
</pre>

<p>
The essential difference is that (1) executes as an atomic operation,
but (2) does not, and this could lead to errors in mutual exclusion,
which could lead in turn to fatal errors, crashes, and security
violations.
</p>

<p>
Consider, for example, a situation where two processes are sharing
mutex to control access to a critical retion.
</p>

<p>
  an interrupt could occor after the
load and before the store.  Suppose, for example, that initially mutex
= 0 and the sequence  is executed.
Another process could be performing a similar sequence of instructions
on the same mutex variable.
</p>
</div>
</div>

<div id="outline-container-org2710afc" class="outline-4">
<h4 id="org2710afc">Robust programming</h4>
<div class="outline-text-4" id="text-org2710afc">
<p>
*Use a systematic programming process
</p>

<ul class="org-ul">
<li>Start with a high level algorithm</li>
<li>Then translate that to the low level ("if b then goto label") form</li>
<li>Translate the low level to assembly language, keeping the higher
level versions as comments</li>
</ul>

<p>
<b>Use comments both to develop the program and to document it</b>
</p>

<ul class="org-ul">
<li>Write the comments first, as you develop the program.  There should
already be some good comments (e.g. the algorithm) before any
instructions at all have been written.</li>
<li>Don't fall into the trap of hacking out instructions and then adding
comments later: this loses the benefits that documention offers as
you're writing the code.</li>
</ul>

<p>
<b>How to write good comments</b>
</p>

<ul class="org-ul">
<li>Keep the high level and low level algorithms as comments</li>
<li>Comment each instruction</li>
<li>Use the comments to explain what your program is doing, not to
explain what an instruction does.</li>
<li>Assume that the reader already knows the language, but not the
details of your program.</li>
</ul>
</div>
</div>

<div id="outline-container-org816d02c" class="outline-4">
<h4 id="org816d02c">Error messages</h4>
</div>

<div id="outline-container-orgdf0b540" class="outline-4">
<h4 id="orgdf0b540">Runtime debugging</h4>
<div class="outline-text-4" id="text-orgdf0b540">
<p>
<b>What if an instruction doesn't do what you expected?</b>
</p>

<ul class="org-ul">
<li>Execute the program to the point where the mysterious instruction is
about to be executed, but has not yet executed.  (To do this, you
can step through the program, or set a breakpoint.)</li>

<li>Make sure you know what the instruction is supposed to do (check the
User Guide).</li>

<li>Looking at the state of the registers and memory, carefully predict
what you expect the instruction to do.</li>

<li>Execute the one instruction (click Step) and compare the state of
the machine with your prediction.</li>

<li>Make sure the instruction has not been modified in memory.  Compare
the machine language produced by the assembler with the <b>current</b>
contents of the word or words in memory where the instruction is
located.</li>
</ul>
</div>
</div>

<div id="outline-container-org43aa7ef" class="outline-4">
<h4 id="org43aa7ef">Breakpoints</h4>
<div class="outline-text-4" id="text-org43aa7ef">
<p>
<b>(Note: the breakpoint system is not fully implemented yet; the
following describes a temporary breakpoint facility.)</b>
</p>

<p>
A breakpoint is the address of an instruction; when the machine is
about to execute that instruction (i.e. when the pc contains that
address) the emulator will halt execution, enabling the programmer to
examine the state of registers and memory.  To set a breakpoint, click
Breakpoint and enter the instruction address you want to stop at in
the dialogue box.  There are several control buttons.  Refresh means
"read the contents of the text in the box, which must be a $ followed
by a 4 hex digit address".  Whenever you change the text, you should
click Refresh.  The Enable button toggles the breakpoint on and off.
The Close button hides the Breakpoint dialogue box.  Here's an
example.  Suppose you want to stop execution of a program at address
00f6:
</p>

<ul class="org-ul">
<li>Click Breakpoint</li>
<li>Enter $00f6</li>
<li>Click Refresh</li>
<li>Click Enable</li>
<li>Click Close</li>
<li>Click Run</li>
</ul>

<p>
The execution will run until the pc becomes equal to 00f6
and will then stop.
</p>

<p>
Click Refresh, then Enable, then
Close.  Then click Run, and the emulator will run at full speed until
the pc reaches the specified value; then it will stop so you can
examine the state of the machine.
</p>


<ul class="org-ul">
<li>Circuit</li>
</ul>

<p>
There is a complete digital circuit called M1 that implements the core
of the Sigma16 architecture (apart from the divide instruction).  This
circuit is specified completely down to the level of logic gates and
flip flops.  M1 uses sequential control and does not have instruction
level parallelism.  Its design is written in Hydra, a functional
computer hardware description language.  The circuit can be simulated,
and you can run Sigma16 programs on the circuit.
</p>

<p>
The directory structure: the M1 circuit is in the directory
Sigma16/circuits/M1.  This directory defines a module (file) called
M1driver.hs which needs to be imported by a program run file.  In
addition, Hydra itself needs to be imported.  The program run files
are in Sigma16/circuits/M1/programs/.
</p>

<pre class="example" id="org9853f19">
/c/Users/me/a/b/c/Hydra      path to Hydra on your machine
Sigma16                      path to Sigma16 on your machine
</pre>

<pre class="example" id="orgddf138d">
Sigma16/circuits/M1
Sigma16/circuits/M1/programs
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgca90b40" class="outline-2">
<h2 id="orgca90b40">M1: a Sigma16 CPU circuit</h2>
<div class="outline-text-2" id="text-orgca90b40">
<p>
Sigma16 is a 16-bit instruction set architecture, and M1 is a digital
circuit that implements it.  M1 is designed for simplicity rather than
speed; more advanced circuits introduce techniques that make the
system faster at the cost of greater complexity.
</p>

<p>
M1 is specified using the Hydra hardware description language, which
generates and simulates circuits.  There is also a simulation driver,
M1run, which takes a machine language program, loads it into the
system memory, and then simulates the circuit.  The effect of this is
to execute the program on the circuit.  This is fundamentally
different from emulation: M1 is pure hardware, consisting entirely of
flip flops, logic gates, and wires.
</p>

<p>
The simulation driver takes a machine language program as input, in
the form of a list of strings giving the contents of memory words in
hexadecimal.  It produces formatted output giving the value, for each
clock cycle, of the most important internal signals in the circuit.
Hydra, and has a simulator that can run machine language programs.
</p>
</div>

<div id="outline-container-org4f6a4e1" class="outline-3">
<h3 id="org4f6a4e1">Installation</h3>
<div class="outline-text-3" id="text-org4f6a4e1">
</div>
<div id="outline-container-orgeca4f39" class="outline-4">
<h4 id="orgeca4f39">Download Sigma16</h4>
</div>


<div id="outline-container-orgd896142" class="outline-4">
<h4 id="orgd896142">Install ghc</h4>
<div class="outline-text-4" id="text-orgd896142">
<p>
Install the ghc Haskell compiler, which you can download from the
Haskell web page <a href="https://www.haskell.org/">https://www.haskell.org/</a>.  A standard
installation will also install the packaging tool <code>cabal</code>.  Check that
the installation succeeded with <code>ghc --version</code> and <code>cabal --version</code>.
</p>

<pre class="example" id="org01916b2">
$ ghc --version
The Glorious Glasgow Haskell Compilation System, version 9.0.1
$ cabal --version
cabal-install version 3.4.0.0
compiled using version 3.4.0.0 of the Cabal library
</pre>

<p>
The following commands will download and install a few packages that
are needed.  You only need to do this once:
</p>

<pre class="example" id="orgc394648">
cabal update
cabal install --lib parsec
cabal install --lib mtl
cabal install --lib ansi-terminal
</pre>
</div>
</div>

<div id="outline-container-org2aeb25f" class="outline-4">
<h4 id="org2aeb25f">(Optional) Install node.js and configure shell commands</h4>
<div class="outline-text-4" id="text-org2aeb25f">
<p>
This entire step is optional.  To run machine language programs on the
circuit, you need to use the assembler to translate assembly language
source to machine language.  You can use the Sigma16 GUI app to do
that; just assemble a program, copy the object code text into a text
editor, and save it as a file.
</p>

<p>
If you do the installation described in this section, you can simply
issue a command in the shell.  For example, this command will
translate MyProg.asm.txt and create the file MyProg.obj.txt:
</p>

<pre class="example" id="org0fe60c3">
sigma16 assemble MyProg
</pre>

<p>
Visit <a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a>
and download node.js for your platform
</p>

<p>
It's convenient to define an alias to the directory where you have the
example programs.  For example, in .bashrc:
</p>

<pre class="example" id="org9256455">
export COREPROGS="../../examples/Core"
</pre>

<p>
Add the following to your .bashrc
file, but replace <i>Users//yourlogin/Documents/path/to</i> with your own file
location.
</p>

<pre class="example" id="org70851e3">
SIGMA16=/Users/yourlogin/Documents/path/to/Sigma16
export SIGMA16
</pre>

<p>
Sigma16/src/circuits contains a file .ghci that contains several
commands which are automatically executed with ghci is launched.  If
.ghci is missing, you can also enter those commands manually.  Here is
the text of .ghci:
</p>

<pre class="example" id="orga800b44">
:set -package mtl
:set -package parsec
:load M1/Tools/Run
</pre>
</div>
</div>
</div>



<div id="outline-container-org42252f2" class="outline-3">
<h3 id="org42252f2">Quick start</h3>
<div class="outline-text-3" id="text-org42252f2">
<p>
The Sigma16 download contains all the files you need, with the correct
directory structure.  Change to this directory, which contains Hydra,
the M1 circuit, and some additional tools:
</p>

<pre class="example" id="orgfb5ea40">
$ cd Sigma16/src/circuits   (you need to be in this directory)
</pre>

<p>
Within Sigma16/src/circuits, there are several subdirectories:
</p>

<ul class="org-ul">
<li>Circuits contains a collection of small to medium examples.</li>
<li>M1 contains the M1 circuit, which is a CPU that implements the Core
Sigma16 instruction set</li>
<li>HDL/Hydra contains the Hydra hardware description language.  You
won't need to read or change anything in this directory, but it
needs to be there.</li>
<li>Sigm16 contains a function that reads in an object code file, parses
it, and generates the control signals needed to boot the program
into the circuit.  Again, you won't need to read or change anything
in this directory.</li>
</ul>
</div>

<div id="outline-container-org6e06c9f" class="outline-4">
<h4 id="org6e06c9f">Simulating a small circuit</h4>
<div class="outline-text-4" id="text-org6e06c9f">
<p>
Here is a simple circuit specification file, Circuits/Reg1.hs:
</p>

<pre class="example" id="org7ebe0dc">
module Circuits.Reg1 where

import HDL.Hydra.Core.Lib
import HDL.Hydra.Circuits.Combinational
-- import HDL.Hydra.Circuits.Register

--  This example is named myreg1 to avoid confusion with the reg1
-- circuit defined in the Hydra libraries.

-- Normally reg1 would only output r, as q is just an internal signal.
-- However, it is enlightening for a student to experiment
-- interactively with the circuit, and to do that it's helpful to see
-- the value of q.

myreg1 :: CBit a =&gt; a -&gt; a -&gt; (a,a)
myreg1 ld x = (r, q)
  where r = dff q
        q = or2 (and2 (inv ld) r) (and2 ld x)
</pre>

<p>
To simulate the circuit, we need a simulation driver, a separate file
that describes how to obtain the inputs and how to format the outputs.
</p>

<pre class="example" id="org9e2a89a">
-- Reg1Run: simulate a 1-bit register circuit
-- Copyright (C) 2021 John T. O'Donnell.  This file is part of Sigma16.
-- See Sigma16/README and https://jtod.github.io/home/Sigma16/

-- This is an example of how to simulate a small circuit
-- interactively.  The circuit (myreg1) uses individual bits.  For an
-- example that also uses words, see RegRun.  See the User Guide and
-- Sigma16/src/circuits/README.

-- cd Sigma16/src/circuits   -- must be in this directory
-- ghci                      -- start ghci and initialize using .ghci
-- :load Circuits/Reg1Run    -- load the simulation driver
-- :main                     -- run it: launch the main program

module Main where
import HDL.Hydra.Core.Lib   -- the hardware description language
import Circuits.Reg1        -- definition of the circuit to be simulated

main :: Driver a
main = driver $ do

  -- Input ports
  in_ld &lt;- inPortBit "ld"
  in_x  &lt;- inPortBit "x"

  -- Input signals
  let ld = inbsig in_ld
  let x  = inbsig in_x
  
  -- The circuit myreg1 receives input signals and defines output signals
  let (r,q) = myreg1 ld x

  -- The output ports are interfaces to the output signals
  out_r &lt;- outPortBit "r" r
  out_q &lt;- outPortBit "q" q

  -- Run interactive simulation 
  runSimulation
</pre>

<p>
Much of this is boilerplate.  The file imports the Hydra language, and
it also imports the Reg1 circuit.  The most important parts of the
file are:
</p>
<ul class="org-ul">
<li>Input ports.  An input port is an object with some metadata along
with the actual input signal, and you generate a port with a line
like in<sub>ld</sub> &lt;- inPortBit "ld".  This says that in<sub>ld</sub> is in input
port, and the name is "ld".  (See RegRun.hs for an example that has
some ports that are words.)</li>
<li>Input signals.  A signal is essentially a wire, and we need to
define the signal for each input port.  The following line says that
ld is a signal form the port in<sub>ld</sub>:</li>
</ul>
<pre class="example" id="org61cbe26">
let ld = inbsig in_ld
</pre>
<ul class="org-ul">
<li>Circuit definition.  This is a let statement that says (r,q) are the
outputs from the myreg1 circuit which is connected to input signals
ld and x:</li>
</ul>
<pre class="example" id="org04c9ded">
let (r,q) = myreg1 ld x
</pre>
<ul class="org-ul">
<li>We define and output port for the output signals: thus out<sub>r</sub> is an
output port that ontains the signal r:</li>
</ul>

<pre class="example" id="orgeeb51a5">
out_r &lt;- outPortBit "r" r
</pre>

<ul class="org-ul">
<li>Finally, the last statement says to simulate the circuit:</li>
</ul>

<pre class="example" id="orgc94813c">
runSimulation
</pre>

<p>
To run a simulation of the circuit, enter these commands (you need to
be in the Sigma16/src/circuits directory).  $ is the bash shell
prompt, and : is the ghci prompt.
</p>

<pre class="example" id="org833881c">
$ ghci                              start Haskell and load Hydra
ghci&gt; :load Circuits/Reg1Run        load the reg1 circuit and its driver
ghci&gt; :main                         run interactive simulation, entter h for help
</pre>

<p>
This will start an interactive session.  When the system prompts for a
command, just press Enter, which tells it to run for one clock cycle.
It will them prompt for the value of each input port, and will print
out the values of the signals.
</p>

<pre class="example" id="orgefe74ea">
clockCycle...
----------------------------------------------------------------------
Cycle 0
Reading inputs from user:
Enter value of ld (0 or 1, then enter)
0
Enter value of x (0 or 1, then enter)
1
Input signals during cycle 0
    ld = 0
    x = 1
Output signals during cycle 0
    r = 0
    q = 0
Enter command after prompt
$
doCommand: ws = []
clockCycle...
----------------------------------------------------------------------
Cycle 1
Reading inputs from user:
Enter value of ld (0 or 1, then enter)
0
Enter value of x (0 or 1, then enter)
0
Input signals during cycle 1
    ld = 0
    x = 0
Output signals during cycle 1
    r = 0
    q = 0
Enter command after prompt
</pre>
</div>
</div>

<div id="outline-container-org90acad0" class="outline-4">
<h4 id="org90acad0">Words as well as bits</h4>
<div class="outline-text-4" id="text-org90acad0">
<p>
A signal may be either a bit or a word.  See RegRun for an example.
The second line says that in<sub>x</sub> is an input port for a word of 4 bits.
The last line says that x is a word signal from the in<sub>x</sub> port.  To
extact a signal from a port, use inbsig for bit signals, and use
inwsig for word signals.
</p>

<pre class="example" id="org3b29834">
in_ld &lt;- inPortBit "ld"
in_x &lt;- inPortWord "x" 4

-- Input signals  
let ld = inbsig in_ld
let x = inwsig in_x
</pre>
</div>
</div>

<div id="outline-container-org37a10d1" class="outline-4">
<h4 id="org37a10d1">Incorporating test data in the driver</h4>
<div class="outline-text-4" id="text-org37a10d1">
<p>
If you want to run many simulations with the same input data (or with
only small changes to the data), it's easier to define the data in the
driver file rather than entering it interactively
Circuits/Reg1RunData gives an example of this.
</p>

<p>
The file begins by several input data test cases.  Each data set is a
list of strings, and each string gives the values for the inputs
during a clock cycle.  The i'th number in the string gives the value
of the i'th input port.  SInce the input ports are in<sub>ld</sub> and then
in<sub>x</sub>, a string "1 0" means that ld=1 and x=0 for a clock cycle.
</p>

<pre class="example" id="orgdb2d46a">
randominputs = [ "1 1", "0 0", "0 0", "1 0", "0 0", "0 1", "1 1", "0 1", "0 0"]
alwaysLoad1 = ["1 1", "1 1", "1 1", "1 1", "1 1", "1 1"]
alwaysLoad0 = ["1 0", "1 0","1 0","1 0","1 0","1 0","1 0"]
idle = ["0 0", "0 0", "0 0", "0 0", "0 0", "0 0"]
</pre>

<p>
The beginning of the driver has two statements connected to the input
data.  The storeInputList command tells the driver to store
randominputs in its internal state, under the key "data".  You can
store many input lists in the state.  The next statement selects the
particular input data, by its key.
</p>

<pre class="example" id="orge040ea4">
main :: Driver a
main = driver $ do

  initialize
  storeInputList "data" randominputs
  selectInputList "data"
</pre>

<p>
Now when you execute the simulation, the driver will automatically
take the input data from the stored input list.  Each time you press
Enter it will give the signal values for a clock cycle.  If you keep
going after it runs out of data from the selexcted input list, the
driver will start prompting you for the input values.
</p>
</div>
</div>

<div id="outline-container-org259dcf5" class="outline-4">
<h4 id="org259dcf5">Running a machine language program on the M1 CPU</h4>
<div class="outline-text-4" id="text-org259dcf5">
<p>
The M1 circuit is a complete CPU circuit for Sigma16 Core.  Its driver
is M1/Run.hs, and the circuit itself is in M1/Circuits.
</p>

<p>
To run a program on the circuit, we first need to translate it from
assembly language to machine language.  If you have installed node.js
and defined the shell alias, you can do this with the command:
</p>

<pre class="example" id="orgeb8b818">
$ sigma16 assemble $COREPROGS/Simple/Add
</pre>

<p>
In order to make it easy to run the collection of Sigma16 example
programs on the circuit, the driver looks for files in the directory
Sigma16/examples/Core.  A subdirectory there is Simple, and that
contains a small test program named Add.asm.txt.
</p>

<p>
The source program is Simple/Add.asm.txt, and the object code file
must be named Simple/Add.obj.txt.  The following commands will run it:
</p>

<pre class="example" id="org82d31c0">
 $ ghci                start Haskell and load Hydra
 ghci&gt; :load M1/Run    load M1 and its driver
:main Simple/Add       run M1 circuit on examples/Core/Simple/Add.obj.txt
</pre>

<p>
When you write your own circuits and drivers, it's a good idea to
place them in a directory Sigma16/examples/Core/MYPROGS, and then you
would run it with :main MYPROGS/prog1
</p>

<p>
The command :main Simple/Add tells the simulation driver to read the
file, parse it (i.e. translate the hex strings to numbers), and to
generate the input signals required to make the CPU copy the machine
language into memory, starting at location 0.  This processis called
"booting".
</p>

<p>
The driver is interactive: it reads a command, executes it, and reads
another command.  You can get a list of commands by entering help:
</p>

<pre class="example" id="orgc9d7f33">
Sigma16_M1 simulation
Sigma16.M1&gt; help
Commands for the M1 driver
  (blank)     -- perform one clock cycle
  cycle       -- perform one clock cycle
  run         -- perform clock cycles repeatedly until halt or break
  regs        -- display contents of the register file
  mem a b     -- display memory from address a to b
  break FLAG  -- run will stop when FLAG signal is 1 (see list below)
  quit        -- return to ghci or shell prompt
  help        -- list the commands
The following signals can be used as break FLAG:
 st_instr_fet st_dispatch st_add st_sub st_mul0 st_div0 st_cmp st_trap0 st_lea0 st_load0 st_store0 st_jump0 st_jumpc00 st_jumpc10 st_jal0
Sigma16.M1&gt;
</pre>

<p>
Try pressing Enter several times.  This will simulate one clock cycle
at a time, and print out full information about the signals during
that cycle.  The Add program contains about a dozen words of machine
code, so the Boot process will take the same number of Enter presses.
Eventually the driver will output "Reset: control algorithm starting".
</p>

<p>
The next clock cycle will show the control state to have st<sub>instr</sub><sub>fet</sub>
= 11.  Usually, every control state will be either 11 (the machine is
doing this state) or 00 (the machine is not doing it).  If I/O is
taking place, you will see a state of 10, but ignore that for now.
</p>

<p>
At any time, you can enter the command run.  This will execute clock
cycles repeatedly until the machine executes a trap halt instruction
(trap R0,R0,R0).
</p>

<p>
There are two commands that are very useful for debugging: you can
print out the register file with <b><b>regs</b></b>, and you can print all the
memory locations from address a to be with <b><b>mem a b</b></b>.
</p>

<p>
The system is not "cheating" when you dump the registers or memory:
there isn't some outside software that "looks inside" to get the data
and print it.  Instead, the driver sets the circuit input signals
telling it to perform an output operation (using DMA, direct memory
access), and the driver collects and outputs the results.
</p>

<p>
Another useful debugging technique is to set a breakpoint.  You may
have a situation where you want to look in detail at how an
instruction executes, but this could come after thousands of clock
cycles, and you don't want to press Enter so may times.
</p>

<p>
If you enter the command <b><b>break st<sub>load0</sub></b></b>, and then press run, the
driver will simulate clock cycles repeatedly until the signal st<sub>load0</sub>
becomes 1; then it will stop and display the state of the system.
</p>
</div>
</div>

<div id="outline-container-org439d691" class="outline-4">
<h4 id="org439d691">Using ghci</h4>
<div class="outline-text-4" id="text-org439d691">
<p>
Useful ghci commands (see ghc User Guide for full documentationO
</p>
<pre class="example" id="orgf12a63e">
:r         reload after editing any of the code
:q         exit ghci, go back to shell
^C         stop and return to ghci prompt
uparrow    repeat previous command
</pre>

<p>
When ghci is launched it automatically executes the commands in .ghci:
</p>

<pre class="example" id="orgcbdc36e">
:set -package mtl
:set -package parsec
:load M1/Tools/Run
</pre>
</div>
</div>
</div>






<div id="outline-container-org3d0b027" class="outline-3">
<h3 id="org3d0b027">The hardware description language Hydra</h3>
<div class="outline-text-3" id="text-org3d0b027">
<p>
Quick start
Introduction
Building block circuits
   reg: n-bit register component
   mux1w: multiplexer with 1-bit control
   register file
Instruction set architecture of Sigma16
The M1 circuit
   ir register (instruction register)
   pc register (program counter)
   ad register (address register)
   memory
   list of control signals
Running machine language on the circuit
   Interpreting the simulation output
</p>


<p>
reg :  n-bit register component
</p>


<p>
Use it to hold an n-bit number, and load a new value when you want
</p>

<p>
Interface
  &#x2013; size paramemter n
  &#x2013; two inputs: a load control and an n-bit data input
  &#x2013; output: contents of the register
Example:  pc = reg n ctl<sub>pc</sub><sub>ld</sub> q
   suppose n=16 (as it is in Sigma16)
   r is the 16-bit output of the register
   ctl<sub>pc</sub><sub>ld</sub> is a 1-bit control input
   Output pc is the contents of the register
   At next clock tick, if ctl<sub>pc</sub><sub>ld</sub>=1 then pc := q
</p>


<hr />
<p>
mux1w : multiplexer with 1-bit control
</p>
<hr />

<p>
Use it to choose from among several different values
</p>

<p>
Interface
  &#x2013; first argument:  1-bit control input
  &#x2013; second and third arguments: data word inputs
  &#x2013; output: a word
</p>

<p>
Example:  mux1w ctl<sub>adr</sub><sub>alu</sub> memdat r
  ctl<sub>adr</sub><sub>alu</sub> is a control bit
  memdat, r are data word inputs
    If ctl<sub>adr</sub><sub>alu</sub>=0 then output = memdat
    If ctl<sub>adr</sub><sub>alu</sub>=1 then output = r
</p>


<hr />
<p>
Register file
</p>
<hr />

<p>
readouts:
  a = reg[rf<sub>sa</sub>]
  b = reg[rf<sub>sb</sub>]
at clock tick:
  if ctl<sub>rf</sub><sub>ld</sub>=1
     then reg[ir<sub>d</sub>] := p
</p>

<p>
ctl<sub>rf</sub><sub>ld</sub> = 1 means "load p into reg[ir<sub>d</sub>]"
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;..
rf<sub>sa</sub> is the first register to read out from regfile
a = reg[rf<sub>sa</sub>]
It is a choice from among {ir<sub>sa</sub>, ir<sub>d</sub>}
</p>

<p>
rf<sub>sa</sub> =
  if ctl<sub>rf</sub><sub>sd</sub> = 0
    then ir<sub>sa</sub>
    else ir<sub>d</sub>
</p>

<p>
Normally, we want to use ir<sub>sa</sub> as the first register to read out.  In
add R1,R2,R3 the ir<sub>sa</sub> field is 2 and we want to read reg[2].  In this
case, make ctl<sub>rf</sub><sub>sd</sub> = 0.
</p>

<p>
In a store instruction, we need to read out the register in ir<sub>d</sub>.  For
example, in store R5,xyz[R0] we have ir<sub>d</sub>=5 and that's the register
that needs to be read.  In this case, make ctl<sub>rf</sub><sub>sd</sub> = 1.
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;..
rf<sub>sb</sub> is the second register to read out from regfile
b = reg[rf<sub>sb</sub>]
It is always ir<sub>sb</sub>
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;..
p is the data input to regfile (the value to load into destination)
</p>

<p>
p = a choice from among {memdat, r, pc}
p = if ctl<sub>rf</sub><sub>pc</sub> = 0
      then p = (if ctl<sub>rf</sub><sub>alu</sub> -0
                  then memdat
                  else r)
      else pc
</p>

<p>
This table summarises the value of p:
</p>

<p>
ctl<sub>rf</sub><sub>pc</sub>   ctl<sub>rf</sub><sub>alu</sub>     p
</p>
<hr />
<p>
0           0        memdat
0           1         r
1           0         pc
1           1         pc
</p>



<hr />
<p>
Memory
</p>
<hr />

<p>
Every cycle, the memory outputs mem[ma]
At clock tick:
  if m<sub>sto</sub>
    then mem[ma] := memdat
</p>

<p>
{This is a slight simplification: there are some further
 issues concerning memory and Input/Output}
</p>

<p>
ma = memory address, a choice among {ad, pc}
ma = if ctl<sub>ma</sub><sub>pc</sub> = 0
       then ad
       else pc
</p>

<p>
ctl<sub>ma</sub><sub>pc</sub> = 1 means "use pc as the memory address"
</p>
</div>
</div>


<div id="outline-container-org39a1fce" class="outline-3">
<h3 id="org39a1fce">The M1 circuit</h3>
<div class="outline-text-3" id="text-org39a1fce">
<p>
This is a quick summary and reference for the M1 circuit, which
implements the Sigma16 architecture.
</p>
</div>

<div id="outline-container-org59c0c48" class="outline-4">
<h4 id="org59c0c48">Files</h4>
<div class="outline-text-4" id="text-org59c0c48">
<p>
ALU.hs           &#x2013; specifies the M1 alu
ALU<sub>Run.hs</sub>       &#x2013; simulation driver and test data for the ALU
Control.hs       &#x2013; specifies the M1 control
Control<sub>Run.hs</sub>   &#x2013; simulation driver and test data for the control
CPU.hs           &#x2013; specifies the full M1 system
CPU<sub>Run.hs</sub>       &#x2013; simulation driver for the full system
</p>

<p>
ProgArrayMax.hs  &#x2013; A machine language program to test the CPU
                 &#x2013; This is the main program
</p>
</div>
</div>

<div id="outline-container-org3e8c5c4" class="outline-4">
<h4 id="org3e8c5c4">Core instructions implemented by M1</h4>
<div class="outline-text-4" id="text-org3e8c5c4">
<p>
The M1 circuit implements the Core subset of Sigma16 (apart from the
mul and div instructions, which are nop).
</p>
</div>

<ul class="org-ul">
<li><a id="orgee24547"></a>RRR instructions<br />
<div class="outline-text-5" id="text-orgee24547">
<p>
 op   format  mnemonic   operands   action
-&#x2014; ---&#x2013;&#x2014; -----&#x2013;&#x2014; -----&#x2013;&#x2014; -------------------------------&#x2013;&#x2014;
 0     RRR    add        R1,R2,R3   R1 := R2+R3
 1     RRR    sub        R1,R2,R3   R1 := R2-R3
 2     RRR    mul        R1,R2,R3   R1 := R2*R3, R15 := high word
 3     RRR    div        R1,R2,R3   R1 := R2/R3, R15 := R2 mod R3
 4     RRR    cmp        R2,R3      R15 := comparison flags
 b     RRR    trap       R1,R2,R3   trap interrupt
</p>
</div>
</li>

<li><a id="org7952825"></a>RX instructions<br />
<div class="outline-text-5" id="text-org7952825">
<p>
 op   b   format  mnemonic   operands   action
-&#x2014; &#x2014; ---&#x2013;&#x2014; -----&#x2013;&#x2014; -----&#x2013;&#x2014; ----------------------------&#x2013;&#x2014;
 f    0     RX    lea        Rd,x[Ra]   Rd := x+Ra
 f    1     RX    load       Rd,x[Ra]   Rd := mem[x+Ra]
 f    2     RX    store      Rd,x[Ra]   mem[x+Ra] := Rd
 f    3     RX    jump       x[Ra]      pc := x+Ra
 f    4     RX    jumpc0     Rd,x[Ra]   if R15.d=0 then pc := x+Ra
 f    5     RX    jumpc1     Rd,x[Ra]   if R15.d=1 then pc := x+Ra
 f    6     RX    jal        Rd,x[Ra]   Rd := pc, pc := x+Ra
</p>
</div>
</li>

<li><a id="orgd71c20a"></a>Organization of M1<br />
<div class="outline-text-5" id="text-orgd71c20a">
<p>
M1 is a CPU that implements the Core subset of the Sigma16
architecture.  It is designed for simplicity, and not optimized for
speed.  It assumes that the memory runs at cache speed, and there is
no separate cache.  There is a rudimentary I/O system that uses DMA to
boot up the system by inputting a block of data and then jumps to
location 0 to begin execution.  There is no instruction level
parallelism.
</p>

<p>
Some of the features of Sigma16 are not implemented in M1.  That means
that some programs will give different results in the Sigma16 emulator
and on the M1 circuit.  These features include some unimplemented
instructions (mult, div, shifting, and logic).
</p>

<p>
The M1 circuit consists of three main subsystems: datapath, control,
and memory.  Inside the datapath is another subsystem, the alu.  Each
of these is defined in a separate module, and there are separate
simulation drivers for the alu, datapath, and control.  The m1 circuit
connects the subsystems together and handles bootstrapping.
</p>
</div>
</li>

<li><a id="org0f50dce"></a>ALU (arithmetic &amp; logic unit)<br />
<div class="outline-text-5" id="text-org0f50dce">
<p>
Inputs to ALU are x and y
</p>

<p>
Operation to be performed is specified by an ALU opcode consisting of
4 bits: ctl<sub>alu</sub><sub>a</sub>, ctl<sub>alu</sub><sub>b</sub>, ctl<sub>alu</sub><sub>c</sub>, ctl<sub>alu</sub><sub>d</sub>.  In the table
below, call them just a,b,c,d.
</p>

<p>
The ALU performs addition, subtraction, negation, increment, and
comparision for &lt;, =, and &gt;.  It receives four control signals
(a,b,c,d) that determine which function it will compute.  These are
shown in the following table, where don't-care values are left blank.
</p>

<p>
Note that the alu doesn't implement some of the operations used by RRR
instructions.  Those instructions will actually do nothing.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>~~~~~~~~~~~~~~~~~~~~~~</code></td>
</tr>

<tr>
<td class="org-left">Function</td>
<td class="org-left">a,b   c,d</td>
</tr>

<tr>
<td class="org-left"><code>~~~~~~~~</code></td>
<td class="org-left"><code>~~~~~~~~~~~</code></td>
</tr>

<tr>
<td class="org-left">x+y</td>
<td class="org-left">0 0</td>
</tr>

<tr>
<td class="org-left">x-y</td>
<td class="org-left">0 1</td>
</tr>

<tr>
<td class="org-left">-x</td>
<td class="org-left">1 0</td>
</tr>

<tr>
<td class="org-left">x+1</td>
<td class="org-left">1 1   0 0</td>
</tr>

<tr>
<td class="org-left">x&lt;y</td>
<td class="org-left">1 1   0 1</td>
</tr>

<tr>
<td class="org-left">x=y</td>
<td class="org-left">1 1   1 0</td>
</tr>

<tr>
<td class="org-left">x&gt;y</td>
<td class="org-left">1 1   1 1</td>
</tr>
</tbody>
</table>
<p>
<code>~~~~~~~~~~~~~~~~~~~~~~~~</code>
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;..
x is the first data input to the alu
x = a choice from among {a, pc}
x = if ctl<sub>x</sub><sub>pc</sub> = 0
      then a
      else pc
</p>

<p>
ctl<sub>x</sub><sub>pc</sub> = 1 means "make x = value in pc register"
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;..
y is the second data input to the alu
y = a choice from among {b, ad}
y = if ctl<sub>y</sub><sub>ad</sub> = 0
      then b
      else ad
</p>

<p>
ctl<sub>y</sub><sub>ad</sub> = 1 means "make y = value in ad register"
</p>
</div>
</li>


<li><a id="org4c8ae35"></a>Datapath<br /></li>
<li><a id="orgf97ade8"></a>Instruction control registers<br />
<div class="outline-text-5" id="text-orgf97ade8">
<ul class="org-ul">
<li>ir register (instruction register) holds the instruction currently
being executed.  At clock tick if ctl<sub>ir</sub><sub>ld</sub> = 1 then ir := memdat</li>

<li>pc register (program counter) holds the address of the next
instruction word to be fetched At clock tick if ctl<sub>pc</sub><sub>ld</sub> = 1 then
pc := q</li>

<li>q is the data input to the pc register. q is a choice from among {r,
ad} q = if ctl<sub>pc</sub><sub>ad</sub> = 0 then r else ad</li>

<li>ad register (address register). This register holds the second word
of an RX instruction, and is also used for calculating the effective
address (when this is calculated by the ALU, we need adr := r)</li>
</ul>

<p>
At clock tick
  if ctl<sub>adr</sub><sub>ld</sub> = 1
     then ad := (if ctl<sub>adr</sub><sub>alu</sub> = 0
                  then memdat
                  else r)
</p>
</div>
</li>

<li><a id="org86169ad"></a>Control<br /></li>
<li><a id="org8fc7497"></a>Control signals<br />
<div class="outline-text-5" id="text-org8fc7497">
<p>
ctl<sub>rf</sub><sub>alu</sub>,  &#x2013; Input to register file is ALU output r (if 0, use m)
ctl<sub>rf</sub><sub>sd</sub>,   &#x2013; Use ir<sub>d</sub> as source a address (if 0, use ir<sub>sa</sub>)
ctl<sub>alu</sub><sub>a</sub>,   &#x2013; 4-bit alu operation code (see section on the ALU)
ctl<sub>alu</sub><sub>b</sub>,   &#x2013;   "
ctl<sub>alu</sub><sub>c</sub>,   &#x2013;   "
ctl<sub>alu</sub><sub>d</sub>,   &#x2013;   "
ctl<sub>ir</sub><sub>ld</sub>,   &#x2013; Load ir register (if 0, remain unchanged)
ctl<sub>pc</sub><sub>ld</sub>,   &#x2013; Load pc register (if 0, remain unchanged)
ctl<sub>pc</sub><sub>ad</sub>,   &#x2013; Input to pc is ad (if 0, r)
ctl<sub>adr</sub><sub>ld</sub>,  &#x2013; Load ad register (if 0, remain unchanged)
ctl<sub>adr</sub><sub>alu</sub>, &#x2013; Obtain ad input from alu (if 0, from memory data input)
ctl<sub>ma</sub><sub>pc</sub>,   &#x2013; Transmit pc on memory address bus (if 0, transmit addr)
ctl<sub>x</sub><sub>pc</sub>,    &#x2013; Transmit pc on x (if 0, transmit reg[sa])
ctl<sub>y</sub><sub>ad</sub>,    &#x2013; Transmit ad on y (if 0, transmit reg[sb])
ctl<sub>sto</sub>      &#x2013; Memory store (if 0, fetch)
</p>



<p>
The simulation driver produces voluminous output that lets you see
what is happening inside the circuit.  You can run the simulation two
ways: interactively with ghci, or as a batch process with ghc.
</p>

<p>
Interactive execution
<code>~~~~~~~~~~~~~~~~~~~</code>
</p>

<p>
While developing a circuit, it is easiest to use ghci.  This is
interactive and provides commands that are helpful for looking at
error messages, debugging, and performing quick experiments.  Enter
these commands ($ is the shell prompt, : is the ghci prompt).
</p>

<p>
$ ghci
:load ArrayMax
main
:q
</p>
</div>
</li>


<li><a id="org13fae11"></a>Interpreting the simulation output<br />
<div class="outline-text-5" id="text-org13fae11">
<p>
The M1 system contains a lot of components and signals, and its
simulation produces a large amount of output.  This section explains
what the simulation driver does, and how to interpret its output.
</p>

<p>
The M1 is a digital circuit, and its inputs and outputs are bit
signals.  The simulation would be unreadable if presented with 1s and
0s for input and output.  Therefore a simulation driver is used.  This
is defined in CPU<sub>Run.hs</sub>, and it converts the inputs (the hex string
constants in ProgArrayMax.hs) into input bit signals, and it converts
the output bit signals coming from the circuit into readable formatted
strings.  This document ignores the formatting details, and focuses
exclusively on how the digital circuit (M1.hs) runs the program.
</p>

<p>
M1 is a digital circuit, and its inputs and outputs are bit signals.
There are hundreds of bits for every clock cycle, and even a small
program will execute for hundreds of clock cycles.  The simulation
would be unreadable if all this data were represented with 1s and 0s.
Using hex notation helps, but massive hex data is still hard to read.
Therefore a simulation driver is used, which
</p>

<ul class="org-ul">
<li>converts the inputs (the machine language code written as hex string
constants) into input bit signals,</li>
<li>invokes the circuit simulator, and</li>

<li>converts the output bit signals produced by the circuit into
readable formatted strings.</li>
</ul>

<p>
We will use the program ArrayMax as a running example.  There is an
assembly language source program, ArrayMax.asm.txt.  This needs to be
translated to machine language ("assembled").  That can be done with
the Sigma16 application, which contains an assembler and emulator.
</p>

<p>
The simulation output first identifies itself:
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
System M1 simulation
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>

<p>
The system begins by using direct memory access to load the machine
language program into memory, starting at location 0.  The executable
(program followed by data) consists of 31 words.  To see this, note
that the last word in the executable (labelled max) has address 001e,
which is 30, and there are 31 locations from 0 through 30.
Alternatively, you can just count the hex constants in the machine
language.  Therefore the first 31 clock cycles are "stolen" by the DMA
controller in order to load the executable code into memory.
</p>

<p>
The system begins by using direct memory access to load the machine
language program into memory, starting at location 0.  The executable
(program followed by data) consists of 31 words.  To see this, note
that the last word in the executable (labelled max) has address 001e,
which is 30, and there are 31 locations from 0 through 30.
Alternatively, you can just count the hex constants in the machine
language.  Therefore the first 31 clock cycles are "stolen" by the DMA
controller in order to load the executable code into memory.
</p>

<p>
The output is divided into sections, one for each clock cycle.  The
first line of a section gives the cycle number, followed by a label
"Computer system inputs", followed by the values of four signals that
pertain to the entire system.  The first section (clock cycle 0) is
used by the DMA to store the first word of the executable ($1100) into
the first word of memory ($0000).  As the DMA is active, the dma
control signal is 1, and the address (dma<sub>a</sub>) and data (dma<sub>d</sub>) are set
to the corresponding values.  At the clock tick that ends cycle 0, the
memory will perform Mem[0] := 1100.
</p>

<p>
The output is divided into sections, one for each clock cycle.  The
first line of a section gives the cycle number, followed by a label
"Computer system inputs", followed by the values of four signals that
pertain to the entire system.  The first section (clock cycle 0) is
used by the DMA to store the first word of the executable ($1100) into
the first word of memory ($0000).  As the DMA is active, the dma
control signal is 1, and the address (dma<sub>a</sub>) and data (dma<sub>d</sub>) are set
to the corresponding values.  At the clock tick that ends cycle 0, the
memory will perform Mem[0] := 1100.
</p>


<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>
<ol class="org-ol">
<li>Computer system inputs
reset=0 dma=1 dma<sub>a</sub>=0000 dma<sub>d</sub>=1100</li>
</ol>
<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
Clock cycle 0
Computer system inputs
         reset=0 dma=1 dma<sub>a</sub>=0000 dma<sub>d</sub>=f100
ctl<sub>start</sub> = 0
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>

<p>
During Cycle 0, the system is using DMA to load the first word of the
machine code into memory at address 0.  This process &#x2014; placing
initial data into the memory &#x2014; is called bootstrapping.  The value
of the first word is f100 and it goes into address 0.  Therefore the
system sets these signals: reset=0 (don't start the processor yet);
dma=1 (place a word of input into memory), dma<sub>a</sub>=0000 (the address to
put the word is 0000), and dma<sub>d</sub>=f100 (the value of the data).  The
processor isn't running and not ready to start, so ctl<sub>start</sub>=0.  These
signals are set during cycle 0, and the state change they request will
occur at the next clock tick, which ends cycle 0 and begins cycle 1.
The remainder of the simulation output for Cycle 0 contains nothing of
interest, as the processor is idle.
</p>

<p>
In Cycle 1, the next word of the machine language (checking the
machine language code, you'll see this is 0001) is loaded into the
next memory location (0001), so the driver sets the following system
inputs:
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
Clock cycle 1
Computer system inputs
         reset=0 dma=1 dma<sub>a</sub>=0001 dma<sub>d</sub>=0001
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>

<p>
The simulation driver continues to load the machine language into
memory one word at a time.  The last word, 0019, is stored at location
001e at the tick ending Cycle 30.
</p>


<p>
The remainder of the section for Cycle 0 contains nothing of interest,
as the processor is idle.  In Cycle 1, the next word of the machine
language (in ArrayMax you'll see this is 0018) is loaded into the next
memory location (0001), so the driver sets the following system
inputs:
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
         reset=0 dma=1 dma<sub>a</sub>=0001 dma<sub>d</sub>=0018
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
Clock cycle 30
Computer system inputs
         reset=0 dma=1 dma<sub>a</sub>=001e dma<sub>d</sub>=0019
ctl<sub>start</sub> = 0
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>

<p>
At this point, the system as completed the bootstrapping input, and
the computer's memory contains the executable program with its data.
</p>

<p>
In Cycle 31, the m1 system starts the control algorithm by asserting
the main system reset signal.  This causes, in turn, the value of
ctl<sub>start</sub> to become 1.  The effect of this is that, at the next clock
tick, the control circuit will put a 1 in the state flip flop for the
first state in the control algorithm, which is st<sub>instr</sub><sub>fet</sub>.  Of
course, during cycle 31 the control is not running yet, so
st<sub>instr</sub><sub>fet</sub> is still 0.
</p>


<p>
The simulation driver continues this for 31 cycles, loading the
machine language into memory one word at a time.  The last word (0000,
the initial value of max) is stored at location 001e in Cycle 30.
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>
<ol class="org-ol">
<li>Computer system inputs
reset=0 dma=1 dma<sub>a</sub>=001e dma<sub>d</sub>=0000</li>
</ol>
<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>


<p>
At this point, the simulation driver has completed the input, and the
computer's memory contains the executable program with its data (all
31 words of it!).
</p>

<p>
In Cycle 31, the driver starts the control algorithm by asserting the
main system reset signal.  The effect of this is to put a 1 on a
signal that will, at the next clock tick, enter the state flip flop
for the first state in the control algorithm, st<sub>instr</sub><sub>fet</sub>.
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>
<ol class="org-ol">
<li>Computer system inputs
reset=1 dma=0 dma<sub>a</sub>=0000 dma<sub>d</sub>=0000</li>
</ol>
<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
Clock cycle 31
Computer system inputs
         reset=1 dma=0 dma<sub>a</sub>=0000 dma<sub>d</sub>=0000
ctl<sub>start</sub> = 1
</p>

<p>
Control state
   st<sub>instr</sub><sub>fet</sub> = 0  st<sub>dispatch</sub> = 0       st<sub>add</sub> = 0       st<sub>sub</sub> = 0
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>

<p>
The effect of the reset occurs at the clock tick between cycles 31 and
32, so it becomes visible when we examine the values of signals during
cycle 32.  Now reset and dma are both 0, and they will remain so for
the duration of the execution.  The Control state section shows that
the flip flop named st<sub>instr</sub><sub>fet</sub> contains 1, while all others contain
</p>
<ol class="org-ol">
<li></li>
</ol>


<p>
The effect of the reset occurs at the clock tick between cycles 31 and
32, so it becomes visible when we examine the values of signals during
cycle 32.  Now reset and dma are both 0, and they will remain so for
the duration of the execution.  The Control state section shows that
the flip flop named st<sub>instr</sub><sub>fet</sub> contains 1, while all others contain
</p>
<ol class="org-ol">
<li></li>
</ol>

<p>
The section "Control signals" shows the value of every control signal,
as generated by the control circuit.  It has set the following signals
to 1: ctl<sub>alu</sub><sub>a</sub>, ctl<sub>alu</sub><sub>b</sub>, ctl<sub>ir</sub><sub>ld</sub>, ctl<sub>pc</sub><sub>ld</sub>, ctl<sub>ma</sub><sub>pc</sub>,
ctl<sub>x</sub><sub>pc</sub>.  The others are all 0.
</p>

<p>
The simulation driver outputs the values of key signals each clock
cycle.  This is one of the basic functions of every simulation driver.
However, M1run goes beyond that: it contains algorithms that watch the
signal values, looking for important events, and when it detects one
it prints a special message surrounded by two lines of asterisks.
During Cycle 31 the driver detects a very important event, as it sees
that ctl<sub>start</sub>=1, and it prints the following:
</p>

<p>
<b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b>**</b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b>
Reset: control algorithm starting
<b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b><b>**</b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b></b>
</p>

<p>
As you scroll through the simulation output, messages like this will
appear from time to time.  A subtle but important point is that there
isn't any code that simply prints such a message when the simulation
reaches a certain point.  Instead, the driver observes and analyses
the signals coming from the circuit.
</p>

<p>
The section "Control signals" shows the value of every control signal,
as generated by the control circuit.  It has set the following signals
to 1: ctl<sub>alu</sub><sub>a</sub>, ctl<sub>alu</sub><sub>b</sub>, ctl<sub>ir</sub><sub>ld</sub>, ctl<sub>pc</sub><sub>ld</sub>, ctl<sub>ma</sub><sub>pc</sub>,
ctl<sub>x</sub><sub>pc</sub>.  The others are all 0.
</p>

<p>
First let's look at how the control signals are generated; then we
consider what they mean and what effect they have on the datapath.
</p>

<p>
First let's look at how the control signals are generated; then we
consider what they mean and what effect they have on the datapath.
</p>


<p>
Each control signal is generated by an or gate that or's the flip
flops for the states in which that signal is asserted.  In Control.hs,
you can see that the or gates for these signals that are 1 in Clock
Cycle 32 include st<sub>instr</sub><sub>fet</sub> among their inputs.  For example, here
is the definition of the signal ctl<sub>alu</sub><sub>a</sub>:
</p>

<p>
ctl<sub>alu</sub><sub>a</sub>   = orw [st<sub>instr</sub><sub>fet,st</sub><sub>load0,st</sub><sub>store0,st</sub><sub>lea0</sub>,
                   st<sub>cmpeq,st</sub><sub>cmplt,st</sub><sub>cmpgt,st</sub><sub>jumpf0,st</sub><sub>jal0</sub>]
</p>

<p>
All of the control signals are generated by an or gate that or's the
flip flops for the states in which that signal is asserted.  In M1.hs,
you can see that the or gates for these signals include st<sub>instr</sub><sub>fet</sub>
among their inputs.  For example, here is the definition of the signal
ctl<sub>alu</sub><sub>a</sub>:
</p>

<p>
ctl<sub>alu</sub><sub>a</sub>   = any1 [st<sub>instr</sub><sub>fet,st</sub><sub>load0,st</sub><sub>ldval0,st</sub><sub>neg,st</sub><sub>cmpeq</sub>,
                     st<sub>cmplt,st</sub><sub>cmpgt,st</sub><sub>jumpf0</sub>]
</p>

<p>
The orw building block computes the logical or of the word; since
st<sub>instr</sub><sub>fet</sub> is 1, the output of orw is 1 and ctl<sub>alu</sub><sub>a</sub> has the value
</p>
<ol class="org-ol">
<li>The same holds for ctl<sub>alu</sub><sub>b</sub>, ctl<sub>ir</sub><sub>ld</sub>, ctl<sub>pc</sub><sub>ld</sub>, ctl<sub>ma</sub><sub>pc</sub>, and</li>
</ol>
<p>
ctl<sub>x</sub><sub>pc</sub>.  All of the other signals do not have st<sub>instr</sub><sub>fet</sub> among the
inputs to their any1 circuit, so those signals are 0.
</p>


<p>
The any1 building block computes the logical or of the word; since
st<sub>instr</sub><sub>fet</sub> is 1, the output of any1 is 1 and ctl<sub>alu</sub><sub>a</sub> has the value
</p>
<ol class="org-ol">
<li>The same holds for ctl<sub>alu</sub><sub>b</sub>, ctl<sub>ir</sub><sub>ld</sub>, ctl<sub>pc</sub><sub>ld</sub>, ctl<sub>ma</sub><sub>pc</sub>, and</li>
</ol>
<p>
ctl<sub>x</sub><sub>pc</sub>.  All of the other signals do not have st<sub>instr</sub><sub>fet</sub> among the
inputs to their any1 circuit, so those signals are 0.
</p>

<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
Clock cycle 32
Computer system inputs
         reset=0 dma=0 dma<sub>a</sub>=0000 dma<sub>d</sub>=0000
ctl<sub>start</sub> = 0
</p>

<p>
Control state
   st<sub>instr</sub><sub>fet</sub> = 1  st<sub>dispatch</sub> = 0       st<sub>add</sub> = 0       st<sub>sub</sub> = 0
        st<sub>mul0</sub> = 0     st<sub>cmplt</sub> = 0     st<sub>cmpeq</sub> = 0     st<sub>cmpgt</sub> = 0
       st<sub>trap0</sub> = 0      st<sub>lea0</sub> = 0      st<sub>lea1</sub> = 0     st<sub>load0</sub> = 0
       st<sub>load1</sub> = 0     st<sub>load2</sub> = 0    st<sub>store0</sub> = 0    st<sub>store1</sub> = 0
      st<sub>store2</sub> = 0     st<sub>jump0</sub> = 0     st<sub>jump1</sub> = 0    st<sub>jumpf0</sub> = 0
      st<sub>jumpf1</sub> = 0    st<sub>jumpt0</sub> = 0    st<sub>jumpt1</sub> = 0      st<sub>jal0</sub> = 0
        st<sub>jal1</sub> = 0
</p>

<p>
Control signals
    ctl<sub>alu</sub><sub>a</sub>   = 1  ctl<sub>alu</sub><sub>b</sub>   = 1  ctl<sub>alu</sub><sub>c</sub>   = 0  ctl<sub>alu</sub><sub>d</sub>   = 0
    ctl<sub>x</sub><sub>pc</sub>    = 1  ctl<sub>y</sub><sub>ad</sub>    = 0  ctl<sub>rf</sub><sub>ld</sub>   = 0  ctl<sub>rf</sub><sub>pc</sub>   = 0
    ctl<sub>rf</sub><sub>alu</sub>  = 0  ctl<sub>rf</sub><sub>sd</sub>   = 0  ctl<sub>ir</sub><sub>ld</sub>   = 1  ctl<sub>pc</sub><sub>ld</sub>   = 1
    ctl<sub>ad</sub><sub>ld</sub>   = 0  ctl<sub>ad</sub><sub>alu</sub>  = 0  ctl<sub>ma</sub><sub>pc</sub>   = 1  ctl<sub>sto</sub>     = 0
</p>

<p>
Datapath
    ir = 0000  pc = 0000  ad = 0000   a = 0000   b = 0000   r = 0001
     x = 0000   y = 0000   p = f100  ma = 0000  md = 0000 cnd = 0
</p>

<p>
Memory
   ctl<sub>sto</sub> = 0      m<sub>sto</sub> = 0
     m<sub>addr</sub> = 0000  m<sub>real</sub><sub>addr</sub> = 0000  m<sub>data</sub> = 0000  m<sub>out</sub> =f100
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>


<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>
<ol class="org-ol">
<li><p>
Computer system inputs
reset=0 dma=0 dma<sub>a</sub>=0000 dma<sub>d</sub>=0000
</p>

<p>
Control state
  st<sub>instr</sub><sub>fet</sub> = 1  st<sub>dispatch</sub> = 0       st<sub>nop</sub> = 0     st<sub>load0</sub> = 0
      st<sub>load1</sub> = 0     st<sub>load2</sub> = 0    st<sub>ldval0</sub> = 0    st<sub>ldval1</sub> = 0
        st<sub>add</sub> = 0       st<sub>sub</sub> = 0       st<sub>neg</sub> = 0      st<sub>mul0</sub> = 0
     st<sub>store0</sub> = 0    st<sub>store1</sub> = 0    st<sub>store2</sub> = 0     st<sub>cmpeq</sub> = 0
      st<sub>cmplt</sub> = 0     st<sub>cmpgt</sub> = 0    st<sub>jumpt0</sub> = 0    st<sub>jumpt1</sub> = 0
     st<sub>jumpt2</sub> = 0    st<sub>jumpf0</sub> = 0    st<sub>jumpf1</sub> = 0    st<sub>jumpf2</sub> = 0
      st<sub>jump0</sub> = 0     st<sub>jump1</sub> = 0     st<sub>trape</sub> = 0     st<sub>trapf</sub> = 0
</p>

<p>
Control signals
  ctl<sub>alu</sub><sub>a</sub>  = 1 ctl<sub>alu</sub><sub>b</sub>  = 1 ctl<sub>alu</sub><sub>c</sub>  = 0 ctl<sub>alu</sub><sub>d</sub>  = 0
  ctl<sub>rf</sub><sub>ld</sub>  = 0 ctl<sub>rf</sub><sub>alu</sub> = 0 ctl<sub>rf</sub><sub>sd</sub>  = 0 ctl<sub>ir</sub><sub>ld</sub>  = 1
  ctl<sub>pc</sub><sub>ld</sub>  = 1 ctl<sub>ad</sub><sub>ld</sub>  = 0 ctl<sub>ad</sub><sub>alu</sub> = 0 ctl<sub>ma</sub><sub>pc</sub>  = 1
  ctl<sub>x</sub><sub>pc</sub>   = 1 ctl<sub>y</sub><sub>ad</sub>   = 0 ctl<sub>sto</sub>    = 0
</p></li>
</ol>
<p>
&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;&#x2026;
</p>

<p>
Now that we have seen how the control signals are generated, we move
on to their meaning and effect.  The control algorithm (see M1.hs)
contains the following definition for this state:
</p>

<p>
st<sub>instr</sub><sub>fet</sub>:
  ir := mem[pc], pc++;
     {ctl<sub>ma</sub><sub>pc</sub>, ctl<sub>ir</sub><sub>ld</sub>, ctl<sub>x</sub><sub>pc</sub>, ctl<sub>alu</sub>=alu<sub>inc</sub>, ctl<sub>pc</sub><sub>ld</sub>}
</p>

<p>
The first line is just the name of the state.  The second line is a
comment describing the effect on the datapath, and the third line is
the set of control signals that are 1 during the clock cycle when the
machine is in this state.  (The keyword "assert" should be in front of
the list of signals, but was omitted here.)
</p>


<p>
Now that we have seen how the control signals are generated, we move
on to their meaning and effect.  The control algorithm (see M1.hs)
contains the following definition for this state:
</p>

<p>
st<sub>instr</sub><sub>fet</sub>:
  ir := mem[pc], pc++;
     {ctl<sub>ma</sub><sub>pc</sub>, ctl<sub>ir</sub><sub>ld</sub>, ctl<sub>x</sub><sub>pc</sub>, ctl<sub>alu</sub>=alu<sub>inc</sub>, ctl<sub>pc</sub><sub>ld</sub>}
</p>

<p>
The first line is just the name of the state.  The second line is a
comment describing the effect on the datapath, and the third line is
the set of control signals that are 1 during the clock cycle when the
machine is in this state.  (The keyword "assert" should be in front of
the list of signals, but was omitted here.)
</p>

<p>
There are two ways to understand what's going on here: you can look at
the datapath and see how the control signals cause it to perform the
actions described in the comment, and you can look at the entire
control algorithm and see how these actions contribute to the
execution of machine language programs.
</p>

<p>
There are two ways to understand what's going on here: you can look at
the datapath and see how the control signals cause it to perform the
actions described in the comment, and you can look at the entire
control algorithm and see how these actions contribute to the
execution of machine language programs.
</p>

<p>
A good way to proceed is to follow the control algorithm as it
executes the first instruction.  For each statement, check that the
control circuit has set the right state flip flop and is asserting the
right control signals.  Look at the register and processor signal
values provided by the simulation driver, and check that the datapath
is doing the right thing.
</p>


<p>
A good way to proceed is to follow the control algorithm as it
executes the first instruction.  For each statement, check that the
control circuit has set the right state flip flop and is asserting the
right control signals.  Look at the register and processor signal
values provided by the simulation driver, and check that the datapath
is doing the right thing.
</p>

<p>
It isn't feasible to follow a long simulation in complete detail.
That's why we use computers to perform simulations!  But there are a
lot of interesting points that arise deep into the simulation output.
For example, it's interesting to watch the control algorithm as it
executes a conditional jump, and the best way to study this is to
observe a conditional jump that actually jumps and another one that
does not.
</p>

<p>
It isn't feasible to follow a long simulation in complete detail.
That's why we use computers to perform simulations!  But there are a
lot of interesting points that arise deep into the simulation output.
For example, it's interesting to watch the control algorithm as it
executes a conditional jump, and the best way to study this is to
observe a conditional jump that actually jumps and another one that
does not.
</p>

<p>
You can locate a state in which the processor is about to execute a
certain type of instruction by scanning down the simulation output,
looking for a 1 in the corresponding state.  (A good way to do this is
to load the simulation output into a text editor, and to do a textual
search.)
</p>

<p>
You can locate a state in which the processor is about to execute a
certain type of instruction by scanning down the simulation output,
looking for a 1 in the corresponding state.  (A good way to do this is
to load the simulation output into a text editor, and to do a textual
search.)
</p>

<p>
For example, the findmax programs executes some jumpf instructions.
Scan through the output, looking for a point where st<sub>jumpf0</sub> = 1.
This occurs in cycles 55, 66, 80, 91, 107, 118, 132, 143, and 159.
Reading the control algorithm, we see that a decision is made base on
the first operand register the ir<sub>d</sub> register:
</p>

<p>
case reg[ir<sub>sa</sub>] = 0 of
  False:
    break
  True:
    st<sub>jumpf1</sub>:
      pc := reg[ir<sub>sa</sub>] + ad
         {ctl<sub>y</sub><sub>ad</sub>, ctl<sub>alu</sub><sub>abcd</sub>=0000, ctl<sub>pc</sub><sub>ld</sub>}
</p>


<p>
For example, the findmax programs executes some jumpf instructions.
Scan through the output, looking for a point where st<sub>jumpf0</sub> = 1.
This occurs in cycles 59, 65, 86, 92, 113, 119, 138, 144, and 163.
Reading the control algorithm, we see that a decision is made base on
the first operand register:
</p>

<p>
case reg[ir<sub>sa</sub>] = 0 of
  False:
    break
  True:
    st<sub>jumpf1</sub>:
      pc := reg[ir<sub>sa</sub>] + ad
         {ctl<sub>y</sub><sub>ad</sub>, ctl<sub>alu</sub><sub>abcd</sub>=0000, ctl<sub>pc</sub><sub>ld</sub>}
</p>

<p>
If the condition for jumping is False, the control algorithm is
finished with the instruction, and it continues on to st<sub>instr</sub><sub>fet</sub>
(this is the "break" in the pseudo-code comment).  However, if the
condition for jumping is True, the control algorithm enters state
st<sub>jumpf1</sub>, where it performs the jump by loading the pc register with
the jump target.
</p>



<p>
If the condition for jumping is False, the control algorithm is
finished with the instruction, and it continues on to st<sub>instr</sub><sub>fet</sub>
(this is the "break" in the pseudo-code comment).  However, if the
condition for jumping is True, the control algorithm enters state
st<sub>jumpf1</sub>, where it performs the jump by loading the pc register with
the jump target.
</p>

<p>
So let's look at the cycles where the machine is in state st<sub>jumpf0</sub>,
and find out which state it enters next.  This requires a bit of study
of the simulation output, and here is the result:
</p>

<p>
Cycle  Next cycle    Next state     Jumped?
<code>~~~</code>  <code>~~~~~~~~</code>    <code>~~~~~~~~</code>     <code>~~~~~</code>
  55       56       st<sub>instr</sub><sub>fet</sub>      no
  66       67       st<sub>jumpf1</sub>        yes
  80       81       st<sub>instr</sub><sub>fet</sub>      no
  91       92       st<sub>instr</sub><sub>fet</sub>      no
 107      108       st<sub>instr</sub><sub>fet</sub>      no
 118      119       st<sub>jumpf1</sub>        yes
 132      133       st<sub>instr</sub><sub>fet</sub>      no
 143      144       st<sub>instr</sub><sub>fet</sub>      no
 159      160       st<sub>instr</sub><sub>fet</sub>      no
</p>


<p>
So let's look at the cycles where the machine is in state st<sub>jumpf0</sub>,
and find out which state it enters next.  This requires a bit of study
of the simulation output, and here is the result:
</p>

<p>
Cycle  Next cycle    Next state     Jumped?
<code>~~~</code>  <code>~~~~~~~~</code>    <code>~~~~~~~~</code>     <code>~~~~~</code>
  59       60       st<sub>instr</sub><sub>fet</sub>      no
  65       66       st<sub>instr</sub><sub>fet</sub>      no
  86       87       st<sub>instr</sub><sub>fet</sub>      no
  92       93       st<sub>instr</sub><sub>fet</sub>      no
 113      114       st<sub>instr</sub><sub>fet</sub>      no
 119      120       st<sub>jumpf1</sub>        yes
 138      139       st<sub>instr</sub><sub>fet</sub>      no
 144      145       st<sub>jumpf1</sub>        yes
 163      164       st<sub>jumpf1</sub>        yes
</p>

<p>
So we have found several examples where the jump is taken, and several
where it is not.  It's worth picking one example of each case, and
studying it in detail.
</p>

<p>
An especially valuable experiment is to pick some key points in the
simulation so that you can follow the execution of the machine
language program, as it searches through the array looking for the
maximal element.
</p>

<p>
So we have found several examples where the jump is taken, and several
where it is not.  It's worth picking one example of each case, and
studying it in detail.
</p>

<p>
An especially valuable experiment is to pick some key points in the
simulation so that you can follow the execution of the machine
language program, as it searches through the array looking for the
maximal element.
</p>





<p>
Word notation
<code>~~~~~~~~~~~</code>
</p>

<p>
In a word, bit indices are 0, 1, &#x2026;, n-1 where bit 0 is most
significant.
</p>

<p>
w!!i                   i'th bit of word w
field w i j            bits i..i+j-1 of word w
</p>


<p>
Constant signals
<code>~~~~~~~~~~~~~~</code>
</p>

<p>
zero                   signal with constant 0 value
one                    signal with constant 1 value
</p>

<p>
Logic gates
<code>~~~~~~~~~</code>
</p>

<p>
inv                    inverter
and2, and3, and4       and gate with 2, 3, 4 inputs
nand2, nand3, nand4    and gate with 2, 3, 4 inputs
or2, or3, or4          or gate with 2, 3, 4 inputs
nor2, nor3, nor4       nor gate with 2, 3, 4 inputs
xor2, xor3, xor4       xor gate with 2, 3, 4 inputs
</p>


<p>
Flip flops
<code>~~~~~~~~</code>
</p>

<p>
dff                    delay flip flop
</p>


<p>
Building block circuits
<code>~~~~~~~~~~~~~~~~~~~~~</code>
</p>

<p>
fanout n b             connect bit b to n outputs, forming a word
boolword n b           form an n-bit word, lsb = b, other bits = 0
any1                   or the bits in a word: result is 1 if any 1 bit
winv w                 invert the bits in a word
mux1w                  use 1-bit control to select between two words
bitslice2 x y          convert pair of words to word of pairs
mux2                   use two bit control to select one of four inputs
</p>


<p>
Registers
<code>~~~~~~~</code>
</p>

<p>
reg n ld x                 n-bit register with load control ld, data input x
regfile n k ld d sa sb x   register file with 2<sup>k</sup> registers, each n-bits wide,
                           load control ld, destination address d,
                           reads out registers sa and sb, data input x
</p>
</div>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org65df414" class="outline-2">
<h2 id="org65df414">Installation</h2>
<div class="outline-text-2" id="text-org65df414">
</div>
<div id="outline-container-org0796ebe" class="outline-3">
<h3 id="org0796ebe">The processor circuit</h3>
</div>

<div id="outline-container-org9cd719e" class="outline-3">
<h3 id="org9cd719e">Installation</h3>
<div class="outline-text-3" id="text-org9cd719e">
<p>
You can run most of Sigma16 in a web browser &#x2013; there's nothing to
download, nothing to install.  Just click the link in the Sigma16 Home
Page and it's running.
</p>
</div>

<div id="outline-container-org76e79f7" class="outline-4">
<h4 id="org76e79f7">The easy way: running in browser with no installation</h4>
<div class="outline-text-4" id="text-org76e79f7">
<p>
To run the main app (the Integrated Development Environment, or IDE)
visit the [Sigma16 home page](<a href="https://jtod.github.io/home/Sigma16/">https://jtod.github.io/home/Sigma16/</a>) in
your browser and click on the link to launch the app.  It will run in
your browser; you don't have to install anything.
</p>

<p>
The Home page also contains links to the source code, related
documents, and further information about the project.  Its a good idea
to bookmark the Home Page, rather than a specific release: that way
you'll always get the latest version.
</p>

<p>
The IDE runs in a web browser.  The browser needs to be up to date;
the app won't work in very old versions of browsers.  Just keep your
browser updated (you need to do that anyway) and it should work.
</p>
</div>
</div>

<div id="outline-container-orgb21f51f" class="outline-4">
<h4 id="orgb21f51f">Features that require software installation</h4>
<div class="outline-text-4" id="text-orgb21f51f">
<p>
Sigma16 also contains some advanced features that use the command line
in a shell.  These features include text commands for assembling and
linking programs, and for running the circuit simulator.  These
features require some software installation.  In addition, building
Sigma16 from soure requires some additional software that must be
installe.  All of the software required for Hydra is free and open
source, and all of it runs on Windows, Macintosh, and Gnu/Linux.
</p>
</div>
</div>

<div id="outline-container-org837a85c" class="outline-4">
<h4 id="org837a85c">node: JavaScript</h4>
</div>
<div id="outline-container-orga9eec13" class="outline-4">
<h4 id="orga9eec13">npm: JavaScript packages</h4>
</div>
<div id="outline-container-org89badab" class="outline-4">
<h4 id="org89badab">ghc: Haskell</h4>
<div class="outline-text-4" id="text-org89badab">
<p>
Install the ghc Haskell compiler, which you can download from the
Haskell web page <a href="https://www.haskell.org/">https://www.haskell.org/</a>.  A standard
installation will also install the packaging tool <code>cabal</code>.  Check that
the installation succeeded with <code>ghc --version</code> and <code>cabal --version</code>.
</p>

<pre class="example" id="org75345f2">
$ ghc --version
The Glorious Glasgow Haskell Compilation System, version 9.0.1
$ cabal --version
cabal-install version 3.4.0.0
compiled using version 3.4.0.0 of the Cabal library
</pre>
</div>
</div>


<div id="outline-container-org501b263" class="outline-4">
<h4 id="org501b263">cabal: Haskell packages</h4>
<div class="outline-text-4" id="text-org501b263">
<pre class="example" id="orgd6d17be">
cabal update
cabal install --lib ansi-terminal
</pre>
</div>
</div>

<div id="outline-container-orgbbaea4a" class="outline-4">
<h4 id="orgbbaea4a">Configuring the shell</h4>
<div class="outline-text-4" id="text-orgbbaea4a">
<p>
It's convenient to define an alias to the directory where you have the
example programs.  For example, in .bashrc:
</p>

<p>
export COREPROGS="../../examples/Core"
alias runcirc="runghc M1/Tools/Run"
</p>


<p>
Shell running bash
</p>

<p>
Add the following to your .bashrc
file, but replace <i>Users//yourlogin/Documents/path/to</i> with your own file
location.  In a bash shell running on cygwin, try /Users/yourlogin.
</p>

<pre class="example" id="orge9f198f">
SIGMA16=/Users/yourlogin/Documents/path/to/SigmaProject/Sigma16
export SIGMA16
alias helloworld="node ${SIGMA16}/app/helloworld.js"
</pre>

<p>
src/circuits contains a file .ghci that contains several commands
which are automatically executed with ghci is launched.  If .ghci is
missing, you can also enter those commands manually.  Here is the text
of .ghci:
</p>

<pre class="example" id="orga90f279">
:set -package mtl
:set -package parsec
:load M1/Tools/Run
</pre>
</div>
</div>

<div id="outline-container-org72808f2" class="outline-4">
<h4 id="org72808f2">Testing the installation</h4>
<div class="outline-text-4" id="text-org72808f2">
<pre class="example" id="orgb0a41a2">
$ node --version
v16.5.0
$ ghc --version
The Glorious Glasgow Haskell Compilation System, version 9.0.1
$ alias sigma16
alias sigma16='node PATH/TO/YOUR/INSTALLATION/Sigma16/src/cli/sigma16.mjs'
$ cd Sigma16/src/circuit
$ sigma16 assemble $COREPROGS/Simple/Add
$ ghci
:main SimpleAdd
:q
</pre>
</div>
</div>

<div id="outline-container-org8516090" class="outline-4">
<h4 id="org8516090">Running the circuit simulator</h4>
<div class="outline-text-4" id="text-org8516090">
<p>
&#x2013; Installation
</p>

<p>
&#x2013; Usage
&#x2013;   cd to src/circuits  &#x2013; must be in this directory
&#x2013;   ghci                &#x2013; start ghci and initialize using .ghci
&#x2013;   :main Simple/Add    &#x2013; run M1 circuit on examples/Core/Simple/Add.obj.txt
&#x2013;   :r                  &#x2013; reload, after you have changed a circuit source file
&#x2013;   :q                  &#x2013; quit ghci, return to shell
</p>

<p>
When ghci is launched it automatically executes the commands in .ghci:
</p>

<pre class="example" id="org3535eea">
:set -package mtl
:set -package parsec
:load M1/Tools/Run
</pre>
</div>
</div>

<div id="outline-container-org73afa37" class="outline-4">
<h4 id="org73afa37">Documentation</h4>
<div class="outline-text-4" id="text-org73afa37">
<ul class="org-ul">
<li>src/circuits/README.txt  &#x2013; how to run it</li>
<li>Sigma16 User Guide       &#x2013; the architecture and circuits</li>
<li>Hydra User Guide         &#x2013; the hardware description language.</li>
<li>ghc documentation:  <a href="https://downloads.haskell.org/ghc/latest/docs/html/users_guide/index.html">https://downloads.haskell.org/ghc/latest/docs/html/users_guide/index.html</a></li>
</ul>
</div>
</div>

<div id="outline-container-org5973177" class="outline-4">
<h4 id="org5973177">Building Sigma16</h4>
<div class="outline-text-4" id="text-org5973177">
<p>
The Web version of Sigma16 contains several files that need to be
built from source.  Of course, if you launch the app from the Sigma16
Home Page you don't need to worry about that: you get a fully-built
version.
</p>

<p>
Use emacs to build *.html from source *.org
</p>

<pre class="example" id="org0d8b512">
^C ^E h h
</pre>

<pre class="example" id="org257b572">
$ npm install -g wabt
$ wat2wasm emcore.wat --enable-threads
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-about-sigma16" class="outline-2">
<h2 id="sec-about-sigma16">About Sigma16</h2>
<div class="outline-text-2" id="text-sec-about-sigma16">
</div>

<div id="outline-container-org92828ad" class="outline-3">
<h3 id="org92828ad">Copyright and license</h3>
<div class="outline-text-3" id="text-org92828ad">
<p>
The architecture, software tools, and documentation were designed,
implemented, and written by John O'Donnell.  Contact email:
john.t.odonnell9@gmail.com
</p>

<p>
Copyright (C) 2020, 2021 John T. O'Donnell
</p>

<p>
License: GNU GPL Version 3 or later.  The full text of the GPL-3
license is given below.
</p>

<p>
Sigma16 is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your
option) any later version.  Sigma16 is distributed in the hope that it
will be useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See
the GNU General Public License for more details.  You should have
received a copy of the GNU General Public License along with Sigma16.
If not, see <a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.
</p>
</div>
</div>

<div id="outline-container-org6dbb04b" class="outline-3">
<h3 id="org6dbb04b">In case of problems</h3>
<div class="outline-text-3" id="text-org6dbb04b">
<p>
If you encounter a problem with the app, please file a bug report.  It
is essential in a bug report (for any software, not just Sigma16) to
provide as much as possible of the following information.
</p>

<ul class="org-ul">
<li>State what version of the software you’re running.  This is visible
in the browser's URL field.  Also, make sure you’re running the
latest version!</li>

<li>State what browser and operating system you're using.  There are
some incompatibilities between Chrome, Firefox, Edge, and Safari, as
well as differences between operating systems.</li>

<li>Describe what the problem was.</li>

<li>Provide the source code of the assembly language program you’re
running.</li>

<li>If possible, provide some photos or screen shots showing the app at
the point where the problem arose.  Smartphone photos are fine.  Try
to show the register display, the assembly listing display, and the
version number (this is visible in the browser's display of the URL,
and it's also visible at the top of the User Guide).</li>
</ul>
</div>
</div>

<div id="outline-container-org96e90c3" class="outline-3">
<h3 id="org96e90c3">Typesetting notes</h3>
<div class="outline-text-3" id="text-org96e90c3">
</div>
<div id="outline-container-org9469e25" class="outline-4">
<h4 id="org9469e25">svg</h4>
<div class="outline-text-4" id="text-org9469e25">
<p>
There are several ways to include an svg image.
</p>

<h3> silly heading</h3>
</div>
</div>

<div id="outline-container-org5615f4e" class="outline-4">
<h4 id="org5615f4e">svg the best way: inline include</h4>
<div class="outline-text-4" id="text-org5615f4e">
<p>
The idea is to inline the contents of the svg figure, but to obtain
the text from a separate svg file.
</p>

<svg width="160" height="40" 
  xmlns="http://www.w3.org/2000/svg">

  <title>RRR format</title>
  <desc>Fields of RRR instruction format</desc>


  <g style="font-size: 14pt; font-family: sans-serif">
  
    <rect x="0" y="0" width="160" height="40"
          style="fill: none; stroke: black"/>
    <line x1="40" y1="0" x2="40" y2="40" style="stroke: black"/>
    <line x1="80" y1="0" x2="80" y2="40" style="stroke: black"/>
    <line x1="120" y1="0" x2="120" y2="40" style="stroke: black"/>

    <text x="20" y="25" style="text-anchor: middle">op</text>
    <text x="60" y="25" style="text-anchor: middle">d</text>
    <text x="100" y="25" style="text-anchor: middle">a</text>
    <text x="140" y="25" style="text-anchor: middle">b</text>

  </g>
</svg>

<p>
That was an included file.
</p>
</div>
</div>

<div id="outline-container-org15dc8c2" class="outline-4">
<h4 id="org15dc8c2">Raw inline svg</h4>
<div class="outline-text-4" id="text-org15dc8c2">
<p>
Hello there this is it 
</p>

<div>
<svg width="160" height="40" >

  <title>RRR format</title>
  <desc>Fields of RRR instruction format</desc>


  <g style="font-size: 14pt; font-family: sans-serif">
  
    <rect x="0" y="0" width="160" height="40"
          style="fill: none; stroke: black"/>
    <line x1="40" y1="0" x2="40" y2="40" style="stroke: black"/>
    <line x1="80" y1="0" x2="80" y2="40" style="stroke: black"/>
    <line x1="120" y1="0" x2="120" y2="40" style="stroke: black"/>

    <text x="20" y="25" style="text-anchor: middle">op</text>
    <text x="60" y="25" style="text-anchor: middle">d</text>
    <text x="100" y="25" style="text-anchor: middle">a</text>
    <text x="140" y="25" style="text-anchor: middle">b</text>

  </g>
</svg>
</div>
<p>
That was it!
</p>
</div>
</div>

<div id="outline-container-orgc39d1fd" class="outline-4">
<h4 id="orgc39d1fd">svg via org mode external link</h4>
<div class="outline-text-4" id="text-orgc39d1fd">
<p>
Here is the source code in the org file
</p>
<pre class="example" id="orgdcba4b5">
[[file:svg/RRRformat.svg]]
</pre>

<p>
It's important not to use a description in the external link; i.e. the
link ends with two consecutive right brackets.  (If a description is
given, then org will put in a button to click to get the image, but
what I want is for the image to appear inline.)
</p>

<p>
That code appears here:
<object type="image/svg+xml" data="svg/RRRformat.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
Org produces the following code in the html export:
</p>

<pre class="example" id="org00a495f">
&lt;p&gt;
That code appears here:
&lt;object type="image/svg+xml" data="svg/RRRformat.svg" class="org-svg"&gt;
Sorry, your browser does not support SVG.&lt;/object&gt;
Org produces the following code in the html export:
&lt;/p&gt;
</pre>
</div>
</div>

<div id="outline-container-org9ddb007" class="outline-4">
<h4 id="org9ddb007">Using raw html to include image</h4>
<div class="outline-text-4" id="text-org9ddb007">
<p>
An alternative is to use raw html to include the image:
Here is the source code in the org file
</p>

<pre class="example" id="org06d4e9b">
#+HTML: &lt;img src='svg/RRRformat.svg'/&gt;
</pre>
<p>
That code goes here:
</p>
<img src='svg/RRRformat.svg'/>
<p>
And this is  the code that org puts into the html export:
</p>

<pre class="example" id="orga646e10">
&lt;p&gt;
That code goes here:
&lt;/p&gt;
&lt;img src='svg/RRRformat.svg'/&gt;
&lt;p&gt;
And this is  the code that org puts into the html export:
</pre>
</div>
</div>

<div id="outline-container-org495e9ec" class="outline-4">
<h4 id="org495e9ec">Embedding an object</h4>
<div class="outline-text-4" id="text-org495e9ec">
<p>
<i>Embedding as an image.</i> Here is an external svg figure.  From
Eisenberg, J. David; Bellamy-Royds, Amelia. SVG Essentials: Producing
Scalable Vector Graphics with XML (p. 21). O'Reilly Media. Kindle
Edition.
</p>

<p>
The svg specifies xmlns but this external reference is a problem
</p>

<pre class="example" id="orgae57e4d">
xmlns="http://www.w3.org/2000/svg"&gt;
</pre>

<p>
Here is the figure
</p>

<img src='svg/simplefig.svg'/>

<p>
That was an external svg figure
</p>

<p>
<i>Embedding as an object.</i>  Here is the same file but embedded as an
object rather than an image.
</p>

<p>
The following generates an error when the app is loaded:
</p>

<pre class="example" id="org55fd9a3">
Error in event handler: TypeError: Cannot read property 'querySelectorAll' of null
    at d.resetClassificationForFrames (chrome-extension://fdjamakpfbbddfjaooikfcpapjohcfmg/content/contentScripts/kwift.CHROME.min.js:1:46879)
    at d.resetAllClassifications (chrome-extension://fdjamakpfbbddfjaooikfcpapjohcfmg/content/contentScripts/kwift.CHROME.min.js:1:46056)
    at j._classifyHandler (chrome-extension://fdjamakpfbbddfjaooikfcpapjohcfmg/content/contentScripts/kwift.CHROME.min.js:17:83684)
    at t.MessageHandler._onSendMessageListener (chrome-extension://fdjamakpfbbddfjaooikfcpapjohcfmg/content/contentScripts/kwift.CHROME.min.js:17:152024)
    at chrome-extension://fdjamakpfbbddfjaooikfcpapjohcfmg/content/contentScripts/kwift.CHROME.min.js:17:151660
</pre>

<p>
The problem is with importing the svg figure as an object.
</p>

<p>
xxx #+BEGIN<sub>EXPORT</sub> html
&lt;object data="svg/simplefig.svg" type="image/svg+xml"
title="simplefig"&gt;
&lt;/object&gt;
xxx #+END<sub>EXPORT</sub>
</p>

<p>
That is the end of the figure embedded as an object.
</p>
</div>
</div>

<div id="outline-container-org5943065" class="outline-4">
<h4 id="org5943065">Asides</h4>
<div class="outline-text-4" id="text-org5943065">
<p>
Here is an example of an AsideNote.
</p>

<div class='AsideNote'>
<p>
<b>Aside note.</b> This is some text surrounded by a box and with a soft
background color.  Since org puts a &lt;p&gt; tag around the contents of the
div, the css sets the top and bottom margins to 0em for div.AsideNote
&gt; p.
</p>
<asidepar>
<p>
To have a paragraph inside the AsideNote, use &lt;asidepar&gt;.
</p>
</div>
</div>
</div>

<div id="outline-container-org2f7460b" class="outline-4">
<h4 id="org2f7460b">Math in plain html</h4>
<div class="outline-text-4" id="text-org2f7460b">
<p>
From org documentation: The HTML export back-end transforms ‘&lt;’ and
‘&gt;’ to ‘&amp;lt;’ and ‘&amp;gt;’. To include raw HTML code in the Org file so
the HTML export back-end can insert that HTML code in the output, use
this inline syntax: ‘...’. For example: Here are some html
math symbols
</p>

<ul class="org-ul">
<li>&sum;</li>
<li>&sum;<sub>n = 0</sub><sup>&inf;</sup></li>
<li>&sum; <sub>i=0</sub> <sup>n-1</sup></li>
<li>&sum; <sub>0&le;i&lt;n</sub> (x<sub>i</sub> * 2 <sup>i</sup>)</li>
<li>2 &le; 3</li>
<li>4 &ge; 5</li>
<li><MATH>&int;_a_^b^{f(x)<over>1+x} dx</MATH></li>
</ul>
</div>
</div>

<div id="outline-container-orgf1b36e3" class="outline-4">
<h4 id="orgf1b36e3">Math mode</h4>
<div class="outline-text-4" id="text-orgf1b36e3">
<p>
There is a problem with using mathjax while rendering the user guide,
because of the cross domain limitations enforced by SigServer.
However, the following does not trigger mathjax:
</p>

<ul class="org-ul">
<li>\(x_i\)</li>
<li>\(x \leq y\)</li>
<li>\(x_i < y_i\)</li>
<li>$&sum;<sub>i=0</sub><sup>n-1</sup> {x<sub>i</sub> &times; 2<sup>i</sup>} $</li>
</ul>
</div>
</div>

<div id="outline-container-org85872d3" class="outline-4">
<h4 id="org85872d3">The best way: use tex2svg</h4>
<div class="outline-text-4" id="text-org85872d3">
<p>
The best approach is to use the power of TeX for describing math, and
the vector graphics of svg to render it.  This needs to be done
offline, and the raw svg is included in the html page.
</p>

<pre class="example" id="org7927953">
npm install --global mathjax-node
$ tex2svg '\sin^2{\theta} + \cos^2{\theta} = 1' &gt; identity.svg
</pre>

<p>
Here is a formula
</p>
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.132ex" height="2.843ex" style="vertical-align: -0.505ex;" viewBox="0 -1006.6 7806.6 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">sine squared theta plus cosine squared theta equals 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMAIN-73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z"></path>
<path stroke-width="1" id="E1-MJMAIN-69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"></path>
<path stroke-width="1" id="E1-MJMAIN-6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path>
<path stroke-width="1" id="E1-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path>
<path stroke-width="1" id="E1-MJMATHI-3B8" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path>
<path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path>
<path stroke-width="1" id="E1-MJMAIN-63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path>
<path stroke-width="1" id="E1-MJMAIN-6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z"></path>
<path stroke-width="1" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path>
<path stroke-width="1" id="E1-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMAIN-73"></use>
 <use xlink:href="#E1-MJMAIN-69" x="394" y="0"></use>
 <use xlink:href="#E1-MJMAIN-6E" x="673" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="1738" y="583"></use>
 <use xlink:href="#E1-MJMATHI-3B8" x="1850" y="0"></use>
 <use xlink:href="#E1-MJMAIN-2B" x="2541" y="0"></use>
<g transform="translate(3542,0)">
 <use xlink:href="#E1-MJMAIN-63"></use>
 <use xlink:href="#E1-MJMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-MJMAIN-73" x="945" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="1894" y="583"></use>
</g>
 <use xlink:href="#E1-MJMATHI-3B8" x="5502" y="0"></use>
 <use xlink:href="#E1-MJMAIN-3D" x="6249" y="0"></use>
 <use xlink:href="#E1-MJMAIN-31" x="7306" y="0"></use>
</g>
</svg>
<p>
which contains some math notation.  This looks good for display equations,
but not so much for inline notation.
</p>
</div>
</div>
</div>

<div id="outline-container-orgc5f1f74" class="outline-3">
<h3 id="orgc5f1f74">Release notes</h3>
<div class="outline-text-3" id="text-orgc5f1f74">
</div>
<div id="outline-container-orga12aa98" class="outline-4">
<h4 id="orga12aa98">Version 3.4.0</h4>
<div class="outline-text-4" id="text-orga12aa98">
<ul class="org-ul">
<li>Bit indexing is changed to "little end" style.  The least
significant bit has index 0, and the most significant bit has
index 15.</li>
<li>The architecture is organized into precisely defined subsets</li>
<li>A new 32 bit extension allows computations with a much larger
memory, while retainign full backward compatibility.  Programs using
the 16-bit architecture run without modification on the extended
32-bit architecture.</li>
</ul>
</div>
</div>
<div id="outline-container-orgd3efa44" class="outline-4">
<h4 id="orgd3efa44">Version 3.3.2, April 2021</h4>
<div class="outline-text-4" id="text-orgd3efa44">
<ul class="org-ul">
<li>There is no change in the architecture</li>
<li>The software is modified to enable it to continue working when a
planned change to web browsers occurs in May 2021.  The program runs
on a hosted web server that enables it to work fully with cross
origin isolation.</li>
</ul>
</div>
</div>
<div id="outline-container-org870010d" class="outline-4">
<h4 id="org870010d">Version 3.2.3, development from April 2021</h4>
</div>
<div id="outline-container-org212366e" class="outline-4">
<h4 id="org212366e">Version 3.2.2, March 2021</h4>
<div class="outline-text-4" id="text-org212366e">
<ul class="org-ul">
<li>A bug in breakpoints is fixed</li>
<li>In addition, there is a new way to specify breakpoings using trap</li>
<li>When the emulator stops, the memory display is correct; you no
longer need to refresh it</li>
</ul>
</div>
</div>

<div id="outline-container-org4f398ec" class="outline-4">
<h4 id="org4f398ec">Version 3.2.1, February 2021</h4>
<div class="outline-text-4" id="text-org4f398ec">
<p>
Version 3.2 brings several changes that will be visible to users of
previous versions of Sigma16:
</p>

<ul class="org-ul">
<li><i>cmplt, cmpeq, cmpgt are removed.</i> Instead, use the <code>cmp</code>
instruction, which sets the condition code (<code>R15</code>), and then use any
of the conditional jump instructions <code>jumplt</code>, <code>jumple</code>, <code>jumpeq</code>,
<code>jumpne</code>, <code>jumpge</code>, <code>jumpgt</code>.  (Rationale: There are more Booleans
in the condition code than just less-than, equal, and greater-than.
The new style accomodates all the conditions in a uniform manner,
but the old style does not.  Version 3.1 already supported <code>cmp</code> and
the conditional jumps.)  Here's an example:</li>
</ul>

<pre class="example" id="org2f3766e">
; Old style -- these instructions have been removed
     cmplt   R1,R2,R3      ; R1 := R2 &lt; R3
     jumpt   R1,loop[R0]   ; if R2 &lt; R3 then goto loop
; New style -- use the following instead
     cmp     R2,R3         ; compare R2 with R3
     jumplt  loop[R0]      ; if R2 &lt; R3 then goto loop
</pre>

<ul class="org-ul">
<li><i>jumpf is renamed to jumpz, and jumpt is renamed to jumpnz.</i> The new
names stand for <i>jump if zero</i> and <i>jump if not zero</i>.  Most old
programs will use <code>jumpf</code> or <code>jumpt</code> only after <code>cmplt</code>, <code>cmpeq</code>, or
<code>cmpgt</code>, but following <code>cmp</code> you should use one of the conditional
jumps listed above. (Rationale: The new names reflect more
accurately what the instructions actually do.  The decision about
whether to jump depends on whether the entire register contains 0;
it isn't a decision based on checking just a single bit.)</li>
</ul>

<p>
The following changes do not require modifying old programs; they just
relax the syntax rules so some programs would no longer give an error
message.
</p>

<ul class="org-ul">
<li><i>[R0] is optional.</i> In previous versions of Sigma16, every
displacement requires the index register to be stated explicitly,
even if it's <code>R0</code>: for example, <code>load R3,xyz[R0]</code>.  Now, the <code>[R0]</code>
can be omitted, although you can include it if you wish.  Thus <code>load
  R3,xyz</code> and <code>load R3,xyz[R0]</code> are equivalent.  (Rationale: The
reason for requiring <code>[R0]</code> in the past was to emphasise the
regularity of the instruction representation.  However, a primary
aim of the design of Sigma16 is to provide subsetting of the
architecture, which supports a spiral approach to learning computer
architecture.  Another aim is to provide a good platform for schools
or other students who will just learn a little of the system.
Removing the requirement for <code>[R0]</code> simplifies the language for a
beginner.  Furthermore, for an experienced expert programmer it's
more readable to omit the <code>[R0]</code> as this reduces the amount of
clutter in the code.)</li>

<li><i>Allow lower case "r" in register names.</i> In previous versions,
elements of the register file required an upper case <code>R</code>: for
example, <code>R8</code>.  Now you can write <code>r8</code> as well as <code>R8</code>, and both
names refer to the same register.  (Of course the same holds for the
rest of the register file.)  This is a trivial syntax issue.
There's no technical reason to prefer <code>r8</code> or <code>R8</code>; it's just a
matter of personal preference.  It may be easier to read <code>r8</code>
because the lower case <code>r</code> is shorter than the digits.  It's good
style to use either the <code>Rn</code> or <code>rn</code> form consistently, but the
assembly language doesn't enforce that. Labels are case sensitive but
registers are not.    Labels are case-sensitive,
so <code>xyz</code> and <code>XYZ</code> are distinct names, but registers are not labels,
and registers are not case sensitive.</li>
</ul>

<p>
There are some changes to the machine language that don't affect
assembly language programs.
</p>

<ul class="org-ul">
<li>Some of the opcodes have changed, so programs need to be
reassembled.</li>

<li>The word logic instructions <code>inv</code>, <code>and</code>, <code>or</code>, <code>xor</code> are now
pseudoinstructions that generate the <code>logicw</code> instruction.  The
assembly language syntax is the same as before; only the underlying
machine language representation is different</li>
</ul>

<p>
There are some new instructions and features, as well as some
instructions and features that have been in the architecture for some
time but weren't documented in the User Gude.  These won't affect
existing programs.
</p>
</div>
</div>
</div>


<div id="outline-container-org2e18f2e" class="outline-3">
<h3 id="org2e18f2e">Text of GPL3 License</h3>
<div class="outline-text-3" id="text-org2e18f2e">
<p>
GNU GENERAL PUBLIC LICENSE
Version 3, 29 June 2007
</p>

<p>
Copyright © 2007 Free Software Foundation, Inc. <a href="https://fsf.org/">https://fsf.org/</a>
</p>

<p>
Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.
</p>

<p>
Preamble
The GNU General Public License is a free, copyleft license for software and other kinds of works.
</p>

<p>
The licenses for most software and other practical works are designed to take away your freedom to share and change the works. By contrast, the GNU General Public License is intended to guarantee your freedom to share and change all versions of a program&#x2013;to make sure it remains free software for all its users. We, the Free Software Foundation, use the GNU General Public License for most of our software; it applies also to any other work released this way by its authors. You can apply it to your programs, too.
</p>

<p>
When we speak of free software, we are referring to freedom, not price. Our General Public Licenses are designed to make sure that you have the freedom to distribute copies of free software (and charge for them if you wish), that you receive source code or can get it if you want it, that you can change the software or use pieces of it in new free programs, and that you know you can do these things.
</p>

<p>
To protect your rights, we need to prevent others from denying you these rights or asking you to surrender the rights. Therefore, you have certain responsibilities if you distribute copies of the software, or if you modify it: responsibilities to respect the freedom of others.
</p>

<p>
For example, if you distribute copies of such a program, whether gratis or for a fee, you must pass on to the recipients the same freedoms that you received. You must make sure that they, too, receive or can get the source code. And you must show them these terms so they know their rights.
</p>

<p>
Developers that use the GNU GPL protect your rights with two steps: (1) assert copyright on the software, and (2) offer you this License giving you legal permission to copy, distribute and/or modify it.
</p>

<p>
For the developers' and authors' protection, the GPL clearly explains that there is no warranty for this free software. For both users' and authors' sake, the GPL requires that modified versions be marked as changed, so that their problems will not be attributed erroneously to authors of previous versions.
</p>

<p>
Some devices are designed to deny users access to install or run modified versions of the software inside them, although the manufacturer can do so. This is fundamentally incompatible with the aim of protecting users' freedom to change the software. The systematic pattern of such abuse occurs in the area of products for individuals to use, which is precisely where it is most unacceptable. Therefore, we have designed this version of the GPL to prohibit the practice for those products. If such problems arise substantially in other domains, we stand ready to extend this provision to those domains in future versions of the GPL, as needed to protect the freedom of users.
</p>

<p>
Finally, every program is threatened constantly by software patents. States should not allow patents to restrict development and use of software on general-purpose computers, but in those that do, we wish to avoid the special danger that patents applied to a free program could make it effectively proprietary. To prevent this, the GPL assures that patents cannot be used to render the program non-free.
</p>

<p>
The precise terms and conditions for copying, distribution and modification follow.
</p>

<p>
TERMS AND CONDITIONS
</p>
<ol class="org-ol">
<li>Definitions.</li>
</ol>
<p>
“This License” refers to version 3 of the GNU General Public License.
</p>

<p>
“Copyright” also means copyright-like laws that apply to other kinds of works, such as semiconductor masks.
</p>

<p>
“The Program” refers to any copyrightable work licensed under this License. Each licensee is addressed as “you”. “Licensees” and “recipients” may be individuals or organizations.
</p>

<p>
To “modify” a work means to copy from or adapt all or part of the work in a fashion requiring copyright permission, other than the making of an exact copy. The resulting work is called a “modified version” of the earlier work or a work “based on” the earlier work.
</p>

<p>
A “covered work” means either the unmodified Program or a work based on the Program.
</p>

<p>
To “propagate” a work means to do anything with it that, without permission, would make you directly or secondarily liable for infringement under applicable copyright law, except executing it on a computer or modifying a private copy. Propagation includes copying, distribution (with or without modification), making available to the public, and in some countries other activities as well.
</p>

<p>
To “convey” a work means any kind of propagation that enables other parties to make or receive copies. Mere interaction with a user through a computer network, with no transfer of a copy, is not conveying.
</p>

<p>
An interactive user interface displays “Appropriate Legal Notices” to the extent that it includes a convenient and prominently visible feature that (1) displays an appropriate copyright notice, and (2) tells the user that there is no warranty for the work (except to the extent that warranties are provided), that licensees may convey the work under this License, and how to view a copy of this License. If the interface presents a list of user commands or options, such as a menu, a prominent item in the list meets this criterion.
</p>

<ol class="org-ol">
<li>Source Code.</li>
</ol>
<p>
The “source code” for a work means the preferred form of the work for making modifications to it. “Object code” means any non-source form of a work.
</p>

<p>
A “Standard Interface” means an interface that either is an official standard defined by a recognized standards body, or, in the case of interfaces specified for a particular programming language, one that is widely used among developers working in that language.
</p>

<p>
The “System Libraries” of an executable work include anything, other than the work as a whole, that (a) is included in the normal form of packaging a Major Component, but which is not part of that Major Component, and (b) serves only to enable use of the work with that Major Component, or to implement a Standard Interface for which an implementation is available to the public in source code form. A “Major Component”, in this context, means a major essential component (kernel, window system, and so on) of the specific operating system (if any) on which the executable work runs, or a compiler used to produce the work, or an object code interpreter used to run it.
</p>

<p>
The “Corresponding Source” for a work in object code form means all the source code needed to generate, install, and (for an executable work) run the object code and to modify the work, including scripts to control those activities. However, it does not include the work's System Libraries, or general-purpose tools or generally available free programs which are used unmodified in performing those activities but which are not part of the work. For example, Corresponding Source includes interface definition files associated with source files for the work, and the source code for shared libraries and dynamically linked subprograms that the work is specifically designed to require, such as by intimate data communication or control flow between those subprograms and other parts of the work.
</p>

<p>
The Corresponding Source need not include anything that users can regenerate automatically from other parts of the Corresponding Source.
</p>

<p>
The Corresponding Source for a work in source code form is that same work.
</p>

<ol class="org-ol">
<li>Basic Permissions.</li>
</ol>
<p>
All rights granted under this License are granted for the term of copyright on the Program, and are irrevocable provided the stated conditions are met. This License explicitly affirms your unlimited permission to run the unmodified Program. The output from running a covered work is covered by this License only if the output, given its content, constitutes a covered work. This License acknowledges your rights of fair use or other equivalent, as provided by copyright law.
</p>

<p>
You may make, run and propagate covered works that you do not convey, without conditions so long as your license otherwise remains in force. You may convey covered works to others for the sole purpose of having them make modifications exclusively for you, or provide you with facilities for running those works, provided that you comply with the terms of this License in conveying all material for which you do not control copyright. Those thus making or running the covered works for you must do so exclusively on your behalf, under your direction and control, on terms that prohibit them from making any copies of your copyrighted material outside their relationship with you.
</p>

<p>
Conveying under any other circumstances is permitted solely under the conditions stated below. Sublicensing is not allowed; section 10 makes it unnecessary.
</p>

<ol class="org-ol">
<li>Protecting Users' Legal Rights From Anti-Circumvention Law.</li>
</ol>
<p>
No covered work shall be deemed part of an effective technological measure under any applicable law fulfilling obligations under article 11 of the WIPO copyright treaty adopted on 20 December 1996, or similar laws prohibiting or restricting circumvention of such measures.
</p>

<p>
When you convey a covered work, you waive any legal power to forbid circumvention of technological measures to the extent such circumvention is effected by exercising rights under this License with respect to the covered work, and you disclaim any intention to limit operation or modification of the work as a means of enforcing, against the work's users, your or third parties' legal rights to forbid circumvention of technological measures.
</p>

<ol class="org-ol">
<li>Conveying Verbatim Copies.</li>
</ol>
<p>
You may convey verbatim copies of the Program's source code as you receive it, in any medium, provided that you conspicuously and appropriately publish on each copy an appropriate copyright notice; keep intact all notices stating that this License and any non-permissive terms added in accord with section 7 apply to the code; keep intact all notices of the absence of any warranty; and give all recipients a copy of this License along with the Program.
</p>

<p>
You may charge any price or no price for each copy that you convey, and you may offer support or warranty protection for a fee.
</p>

<ol class="org-ol">
<li>Conveying Modified Source Versions.</li>
</ol>
<p>
You may convey a work based on the Program, or the modifications to produce it from the Program, in the form of source code under the terms of section 4, provided that you also meet all of these conditions:
</p>

<p>
a) The work must carry prominent notices stating that you modified it, and giving a relevant date.
b) The work must carry prominent notices stating that it is released under this License and any conditions added under section 7. This requirement modifies the requirement in section 4 to “keep intact all notices”.
c) You must license the entire work, as a whole, under this License to anyone who comes into possession of a copy. This License will therefore apply, along with any applicable section 7 additional terms, to the whole of the work, and all its parts, regardless of how they are packaged. This License gives no permission to license the work in any other way, but it does not invalidate such permission if you have separately received it.
d) If the work has interactive user interfaces, each must display Appropriate Legal Notices; however, if the Program has interactive interfaces that do not display Appropriate Legal Notices, your work need not make them do so.
A compilation of a covered work with other separate and independent works, which are not by their nature extensions of the covered work, and which are not combined with it such as to form a larger program, in or on a volume of a storage or distribution medium, is called an “aggregate” if the compilation and its resulting copyright are not used to limit the access or legal rights of the compilation's users beyond what the individual works permit. Inclusion of a covered work in an aggregate does not cause this License to apply to the other parts of the aggregate.
</p>

<ol class="org-ol">
<li>Conveying Non-Source Forms.</li>
</ol>
<p>
You may convey a covered work in object code form under the terms of sections 4 and 5, provided that you also convey the machine-readable Corresponding Source under the terms of this License, in one of these ways:
</p>

<p>
a) Convey the object code in, or embodied in, a physical product (including a physical distribution medium), accompanied by the Corresponding Source fixed on a durable physical medium customarily used for software interchange.
b) Convey the object code in, or embodied in, a physical product (including a physical distribution medium), accompanied by a written offer, valid for at least three years and valid for as long as you offer spare parts or customer support for that product model, to give anyone who possesses the object code either (1) a copy of the Corresponding Source for all the software in the product that is covered by this License, on a durable physical medium customarily used for software interchange, for a price no more than your reasonable cost of physically performing this conveying of source, or (2) access to copy the Corresponding Source from a network server at no charge.
c) Convey individual copies of the object code with a copy of the written offer to provide the Corresponding Source. This alternative is allowed only occasionally and noncommercially, and only if you received the object code with such an offer, in accord with subsection 6b.
d) Convey the object code by offering access from a designated place (gratis or for a charge), and offer equivalent access to the Corresponding Source in the same way through the same place at no further charge. You need not require recipients to copy the Corresponding Source along with the object code. If the place to copy the object code is a network server, the Corresponding Source may be on a different server (operated by you or a third party) that supports equivalent copying facilities, provided you maintain clear directions next to the object code saying where to find the Corresponding Source. Regardless of what server hosts the Corresponding Source, you remain obligated to ensure that it is available for as long as needed to satisfy these requirements.
e) Convey the object code using peer-to-peer transmission, provided you inform other peers where the object code and Corresponding Source of the work are being offered to the general public at no charge under subsection 6d.
A separable portion of the object code, whose source code is excluded from the Corresponding Source as a System Library, need not be included in conveying the object code work.
</p>

<p>
A “User Product” is either (1) a “consumer product”, which means any tangible personal property which is normally used for personal, family, or household purposes, or (2) anything designed or sold for incorporation into a dwelling. In determining whether a product is a consumer product, doubtful cases shall be resolved in favor of coverage. For a particular product received by a particular user, “normally used” refers to a typical or common use of that class of product, regardless of the status of the particular user or of the way in which the particular user actually uses, or expects or is expected to use, the product. A product is a consumer product regardless of whether the product has substantial commercial, industrial or non-consumer uses, unless such uses represent the only significant mode of use of the product.
</p>

<p>
“Installation Information” for a User Product means any methods, procedures, authorization keys, or other information required to install and execute modified versions of a covered work in that User Product from a modified version of its Corresponding Source. The information must suffice to ensure that the continued functioning of the modified object code is in no case prevented or interfered with solely because modification has been made.
</p>

<p>
If you convey an object code work under this section in, or with, or specifically for use in, a User Product, and the conveying occurs as part of a transaction in which the right of possession and use of the User Product is transferred to the recipient in perpetuity or for a fixed term (regardless of how the transaction is characterized), the Corresponding Source conveyed under this section must be accompanied by the Installation Information. But this requirement does not apply if neither you nor any third party retains the ability to install modified object code on the User Product (for example, the work has been installed in ROM).
</p>

<p>
The requirement to provide Installation Information does not include a requirement to continue to provide support service, warranty, or updates for a work that has been modified or installed by the recipient, or for the User Product in which it has been modified or installed. Access to a network may be denied when the modification itself materially and adversely affects the operation of the network or violates the rules and protocols for communication across the network.
</p>

<p>
Corresponding Source conveyed, and Installation Information provided, in accord with this section must be in a format that is publicly documented (and with an implementation available to the public in source code form), and must require no special password or key for unpacking, reading or copying.
</p>

<ol class="org-ol">
<li>Additional Terms.</li>
</ol>
<p>
“Additional permissions” are terms that supplement the terms of this License by making exceptions from one or more of its conditions. Additional permissions that are applicable to the entire Program shall be treated as though they were included in this License, to the extent that they are valid under applicable law. If additional permissions apply only to part of the Program, that part may be used separately under those permissions, but the entire Program remains governed by this License without regard to the additional permissions.
</p>

<p>
When you convey a copy of a covered work, you may at your option remove any additional permissions from that copy, or from any part of it. (Additional permissions may be written to require their own removal in certain cases when you modify the work.) You may place additional permissions on material, added by you to a covered work, for which you have or can give appropriate copyright permission.
</p>

<p>
Notwithstanding any other provision of this License, for material you add to a covered work, you may (if authorized by the copyright holders of that material) supplement the terms of this License with terms:
</p>

<p>
a) Disclaiming warranty or limiting liability differently from the terms of sections 15 and 16 of this License; or
b) Requiring preservation of specified reasonable legal notices or author attributions in that material or in the Appropriate Legal Notices displayed by works containing it; or
c) Prohibiting misrepresentation of the origin of that material, or requiring that modified versions of such material be marked in reasonable ways as different from the original version; or
d) Limiting the use for publicity purposes of names of licensors or authors of the material; or
e) Declining to grant rights under trademark law for use of some trade names, trademarks, or service marks; or
f) Requiring indemnification of licensors and authors of that material by anyone who conveys the material (or modified versions of it) with contractual assumptions of liability to the recipient, for any liability that these contractual assumptions directly impose on those licensors and authors.
All other non-permissive additional terms are considered “further restrictions” within the meaning of section 10. If the Program as you received it, or any part of it, contains a notice stating that it is governed by this License along with a term that is a further restriction, you may remove that term. If a license document contains a further restriction but permits relicensing or conveying under this License, you may add to a covered work material governed by the terms of that license document, provided that the further restriction does not survive such relicensing or conveying.
</p>

<p>
If you add terms to a covered work in accord with this section, you must place, in the relevant source files, a statement of the additional terms that apply to those files, or a notice indicating where to find the applicable terms.
</p>

<p>
Additional terms, permissive or non-permissive, may be stated in the form of a separately written license, or stated as exceptions; the above requirements apply either way.
</p>

<ol class="org-ol">
<li>Termination.</li>
</ol>
<p>
You may not propagate or modify a covered work except as expressly provided under this License. Any attempt otherwise to propagate or modify it is void, and will automatically terminate your rights under this License (including any patent licenses granted under the third paragraph of section 11).
</p>

<p>
However, if you cease all violation of this License, then your license from a particular copyright holder is reinstated (a) provisionally, unless and until the copyright holder explicitly and finally terminates your license, and (b) permanently, if the copyright holder fails to notify you of the violation by some reasonable means prior to 60 days after the cessation.
</p>

<p>
Moreover, your license from a particular copyright holder is reinstated permanently if the copyright holder notifies you of the violation by some reasonable means, this is the first time you have received notice of violation of this License (for any work) from that copyright holder, and you cure the violation prior to 30 days after your receipt of the notice.
</p>

<p>
Termination of your rights under this section does not terminate the licenses of parties who have received copies or rights from you under this License. If your rights have been terminated and not permanently reinstated, you do not qualify to receive new licenses for the same material under section 10.
</p>

<ol class="org-ol">
<li>Acceptance Not Required for Having Copies.</li>
</ol>
<p>
You are not required to accept this License in order to receive or run a copy of the Program. Ancillary propagation of a covered work occurring solely as a consequence of using peer-to-peer transmission to receive a copy likewise does not require acceptance. However, nothing other than this License grants you permission to propagate or modify any covered work. These actions infringe copyright if you do not accept this License. Therefore, by modifying or propagating a covered work, you indicate your acceptance of this License to do so.
</p>

<ol class="org-ol">
<li>Automatic Licensing of Downstream Recipients.</li>
</ol>
<p>
Each time you convey a covered work, the recipient automatically receives a license from the original licensors, to run, modify and propagate that work, subject to this License. You are not responsible for enforcing compliance by third parties with this License.
</p>

<p>
An “entity transaction” is a transaction transferring control of an organization, or substantially all assets of one, or subdividing an organization, or merging organizations. If propagation of a covered work results from an entity transaction, each party to that transaction who receives a copy of the work also receives whatever licenses to the work the party's predecessor in interest had or could give under the previous paragraph, plus a right to possession of the Corresponding Source of the work from the predecessor in interest, if the predecessor has it or can get it with reasonable efforts.
</p>

<p>
You may not impose any further restrictions on the exercise of the rights granted or affirmed under this License. For example, you may not impose a license fee, royalty, or other charge for exercise of rights granted under this License, and you may not initiate litigation (including a cross-claim or counterclaim in a lawsuit) alleging that any patent claim is infringed by making, using, selling, offering for sale, or importing the Program or any portion of it.
</p>

<ol class="org-ol">
<li>Patents.</li>
</ol>
<p>
A “contributor” is a copyright holder who authorizes use under this License of the Program or a work on which the Program is based. The work thus licensed is called the contributor's “contributor version”.
</p>

<p>
A contributor's “essential patent claims” are all patent claims owned or controlled by the contributor, whether already acquired or hereafter acquired, that would be infringed by some manner, permitted by this License, of making, using, or selling its contributor version, but do not include claims that would be infringed only as a consequence of further modification of the contributor version. For purposes of this definition, “control” includes the right to grant patent sublicenses in a manner consistent with the requirements of this License.
</p>

<p>
Each contributor grants you a non-exclusive, worldwide, royalty-free patent license under the contributor's essential patent claims, to make, use, sell, offer for sale, import and otherwise run, modify and propagate the contents of its contributor version.
</p>

<p>
In the following three paragraphs, a “patent license” is any express agreement or commitment, however denominated, not to enforce a patent (such as an express permission to practice a patent or covenant not to sue for patent infringement). To “grant” such a patent license to a party means to make such an agreement or commitment not to enforce a patent against the party.
</p>

<p>
If you convey a covered work, knowingly relying on a patent license, and the Corresponding Source of the work is not available for anyone to copy, free of charge and under the terms of this License, through a publicly available network server or other readily accessible means, then you must either (1) cause the Corresponding Source to be so available, or (2) arrange to deprive yourself of the benefit of the patent license for this particular work, or (3) arrange, in a manner consistent with the requirements of this License, to extend the patent license to downstream recipients. “Knowingly relying” means you have actual knowledge that, but for the patent license, your conveying the covered work in a country, or your recipient's use of the covered work in a country, would infringe one or more identifiable patents in that country that you have reason to believe are valid.
</p>

<p>
If, pursuant to or in connection with a single transaction or arrangement, you convey, or propagate by procuring conveyance of, a covered work, and grant a patent license to some of the parties receiving the covered work authorizing them to use, propagate, modify or convey a specific copy of the covered work, then the patent license you grant is automatically extended to all recipients of the covered work and works based on it.
</p>

<p>
A patent license is “discriminatory” if it does not include within the scope of its coverage, prohibits the exercise of, or is conditioned on the non-exercise of one or more of the rights that are specifically granted under this License. You may not convey a covered work if you are a party to an arrangement with a third party that is in the business of distributing software, under which you make payment to the third party based on the extent of your activity of conveying the work, and under which the third party grants, to any of the parties who would receive the covered work from you, a discriminatory patent license (a) in connection with copies of the covered work conveyed by you (or copies made from those copies), or (b) primarily for and in connection with specific products or compilations that contain the covered work, unless you entered into that arrangement, or that patent license was granted, prior to 28 March 2007.
</p>

<p>
Nothing in this License shall be construed as excluding or limiting any implied license or other defenses to infringement that may otherwise be available to you under applicable patent law.
</p>

<ol class="org-ol">
<li>No Surrender of Others' Freedom.</li>
</ol>
<p>
If conditions are imposed on you (whether by court order, agreement or otherwise) that contradict the conditions of this License, they do not excuse you from the conditions of this License. If you cannot convey a covered work so as to satisfy simultaneously your obligations under this License and any other pertinent obligations, then as a consequence you may not convey it at all. For example, if you agree to terms that obligate you to collect a royalty for further conveying from those to whom you convey the Program, the only way you could satisfy both those terms and this License would be to refrain entirely from conveying the Program.
</p>

<ol class="org-ol">
<li>Use with the GNU Affero General Public License.</li>
</ol>
<p>
Notwithstanding any other provision of this License, you have permission to link or combine any covered work with a work licensed under version 3 of the GNU Affero General Public License into a single combined work, and to convey the resulting work. The terms of this License will continue to apply to the part which is the covered work, but the special requirements of the GNU Affero General Public License, section 13, concerning interaction through a network will apply to the combination as such.
</p>

<ol class="org-ol">
<li>Revised Versions of this License.</li>
</ol>
<p>
The Free Software Foundation may publish revised and/or new versions of the GNU General Public License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns.
</p>

<p>
Each version is given a distinguishing version number. If the Program specifies that a certain numbered version of the GNU General Public License “or any later version” applies to it, you have the option of following the terms and conditions either of that numbered version or of any later version published by the Free Software Foundation. If the Program does not specify a version number of the GNU General Public License, you may choose any version ever published by the Free Software Foundation.
</p>

<p>
If the Program specifies that a proxy can decide which future versions of the GNU General Public License can be used, that proxy's public statement of acceptance of a version permanently authorizes you to choose that version for the Program.
</p>

<p>
Later license versions may give you additional or different permissions. However, no additional obligations are imposed on any author or copyright holder as a result of your choosing to follow a later version.
</p>

<ol class="org-ol">
<li>Disclaimer of Warranty.</li>
</ol>
<p>
THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
</p>

<ol class="org-ol">
<li>Limitation of Liability.</li>
</ol>
<p>
IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.
</p>

<ol class="org-ol">
<li>Interpretation of Sections 15 and 16.</li>
</ol>
<p>
If the disclaimer of warranty and limitation of liability provided above cannot be given local legal effect according to their terms, reviewing courts shall apply local law that most closely approximates an absolute waiver of all civil liability in connection with the Program, unless a warranty or assumption of liability accompanies a copy of the Program in return for a fee.
</p>

<p>
END OF TERMS AND CONDITIONS
</p>

<p>
How to Apply These Terms to Your New Programs
If you develop a new program, and you want it to be of the greatest possible use to the public, the best way to achieve this is to make it free software which everyone can redistribute and change under these terms.
</p>

<p>
To do so, attach the following notices to the program. It is safest to attach them to the start of each source file to most effectively state the exclusion of warranty; and each file should have at least the “copyright” line and a pointer to where the full notice is found.
</p>

<p>
&lt;one line to give the program's name and a brief idea of what it does.&gt;
Copyright (C) &lt;year&gt;  &lt;name of author&gt;
</p>

<p>
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
</p>

<p>
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
</p>

<p>
    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.
Also add information on how to contact you by electronic and paper mail.
</p>

<p>
If the program does terminal interaction, make it output a short notice like this when it starts in an interactive mode:
</p>

<p>
    &lt;program&gt;  Copyright (C) &lt;year&gt;  &lt;name of author&gt;
    This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
    This is free software, and you are welcome to redistribute it
    under certain conditions; type `show c' for Details.
The hypothetical commands `show w' and `show c' should show the appropriate parts of the General Public License. Of course, your program's commands might be different; for a GUI interface, you would use an “about box”.
</p>

<p>
You should also get your employer (if you work as a programmer) or school, if any, to sign a “copyright disclaimer” for the program, if necessary. For more information on this, and how to apply and follow the GNU GPL, see <a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.
</p>

<p>
The GNU General Public License does not permit incorporating your program into proprietary programs. If your program is a subroutine library, you may consider it more useful to permit linking proprietary applications with the library. If this is what you want to do, use the GNU Lesser General Public License instead of this License. But first, please read <a href="https://www.gnu.org/licenses/why-not-lgpl.html">https://www.gnu.org/licenses/why-not-lgpl.html</a>.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2021-09-27 Mon 16:23</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>

; BitField - test instructions that operate on bit fields
; This file is part of Sigma16, https://jtod.github.io/home/Sigma16/

; Shift - test the shift instructions
; John O'Donnell. This file is part of Sigma16, https://jtod.github.io/home/Sigma16/


; data to be shifted
      lea     R1,$0040[R0]  ; 0000 0000 0100 0000

; shiftr instruction
      shiftr  R2,R1,1       ; 0000 0000 0100 0000 -> 0000 0000 0010 0000 = 0020
      shiftr  R2,R2,1       ; 0000 0000 0010 0000 -> 0000 0000 0001 0000 = 0010
      shiftr  R2,R2,1       ; 0000 0000 0001 0000 -> 0000 0000 0000 1000 = 0008
      shiftr  R3,R1,5       ; 0000 0000 0100 0000 -> 0000 0000 0000 0010 = 0002

; shiftl instruction
      shiftl  R4,R1,1       ; 0000 0000 0100 0000 -> 0000 0000 1000 0000 = 0080
      shiftl  R5,R1,7       ; 0000 0000 0100 0000 -> 0010 0000 0000 0000 = 2000

; shift instruction
      lea     R1,$0040[R0]  ; 0040
      lea     R6,3[R0]      ; 0003   R6 := 3
      shift   R7,R1,R6      ; 0200   R7 := shift R1 left 3 bits
      lea     R8,-3[R0]     ; fffd   R8 := -3
      shift   R9,R1,R8      ; 0008   R9 := shift R1 right 3 bits

; Extracting bit fields

      lea      R1,$1234[R0]
      extract  R2,R1,0,3     ; 0001
      extract  R3,R1,4,7     ; 0002
      extract  R4,R1,8,11    ; 0003
      extract  R5,R1,12,15   ; 0004
      extract  R6,R1,0,7     ; 0012
      extract  R7,R1,8,15    ; 0034
      extract  R8,R1,4,11    ; 0023
      extract  R9,R1,1,0     ; 0000
      extract  R10,R1,0,15   ; 1234

      extracti R2,R1,0,3     ; 000e
      extracti R3,R1,4,7     ; 000d
      extracti R4,R1,8,11    ; 000c
      extracti R5,R1,12,15   ; 000b
      extracti R6,R1,0,7     ; 00ed
      extracti R7,R1,8,15    ; 00cb
      extracti R8,R1,4,11    ; 00dc
      extracti R9,R1,1,0     ; 0000
      extracti R10,R1,0,15   ; edcb

; Injecting bit fields

      lea      R1,$ffff[R0]
      lea      R2,$0005[R0]
      inject   R4,R0,R2,4,7  ; R4 := 0500
      inject   R5,R1,R2,4,7  ; R5 := f5ff

      injecti  R6,R0,R2,4,7  ; R6 := 0a00
      injecti  R7,R1,R2,4,7  ; R6 := faff
